const AppCache={PREFIX:"brb_",TTL:{SHORT:60,MEDIUM:300,LONG:1800,DAY:86400,WEEK:604800},set(e,t,a=this.TTL.MEDIUM){const r={value:t,expires:Date.now()+1e3*a,created:Date.now()};try{return localStorage.setItem(this.PREFIX+e,JSON.stringify(r)),!0}catch(t){return console.warn("Cache: Não foi possível armazenar",e,t),!1}},get(e,t=null){try{const a=localStorage.getItem(this.PREFIX+e);if(!a)return t;const r=JSON.parse(a);return r.expires&&r.expires<Date.now()?(this.remove(e),t):r.value}catch(e){return t}},remove(e){localStorage.removeItem(this.PREFIX+e)},removeByPrefix(e){const t=this.PREFIX+e;Object.keys(localStorage).filter(e=>e.startsWith(t)).forEach(e=>localStorage.removeItem(e))},clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.PREFIX)).forEach(e=>localStorage.removeItem(e))},cleanup(){Object.keys(localStorage).filter(e=>e.startsWith(this.PREFIX)).forEach(e=>{try{const t=JSON.parse(localStorage.getItem(e));t.expires&&t.expires<Date.now()&&localStorage.removeItem(e)}catch(e){}})},async remember(e,t,a){const r=this.get(e);if(null!==r)return r;const s=await a();return this.set(e,s,t),s},session:{set(e,t){try{return sessionStorage.setItem(AppCache.PREFIX+e,JSON.stringify(t)),!0}catch(e){return!1}},get(e,t=null){try{const a=sessionStorage.getItem(AppCache.PREFIX+e);return a?JSON.parse(a):t}catch(e){return t}},remove(e){sessionStorage.removeItem(AppCache.PREFIX+e)},clear(){Object.keys(sessionStorage).filter(e=>e.startsWith(AppCache.PREFIX)).forEach(e=>sessionStorage.removeItem(e))}}},AjaxCache={pending:new Map,async fetch(e,t={},a=AppCache.TTL.MEDIUM){const r=`ajax_${e}_${JSON.stringify(t)}`,s=AppCache.get(r);if(null!==s)return s;if(this.pending.has(r))return this.pending.get(r);const o=fetch(e,{...t,headers:{"X-Requested-With":"XMLHttpRequest",...t.headers}}).then(async e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return AppCache.set(r,t,a),this.pending.delete(r),t}).catch(e=>{throw this.pending.delete(r),e});return this.pending.set(r,o),o},invalidate(e){AppCache.removeByPrefix(`ajax_${e}`)},invalidateAll(){AppCache.removeByPrefix("ajax_")}},DashboardCache={KEYS:{PEDIDOS:"dashboard_pedidos",STATS:"dashboard_stats",CLIENTES:"dashboard_clientes",PRODUTOS:"dashboard_produtos",LAST_UPDATE:"dashboard_last_update"},setPedidos(e){AppCache.set(this.KEYS.PEDIDOS,e,AppCache.TTL.SHORT),AppCache.set(this.KEYS.LAST_UPDATE,Date.now(),AppCache.TTL.SHORT)},getPedidos(){return AppCache.get(this.KEYS.PEDIDOS)},isValid(){const e=AppCache.get(this.KEYS.LAST_UPDATE);return!!e&&Date.now()-e<6e4},invalidate(){Object.values(this.KEYS).forEach(e=>AppCache.remove(e))},async getClientes(e,t){const a=`clientes_${e.toLowerCase().substring(0,3)}`;return AppCache.remember(a,AppCache.TTL.MEDIUM,async()=>await t(e))},async getProdutos(e,t){const a=`produtos_${e.toLowerCase().substring(0,3)}`;return AppCache.remember(a,AppCache.TTL.MEDIUM,async()=>await t(e))}},DataPreloader={init(){"requestIdleCallback"in window?requestIdleCallback(()=>this.preload()):setTimeout(()=>this.preload(),2e3)},async preload(){const e=[{url:"../api/categorias.php",ttl:AppCache.TTL.LONG},{url:"../api/usuarios_ativos.php",ttl:AppCache.TTL.MEDIUM}];for(const t of e)try{AppCache.get(`ajax_${t.url}_${JSON.stringify({})}`)||await AjaxCache.fetch(t.url,{},t.ttl)}catch(e){}}};setInterval(()=>AppCache.cleanup(),6e4),window.AppCache=AppCache,window.AjaxCache=AjaxCache,window.DashboardCache=DashboardCache,window.DataPreloader=DataPreloader;