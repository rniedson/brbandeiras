try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="74025270-89e2-4b4a-a3bd-741d87e33002",e._sentryDebugIdIdentifier="sentry-dbid-74025270-89e2-4b4a-a3bd-741d87e33002")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8977],{2019:(e,t,s)=>{s.d(t,{F:()=>i});var a=s(86190);let n={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,a.U)(n[e])}},9447:(e,t,s)=>{s.d(t,{z:()=>m});var a=s(42977),n=s(54568),i=s(90510),l=s(64786),r=s(90119),o=s(32987),c=s(53600);function d(){let e=(0,a._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return d=function(){return e},e}let u=i.J.div(d());function m(e){let{children:t,className:s,contentClassName:a,sticky:i,fixed:d,mdTitle:m,large:x,narrow:f}=e,{isMobile:h,isExpanded:p}=(0,c.V)(),g=(0,r.V)(l.E_),v=!t&&!m,j=x&&!g;return(0,n.jsxs)("header",{className:(0,o.A)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",d&&"fixed top-0 z-header",g?l.X_:"h-12",g&&[!p&&"pl-[133px]",!v&&l.zo],j&&["mx-auto md:h-24 md:items-end",f?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,children:[!g&&(i||d)&&(0,n.jsx)(u,{}),(0,n.jsx)("div",{className:(0,o.A)("flex w-full items-center justify-between gap-4",g?"pt-0.5":"",g&&!p?"pl-3":"pl-11 lg:pl-8",g&&!(h&&p)&&"draggable",a,j?"px-4 md:pl-8":"pr-3"),children:m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:(0,o.A)("text-text-200 flex items-center gap-2 text-center max-md:hidden min-w-0",g?"font-medium leading-tight tracking-tight":"font-heading",!g&&(j?"text-2xl":"text-lg")),children:(0,n.jsx)("span",{className:"truncate",children:m})}),(0,n.jsx)("div",{}),t]}):t})]})}},11062:(e,t,s)=>{s.d(t,{bl:()=>n});var a=s(16253);async function n(e,t,s,n){let i=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=atob(e),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let l=a._F[t]||"png";return new File([i],"".concat(s,".").concat(l),{type:t})}(e,t,s),i=new FormData;return i.append("file",n),i}(e,t),l=await n("/api/".concat(s,"/upload"),{method:"POST",body:i});if(l.ok)return[await l.json()];throw Error("Failed to upload image: ".concat(l.status," ").concat(l.statusText))}},11480:(e,t,s)=>{s.d(t,{D8:()=>d,DT:()=>m,Ih:()=>r,h4:()=>o,i1:()=>x});var a=s(54568),n=s(32987),i=s(37463),l=s(7620);let r=(e,t)=>!(!["thinking","tool_use","tool_result"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","dolphin","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),o=e=>"tool_result"!==e.type,c=l.createContext({}),d=()=>(0,l.useContext)(c),u=e=>{let[t,s]=(0,l.useState)(void 0),n=(0,l.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:s}),[t,s]);return(0,a.jsx)(c.Provider,{value:n,children:e.children})},m=e=>{let{children:t,isFirstBlockOfMessage:s,isLastBlockOfMessage:l,isStreaming:r}=e;return(0,a.jsx)(i.P.div,{initial:{opacity:+!r},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,n.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",s?"mt-2":"mt-3",l?"mb-2":"mb-3"),children:(0,a.jsx)(u,{children:t})})},x=e=>{let{icon:t,isExpanded:s,isFirstItem:i,isLastItem:l,isActive:r,children:o}=e,c={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,a.jsxs)("div",{className:(0,n.A)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":s},{"hover:bg-always-black hover:bg-opacity-[0.03]":!s}),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,a.jsx)("div",{className:(0,n.A)("transition-all w-[1px]",{"bg-border-300":!i}),style:c}),(0,a.jsx)("div",{className:(0,n.A)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[$16px]":!!t}),children:null!=t?t:(0,a.jsx)("div",{className:(0,n.A)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,a.jsx)("div",{className:(0,n.A)("transition-all grow w-[1px]",{"bg-border-300":!l}),style:c})]}),(0,a.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},12189:(e,t,s)=>{s.d(t,{K:()=>h,h:()=>p});var a=s(54568),n=s(98518),i=s(1761),l=s(28885),r=s(34059),o=s(42067),c=s(41417),d=s(37076),u=s(77101),m=s(7620),x=s(62971),f=s(85717),h=function(e){return e.NOT_CONNECTED="not_connected",e.MISSING_SCOPE="missing_scope",e.UNKNOWN="unknown",e}({});let p=e=>{let{isOpen:t,onClose:s,errorType:h,onConnectionSuccess:p,callerIdentifier:g}=e,v=(0,n.st)(),{activeOrganization:j}=(0,i.YL)(),[b,y]=(0,m.useState)(!1),{initDriveAuth:w}=(0,f.cI)({callerIdentifier:g||"gdrive-export-modal",handleAuthSuccess:()=>{y(!1),v.track({event_key:"wiggle_gdrive_connection_success",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:g}),s(),setTimeout(()=>{null==p||p()},100)}});if((0,m.useEffect)(()=>{t&&v.track({event_key:"wiggle_gdrive_connection_modal_shown",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:g})},[t,h,g,null==j?void 0:j.uuid,v]),"unknown"===h)return null;let{title:_,description:N,buttonText:k}=(()=>{switch(h){case"not_connected":return{title:"Connect Claude to Google Drive",description:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:(0,a.jsx)(x.A,{defaultMessage:"This will allow Claude to:",id:"Fh77iGv4CM"})}),(0,a.jsxs)("ul",{className:"list-disc pl-5 text-sm text-text-300 space-y-1",children:[(0,a.jsx)("li",{children:(0,a.jsx)(x.A,{defaultMessage:"Add DOCX, XLSX, and PPTX files that it creates directly to Google Drive",id:"H4PCn1IJGu"})}),(0,a.jsx)("li",{children:(0,a.jsx)(x.A,{defaultMessage:"Search and summarize Google Drive files",id:"o+UM/Lfa+u"})})]})]}),buttonText:"Connect"};case"missing_scope":return{title:"Reconnect Claude to Google Drive",description:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:(0,a.jsx)(x.A,{defaultMessage:"This will give Claude permission to see, edit, create, and delete files that it creates in Google Drive.",id:"vHppAPeTNV"})}),(0,a.jsx)(o.l,{variant:"secondary",icon:l.R2,message:(0,a.jsx)(x.A,{defaultMessage:"You’ll only need to do this once. Any existing Google Drive capabilities in Claude will still work.",id:"v8YR2us4Y6"})})]}),buttonText:"Reconnect"}}})();return(0,a.jsx)(d.aF,{modalSize:"lg",isOpen:t,onClose:s,hasCloseButton:!0,title:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(r.A9,{type:u.v8.GDRIVE,size:20}),(0,a.jsx)("span",{children:_})]}),children:(0,a.jsxs)("div",{className:"mt-5 space-y-6",children:[N,(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(c.$,{onClick:s,variant:"secondary",children:(0,a.jsx)(x.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(c.$,{onClick:()=>{y(!0),v.track({event_key:"wiggle_gdrive_connection_initiated",organization_id:null==j?void 0:j.uuid,error_type:h,caller_identifier:g}),w()},loading:b,disabled:b,children:k})]})]})})}},13625:(e,t,s)=>{s.d(t,{d:()=>v,L:()=>g});var a=s(54568),n=s(8027),i=s(11515),l=s(1761),r=s(46760),o=s(62971),c=s(55563),d=s(94748),u=s(41417),m=s(5060);s(7620);var x=s(32987);function f(e){let{symbol:t,variant:s}=e;return(0,a.jsx)("div",{className:(0,x.$)("inline-flex items-center justify-center rounded px-1 py-0.5 text-xs ml-1","secondary"===s&&"bg-bg-300 text-text-400","primary"===s&&"bg-bg-100 bg-opacity-20 text-bg-100"),children:t})}function h(e){let{disabled:t,submitToolApproval:s,showAlwaysAllowed:n,setIsExpanded:i}=e,l=e=>{s(e),i(!1)};return(0,m.W)("keydown",e=>{if("Escape"===e.key){e.preventDefault(),l("deny");return}if("Enter"===e.key){let t=e.metaKey||e.ctrlKey;t&&n?(e.preventDefault(),l("always")):t||(e.preventDefault(),l("once"))}}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 pb-3 pl-3 pr-6",children:[(0,a.jsx)("div",{className:"flex flex-col justify-center items-start p-3 bg-bg-200 border-0.5 border-border-400/15 rounded-md min-h-[41px]",children:(0,a.jsx)("p",{className:"text-xs",children:(0,a.jsx)(o.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})}),(0,a.jsxs)("div",{className:"self-end flex gap-2",children:[(0,a.jsx)(u.$,{variant:"secondary",onClick:()=>l("deny"),append:(0,a.jsx)(f,{symbol:"esc",variant:"secondary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),n&&(0,a.jsx)(u.$,{variant:"secondary",disabled:t,onClick:()=>l("always"),append:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(f,{symbol:"⌘",variant:"secondary"}),(0,a.jsx)(f,{symbol:"⏎",variant:"secondary"})]}),children:(0,a.jsx)(o.A,{defaultMessage:"Always allow",id:"lr3QX/nctD"})}),(0,a.jsx)(u.$,{variant:"primary",disabled:t,onClick:()=>l("once"),append:(0,a.jsx)(f,{symbol:"⏎",variant:"primary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]})]})}var p=s(67532);let g=e=>{let{input:t,toolResult:s}=e,n=(0,r.A)(),{activeOrganization:i}=(0,l.YL)(),o=null==i?void 0:i.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,a.jsx)(c.z,{title:n.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,a.jsx)(c.z,{title:n.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,a.jsx)("img",{src:"/api/".concat(o,"/files/").concat(e.file_uuid,"/preview"),alt:n.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},v=e=>{let{toolName:t,integrationName:s,integrationIcon:l,approvalData:r,...c}=e,{input:u,toolResult:m,groupItemKey:x}=c,f=!!(null==r?void 0:r.approvalRequired),v=!!(null==r?void 0:r.approvalRequired)&&!(null==r?void 0:r.approved),{isExpanded:j,setIsExpanded:b,snappyTransition:y}=(0,p.a)(f,v?void 0:x),w=v?s?(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName} from {integrationName}",id:"wPBSjwhfE4",values:{toolName:t,integrationName:s}}):(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName}",id:"ZNLjFNb5bD",values:{toolName:t}}):t;return(0,a.jsx)(d.sH,{isExpanded:j,setIsExpanded:b,isExpandingDisabled:v,text:w,icon:(0,a.jsx)(i.d,{url:l,fallbackSvg:(0,a.jsx)(n.B,{letter:s||t,size:18}),size:18}),...c,children:(0,a.jsx)(d.NG,{isExpanded:j,snappyTransition:y,isScrollable:!0,footer:v?(0,a.jsx)(h,{...r,setIsExpanded:b}):null,children:(0,a.jsx)(g,{input:u,toolResult:m})})})}},17055:(e,t,s)=>{s.d(t,{f:()=>d,r:()=>c});var a=s(98518),n=s(32442),i=s(27062),l=s(41969),r=s(7620),o=s(86628);let c=24e4;function d(e){let{mcpClients:t}=e,[s,c]=(0,r.useState)([]),d=(0,r.useRef)(new Set),{track:u}=(0,a.st)(),{value:m}=(0,i.fS)("claude_ai_unicode_sanitize_mcp_data");return(0,r.useEffect)(()=>{let e=!1;return async function(){let s=Object.keys(t),a=s.filter(e=>!d.current.has(e));d.current=new Set([...d.current].filter(e=>Object.keys(t).includes(e)));let i=Object.fromEntries(a.map(e=>[e,t[e]]));if(!i||0===s.length)return;let r=await (0,o.D)(i,{method:"tools/list",params:{}},l.WT);e||(c(e=>[...e.filter(e=>s.includes(e.serverName)&&!a.includes(e.serverName)),...Object.entries(r).map(e=>{let[t,s]=e;return u({event_key:"mcp.tools.listed",tool_count_on_server:s.tools.length}),s.tools.map(e=>m?(0,n.M)(e):e).map(e=>({...e,serverName:t,enabledKey:"",alwaysApprovedKey:""}))}).flat()]),a.forEach(e=>d.current.add(e)))}(),()=>{e=!0}},[t,u,m]),{tools:s}}},18395:(e,t,s)=>{s.d(t,{B:()=>p});var a=s(54568),n=s(7726),i=s(1761),l=s(9537),r=s(41417),o=s(37076),c=s(54890),d=s(27261),u=s.n(d),m=s(7620),x=s(46760),f=s(62971),h=s(77336);function p(e){var t,s,d,p,g,v;let{conversationUuid:j,message:b,requestedFeedbackType:y,setRequestedFeedbackType:w,isOpen:_,onClose:N,onSuccess:k,showOptions:M=!0}=e,C=(0,x.A)(),[S,A]=(0,m.useState)(""),{data:z}=(0,n.Bq)(j),E=null==z?void 0:z.chat_messages.some(e=>(0,c.Xz)(e).length>0),I=(0,h.V)(null!=(d=null==z?void 0:z.chat_messages)?d:[]).length>0,{mutate:T}=(0,n.HA)(j,b,!!E,{onSuccess:k}),U=(0,m.useId)(),L=null!=(p=null==(t=b.content)?void 0:t.some(e=>"thinking"===e.type))&&p,R="raven"===(0,i.$b)(),O=null;return(null==z||null==(s=z.settings)?void 0:s.enabled_web_search)&&(O=null!=(v=null==(g=b.content)?void 0:g.some(e=>"tool_use"===e.type&&"web_search"===e.name))&&v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("option",{value:"flag/web-over",children:(0,a.jsx)(f.A,{defaultMessage:"Shouldn’t have searched the web",id:"T+mr27AakV"})}),(0,a.jsx)("option",{value:"flag/web-sources",children:(0,a.jsx)(f.A,{defaultMessage:"Don’t like the cited sources",id:"MBNotx/VaO"})})]}):(0,a.jsx)("option",{value:"flag/web-under",children:(0,a.jsx)(f.A,{defaultMessage:"Should have searched the web",id:"CS8kdzupd9"})})),(0,a.jsxs)(o.aF,{isOpen:_,title:C.formatMessage({defaultMessage:"Feedback",id:"Ejhdi47Jk5"}),onClose:N,children:[(0,a.jsxs)("div",{className:"mt-4 flex flex-col",children:[(null==y?void 0:y.includes("flag"))&&M&&(0,a.jsxs)(l.l6,{className:"my-2 max-w-md",label:C.formatMessage({defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"}),value:y,onChange:e=>{w(e.target.value||"flag")},children:[(0,a.jsx)("option",{value:"flag",children:(0,a.jsx)(f.A,{defaultMessage:"Select…",id:"q0+99kUbd6"})}),(0,a.jsx)("option",{value:"flag/bug",children:(0,a.jsx)(f.A,{defaultMessage:"UI bug",id:"0uIYueAyDB"})}),(0,a.jsx)("option",{value:"flag/refusal",children:(0,a.jsx)(f.A,{defaultMessage:"Overactive refusal",id:"Jl0Mn6yDBI"})}),I&&(0,a.jsx)("option",{value:"flag/file",children:(0,a.jsx)(f.A,{defaultMessage:"Poor image understanding",id:"227KYxHrx5"})}),(0,a.jsx)("option",{value:"flag/instructions",children:(0,a.jsx)(f.A,{defaultMessage:"Did not fully follow my request",id:"2uOw8LgMwG"})}),(0,a.jsx)("option",{value:"flag/facts",children:(0,a.jsx)(f.A,{defaultMessage:"Not factually correct",id:"topE9Q6MGe"})}),(0,a.jsx)("option",{value:"flag/incomplete",children:(0,a.jsx)(f.A,{defaultMessage:"Incomplete response",id:"ZNEcy7OM5r"})}),L&&(0,a.jsx)("option",{value:"flag/thoughts",children:(0,a.jsx)(f.A,{defaultMessage:"Issue with thought process",id:"zOab+24EWo"})}),O,(0,a.jsx)("option",{value:"flag/other",children:(0,a.jsx)(f.A,{defaultMessage:"Other",id:"/VnDMl81rh"})})]}),(0,a.jsx)("label",{htmlFor:U,className:"text-text-400 mb-2 text-sm",children:(0,a.jsx)(f.A,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),(0,a.jsx)(l.fs,{id:U,className:"text-sm",placeholder:(null==y?void 0:y.includes("flag"))?C.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}):C.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),value:S,onChange:e=>{A(e.target.value)}})]}),(0,a.jsx)("p",{className:"text-text-500 mt-3 italic leading-tight",children:(0,a.jsx)("small",{children:(0,a.jsx)(f.A,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn More</link>",id:"laRJ009b4f",values:{link:e=>(0,a.jsx)(u(),{target:"_blank",rel:"noopener",href:R?"https://privacy.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback":"https://privacy.anthropic.com/en/articles/10023565-how-does-anthropic-use-submitted-feedback",className:"text-accent-secondary-100 font-medium hover:underline",children:e})}})})}),(0,a.jsxs)(o.vW,{children:[(0,a.jsx)(r.$,{onClick:()=>{y&&(T({type:y,reason:S||void 0}),N())},children:(0,a.jsx)(f.A,{defaultMessage:"Submit",id:"wSZR47Y5kj"})}),(0,a.jsx)(r.$,{variant:"secondary",onClick:N,children:(0,a.jsx)(f.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})})]})]})}},20543:(e,t,s)=>{s.d(t,{N:()=>d,z:()=>u});var a=s(98518),n=s(77186),i=s(1761),l=s(51121),r=s(29585),o=s(7620),c=s(12189);function d(e){let{conversationUUID:t}=e,{activeOrganization:s}=(0,i.YL)(),{addError:d}=(0,l.Y)(),u=(0,a.st)(),[m,x]=(0,o.useState)(!1),[f,h]=(0,o.useState)(c.K.NOT_CONNECTED),p=null==s?void 0:s.uuid,g=(0,n.L2)("/api/organizations/".concat(p,"/conversations/").concat(t,"/wiggle/export-to-google-drive"),"POST",{enabled:!!p&&!!t,meta:{noToast:!0}});return{handleOpenInGoogleDrive:(0,o.useCallback)(async e=>{var s,a,n;if(!p||!t)return;let i=e.replace("computer://",""),l=(null==(s=i.split(".").pop())?void 0:s.toLowerCase())||"unknown";u.track({event_key:"wiggle_gdrive_export_attempted",organization_id:p,conversation_uuid:t,file_extension:l});try{let e=await g.mutateAsync({file_path:i});e.drive_url&&(window.open(e.drive_url,"_blank"),u.track({event_key:"wiggle_gdrive_export_success",organization_id:p,conversation_uuid:t,file_extension:l}))}catch(o){let e,s;o instanceof r.LG?((e=null!=(n=o.errorCode)?n:void 0)||null==(a=o.extra)||!a.details||(e=o.extra.details.error_code),s=o.message):s="Export failed. Please try again.";let i=(e=>{switch(e){case"google_drive_not_connected":return c.K.NOT_CONNECTED;case"google_drive_insufficient_scopes":return c.K.MISSING_SCOPE;default:return c.K.UNKNOWN}})(e);if(i===c.K.NOT_CONNECTED||i===c.K.MISSING_SCOPE){u.track({event_key:"wiggle_gdrive_export_auth_error",organization_id:p,conversation_uuid:t,error_type:i,file_extension:l}),h(i),x(!0);return}d(s),u.track({event_key:"wiggle_gdrive_export_failed",organization_id:p,conversation_uuid:t,file_extension:l,error_message:s})}},[p,t,g,u,d]),showConnectionModal:m,setShowConnectionModal:x,connectionError:f,isExporting:g.isPending}}function u(e){let t=/\.docx$/i.test(e),s=/\.xlsx$/i.test(e),a=/\.pptx$/i.test(e);return t||s||a}},21570:(e,t,s)=>{s.d(t,{F:()=>i});var a=s(45986),n=s.n(a);function i(e){var t;let s=e.name.split("."),a=s.slice(0,-1).join("."),i=null!=(t=s.at(-1))?t:"",l=a.replaceAll(/[_-]/g," ");return{displayName:n()(l),displayExt:i?i.toUpperCase():null}}},22126:(e,t,s)=>{s.d(t,{n:()=>N,M:()=>_});var a=s(7726),n=s(97527),i=s(33200),l=s(37428),r=s(44180),o=s(7620),c=s(99965),d=s(92947),u=s(56147),m=s(16253),x=s(98518),f=s(51121),h=s(75632),p=s(41969),g=s(17055);function v(e){let{mimeType:t,base64Data:s}=e;if(!m._F[t])throw(0,r.Cp)(Error("Unsupported image type"),{extra:{mimeType:t}}),Error("The tool returned an image in an unsupported format.");let a=m._F[t];return{type:"image",file_name:"".concat((0,h.N)(),".").concat(a),source:{media_type:t,type:"base64",data:s}}}var j=s(21155);async function b(e,t){let s=j.zN.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}throw Error("Error parsing input: ".concat(s.error.message))}var y=s(50361),w=s(28871);function _(){let{mutateAsync:e}=(0,a.Pt)(),t=function(){let{executeReplCode:e}=(0,n.q)(),t=(0,y.DD)(),s=function(){let{track:e}=(0,x.st)(),{addError:t}=(0,f.Y)();return(0,o.useCallback)(async(s,a,n)=>{let i;if(!n.client)throw(0,r.Cp)(Error("MCP client not found"),{tags:{serverUuid:n.uuid}}),Error("Unable to connect to ".concat(n.name,"."));try{let t=await n.client.callTool({name:a.name,arguments:s},p.zo,{timeout:g.r});e({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(s).length}),i="content"in t?t:{content:[{type:"text",text:JSON.stringify(t.toolResult,null,2)}],isError:!1}}catch(i){throw(0,r.Cp)(i,{tags:{serverUuid:n.uuid}}),t("Failed to call tool ".concat(a.name)),e({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(s||{}).length}),Error("Tool execution failed")}return{is_error:i.isError,content:i.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return v({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw(0,r.Cp)(Error("Missing MIME type for resource"),{tags:{serverUuid:n.uuid}}),Error("The tool returned a resource without a valid format.");return v({mimeType:t.mimeType,base64Data:t.blob})}}}throw(0,r.Cp)(Error("Unsupported content type"),{tags:{serverUuid:n.uuid},extra:{mimeType:e.type}}),Error("The tool returned content in an unsupported format.")})}},[e,t])}();return(0,o.useCallback)(async(a,n)=>{let i=(0,w.p)(n);if("repl"===a)return await b(i,e);{let e=t(a);if((null==e?void 0:e.tool)&&(null==e?void 0:e.server))return await s(i,e.tool,e.server)}},[e,t,s])}();return(0,o.useCallback)(async function(s,a,n,i){let{overriddenResult:l}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{let o=null!=l?l:await t(a,i);if(void 0===o)return void(0,r.Cp)(Error("Tool not found"),{tags:{conversationUUID:s,toolId:n},level:"warning"});await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,...o})}catch(a){(0,r.Cp)(a,{tags:{conversationUUID:s,toolId:n}});let t=a instanceof Error?a.message:String(a);await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,content:[{type:"text",text:t}]})}},[t,e])}let N=(e,t)=>{let s=(0,l.wc)(),{servers:a}=(0,d.gt)(),{value:n}=(0,i.N)(null!=e?e:{}),r=(0,c.p9)(),m=(0,u.Pb)(t);return(0,o.useCallback)(()=>{let t=[];for(let s of a)for(let a of s.tools){var i,o;if((null==e||null==(i=e.enabled_mcp_tools)?void 0:i[a.enabledKey])!==!1){if(r&&"remote"===s.type)continue;t.push({name:a.name,description:null!=(o=a.description)?o:a.name,input_schema:a.inputSchema,integration_name:s.name,...(null==s?void 0:s.type)==="remote"&&{mcp_server_uuid:s.uuid,integration_icon_url:s.url}})}}let c=null==s?void 0:s[l.U3];return c&&t.push({type:(null==s?void 0:s[l.$6])||"",name:c}),t.push({type:"artifacts_v0",name:"artifacts"}),n&&t.push({type:"repl_v0",name:"repl"}),m&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[a,null==e?void 0:e.enabled_mcp_tools,n,s,m,r])}},22134:(e,t,s)=>{s.d(t,{K:()=>p,r:()=>v});var a=s(54568),n=s(8027),i=s(11515),l=s(33395),r=s(28885),o=s(34059),c=s(77101),d=s(32987),u=s(37463),m=s(46760),x=s(55563),f=s(94748),h=s(67532);function p(e){var t,s,n;let i,{integrationName:l,icon:r,integrationIcon:o,message:c,result:d,isStreaming:u,isError:x,isExpandingDisabled:p,isFirstBlockOfMessage:g,isLastBlockOfMessage:w,wrapperClassName:_,contentClassName:N,defaultExpanded:k=!1,toolName:M,renderMode:C,groupItemKey:S,isFirstItemInGroup:A,isLastItemInGroup:z}=e,E=(0,m.A)(),{isExpanded:I,setIsExpanded:T}=(0,h.a)(k,S),U=!!d&&!p&&!u&&("rich_content"!==d.type||(null==(t=d.content)?void 0:t.length)>0);return i=d?"rich_content"===d.type?E.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(n=null==(s=d.content)?void 0:s.length)?n:0}):"JSON":void 0,(0,a.jsx)(f.sH,{isError:x,isExpandingDisabled:!U,isExpanded:I,setIsExpanded:T,isStreaming:!!u,text:null!=c?c:u?E.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):E.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:u?void 0:i,icon:r||(0,a.jsx)(v,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:g,isLastBlockOfMessage:w,wrapperClassName:_,renderMode:C,isFirstItemInGroup:A,isLastItemInGroup:z,children:(0,a.jsxs)(f.NG,{isExpanded:I,snappyTransition:!0,isScrollable:!0,className:N,children:[U&&(null==d?void 0:d.type)==="rich_content"&&(0,a.jsx)(j,{disabled:!I||u,result:d,integrationName:l,toolName:M}),U&&(null==d?void 0:d.type)==="table"&&(0,a.jsx)(b,{result:d}),U&&(null==d?void 0:d.type)==="json_block"&&(0,a.jsx)(y,{result:d})]})})}let g=["Google Calendar","Gmail","Google Drive","Search Project Knowledge","Search Past Conversations"],v=e=>{let{canShowLetterIcon:t,integrationName:s,toolName:l,iconUrl:d,size:u=16}=e;switch(s){case"Google Drive":return(0,a.jsx)(o.A9,{type:c.v8.GDRIVE,size:u});case"Google Calendar":return(0,a.jsx)(o.A9,{type:c.v8.GCAL,size:u});case"Gmail":return(0,a.jsx)(o.A9,{type:c.v8.GMAIL,size:u});case"Search Project Knowledge":return(0,a.jsx)(r.Jt,{vectorSizeOverride:u});case"Search Past Conversations":return(0,a.jsx)(r.ce,{vectorSizeOverride:u})}return(0,a.jsx)(i.d,{fadeInOnLoad:!0,url:d,size:u,fallbackSvg:(s||l)&&t?(0,a.jsx)(n.B,{size:u,letter:s||l}):(0,a.jsx)(r.qz,{vectorSizeOverride:u,className:"text-text-500"})})},j=e=>{let{disabled:t,integrationName:s,result:n,toolName:i}=e,r=i?i.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,o=!!s&&g.includes(s)&&2039!==r&&2010!==r;return(0,a.jsx)(u.P.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:n.content.map((e,n)=>{let{title:i,subtitles:r,url:c,resource_type:d,icon_url:u}=e;return(0,a.jsx)(l.$,{disabled:t,icon:o?void 0:(0,a.jsx)(v,{integrationName:s,iconUrl:u}),title:i,subtitles:r,url:c,tag:d},n)})})},b=e=>{let{result:t}=e;return(0,a.jsx)(w,{table:t.table})},y=e=>{let{result:t}=e,s=(0,m.A)();return(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,a.jsx)(x.z,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},w=e=>{let{table:t}=e;return(0,a.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[n,i]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,d.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"font-medium text-text-300 text-xs",children:n})}),(0,a.jsx)("div",{className:(0,d.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},22336:(e,t,s)=>{s.d(t,{O:()=>l,f:()=>i});var a=s(77186),n=s(1761);let i=e=>{let{conversationUUID:t,source:s}=e,{activeOrganization:i}=(0,n.YL)(),l=null==i?void 0:i.uuid,r=new URLSearchParams;s&&r.append("source",s);let o=r.toString()?"?".concat(r.toString()):"";return(0,a.Sk)("/api/organizations/".concat(l,"/artifacts/").concat(t,"/versions").concat(o),{queryKey:["conversation_artifacts_query_key",{organizationUUID:l,conversationUUID:t}],enabled:!!l&&!!t,meta:{noToast:!0}})},l=e=>{let{conversationUUID:t}=e,{activeOrganization:s}=(0,n.YL)(),i=null==s?void 0:s.uuid;return(0,a.L2)("/api/organizations/".concat(i,"/conversations/").concat(t,"/wiggle/convert-file-to-artifact"),"POST",{enabled:!!i&&!!t})}},24934:(e,t,s)=>{s.d(t,{g:()=>u});var a=s(42977),n=s(54568),i=s(90510),l=s(28885),r=s(32987),o=s(26631);function c(){let e=(0,a._)(["\n  z-dropdown\n  bg-bg-100\n  border-0.5\n  border-border-300\n  backdrop-blur-xl\n  rounded-lg\n  min-w-[8rem]\n  overflow-hidden\n  p-1\n  text-text-200\n  shadow-element\n"]);return c=function(){return e},e}function d(e,t){if(!t)return e;if("string"==typeof t)return t;let{add:s="",remove:a=""}=t,n=a.split(" ").filter(Boolean),i=e.split(" ").filter(Boolean).filter(e=>!n.includes(e));return(0,r.A)(i,s)}function u(e){var t;let{children:s,open:a,defaultButtonLabel:i,onClickDefaultButton:c,onOpenChange:u,buttonClassName:x,triggerButtonClassName:f,wrapperClassName:h,...p}=e,g=(0,r.A)("py-1 px-2 border-r border-border-300 hover:bg-bg-200",a&&"bg-bg-200");return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(o.bL,{open:a,onOpenChange:u,children:[(0,n.jsxs)("div",{className:d("flex font-medium rounded-lg overflow-hidden border border-border-300 h-8 rounded-md whitespace-nowrap",h),children:[(0,n.jsx)("button",{className:d(g,x),onClick:c,children:i}),(0,n.jsx)(o.l9,{asChild:!0,children:(0,n.jsx)("button",{className:d("py-1 px-1 hover:bg-bg-200",f),children:(0,n.jsx)(l.bi,{size:16})})})]}),(0,n.jsx)(o.ZL,{children:(0,n.jsx)(m,{sideOffset:null!=(t=p.sideOffset)?t:4,...p,children:s})})]})})}s(7620);let m=(0,i.J)(o.UC)(c())},25243:(e,t,s)=>{s.d(t,{W:()=>n});var a=s(7620);function n(e,t,s){let n=(0,a.useRef)(void 0),i=(0,a.useCallback)(e,t),l=(0,a.useCallback)(()=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(i,s)},[i,s]);return(0,a.useEffect)(()=>{l()},[...t,i,s]),l}},28871:(e,t,s)=>{s.d(t,{p:()=>a});function a(e){let t;try{t=JSON.parse(e)}catch(e){}return t}},30453:(e,t,s)=>{s.d(t,{f:()=>d});var a=s(54568),n=s(36906),i=s(34098),l=s(41417),r=s(43989),o=s(76761),c=s(7620);let d=e=>{let{attachment:t,goBack:s,onClose:d}=e,u=(0,c.useMemo)(()=>(0,i.E)(t),[t]);return(0,a.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,a.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,a.jsx)(l.$,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,a.jsx)(r.n,{size:20})}),(0,a.jsx)("h2",{className:"font-ui tracking-tight flex-1 truncate text-lg font-medium",children:u.title}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:d,"data-testid":"close-file-preview",children:(0,a.jsx)(o.X,{size:20})})]}),(0,a.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,a.jsx)(n.G,{metaData:u.metaData}),(0,a.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},30977:(e,t,s)=>{s.d(t,{y:()=>D});var a=s(54568),n=s(10158),i=s(1761),l=s(51121),r=s(28885),o=s(41417),c=s(56370),d=s(24934),u=s(18179),m=s(37076),x=s(9786),f=s(32987),h=s(61773),p=s(7620),g=s(46760),v=s(62971),j=s(22336),b=s(81527);async function y(e){let t,{organizationUuid:s,filePath:a}=e;t=e.isShared?"/api/organizations/".concat(s,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-file?path=").concat(encodeURIComponent(a)):"/api/organizations/".concat(s,"/conversations/").concat(e.conversationUuid,"/wiggle/download-file?path=").concat(encodeURIComponent(a));let n=await fetch(t);if(!n.ok)throw Error("Failed to fetch file: ".concat(n.status," ").concat(n.statusText));return n}var w=s(88346),_=s(95549),N=s(98252),k=s(85799),M=s(21570),C=s(49146),S=s(20543),A=s(53029),z=s(19544),E=s(56340),I=s(1336),T=s(89697),U=s(9234),L=s(54890),R=s(92479);let O=e=>{let{content:t,language:s,type:n,showRaw:i=!1,richSandboxRef:l,onSandboxConfirmation:r,richSandboxCapabilities:o,fileName:c,onRefresh:d,isSvg:m=!1,isReact:x=!1,isMermaid:f=!1,isPdf:h=!1,isExcel:g=!1,isExcelLegacy:v=!1,isCsv:j=!1,isTsv:b=!1}=e,[y,w]=(0,p.useState)(null),[_,N]=(0,p.useState)(!0);p.useEffect(()=>{t&&"rich"===n&&N(!0)},[t,n]);let k=(0,p.useCallback)((e,t)=>{if("json"===t&&e)try{let t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(e){}return e},[]),M=(0,p.useCallback)(e=>{w({error:e,artifactId:c||"file",artifactVersion:0})},[c]),C=(0,p.useCallback)(()=>{w(null)},[]),S=(0,p.useCallback)(()=>{w(null),null==d||d()},[d]),E=(0,p.useRef)(null),T=(0,p.useCallback)(()=>{if("rich"===n)return m?L.vU.Svg:x?L.vU.React:f?L.vU.Mermaid:h?L.qK.Pdf:g?L.qK.Excel:v?L.qK.ExcelLegacy:j?L.qK.Csv:b?L.qK.Tsv:L.vU.Html},[n,m,x,f,h,g,v,j,b])(),R="rich"===n&&!i&&void 0!==t&&void 0!==T;return(0,a.jsxs)(a.Fragment,{children:[R&&(0,a.jsxs)("div",{className:"h-full w-full relative border-none",children:[_&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-bg-100 z-20",children:(0,a.jsx)(u.Loading,{size:"md"})}),(0,a.jsx)(z.A,{ref:l,className:"h-full w-full border-none bg-bg-100",content:t,type:T,onSandboxConfirmation:()=>{N(!1),null==r||r()},capabilities:o,onReportError:M,onSetContent:C,onRefresh:S,externalLinkBehavior:"ask"}),y&&(0,a.jsx)(A.i,{error:y,handleClose:()=>w(null),isStreaming:!1})]}),void 0!==t&&"code"===n&&(0,a.jsx)(U.Z,{ref:E,className:"relative flex w-full flex-1 overflow-x-auto overflow-y-scroll min-h-full",children:(0,a.jsx)("div",{tabIndex:0,className:"markdown"===s||"plaintext"===s?"mx-auto w-full max-w-3xl leading-[1.65rem] -tracking-[0.015em] px-6 py-4 md:py-6 md:px-11":"",children:"markdown"===s?(0,a.jsx)(I.fP,{text:t,className:"font-claude-response"}):(0,a.jsx)(F,{content:k(t,s),language:s,showLineNumbers:"plaintext"!==s,wrapLongLines:"plaintext"===s})})})]})},F=e=>{let{content:t,language:s,showLineNumbers:n,wrapLongLines:i}=e,{codeStyle:l}=(0,T.V)();return(0,a.jsx)(R.A,{className:"code-block__code !my-0 flex-1 w-fit min-w-full !rounded-none !text-sm !leading-relaxed [&_.linenumber]:!not-italic",language:s,PreTag:"div",style:l,renderer:E.G,showLineNumbers:n,wrapLongLines:i,lineNumberStyle:{opacity:.667,minWidth:"2.5rem"},children:t})},D=e=>{var t;let{file:s,goBack:A,onClose:z,isShared:E,projectUuid:I,isTemporary:T,showBackButton:U}=e,L=E?e.snapshotUuid:e.conversationUuid,[R,F]=(0,p.useState)(""),[D,B]=(0,p.useState)(!1),[G,W]=(0,p.useState)(null),[J,V]=(0,p.useState)(!1),[H,q]=(0,p.useState)(null),{activeOrganization:K}=(0,i.YL)(),{copyToClipboard:Y}=(0,x.C)(),{addSuccess:$}=(0,l.Y)(),X=(0,p.useRef)(null),Z=(0,g.A)(),Q=s.path.split("/").pop()||s.path,ee=(0,C.S)(s.path),[et,es]=(0,p.useState)(!1),ea=(0,i.mV)(),en=(0,b.fo)(I),ei=(0,p.useMemo)(()=>D?new Blob([R]).size<1e6:null,[D,R]),el=!T&&"conversationUuid"in e&&e.conversationUuid&&R&&D&&ei,er=(0,j.O)({conversationUUID:"conversationUuid"in e?e.conversationUuid:void 0}),eo=T?null:ea?"share":"publish",{publishedArtifactsBaseUrl:ec}=(0,n._r)(),ed=(0,p.useMemo)(()=>er.data&&eo?P(eo,er.data,ec):null,[eo,er.data,ec]),eu=/\.(png|jpg|jpeg|gif|bmp|webp)$/i.test(s.path),em=/\.svg$/i.test(s.path),ex=/\.html?$/i.test(s.path),ef=/\.(tsx|jsx)$/i.test(s.path),eh=/\.(mermaid|mmd)$/i.test(s.path)||"mermaid"===ee,ep=/\.pdf$/i.test(s.path),eg=/\.docx$/i.test(s.path),ev=/\.pptx$/i.test(s.path),ej=/\.xlsx$/i.test(s.path),eb=/\.xls$/i.test(s.path),ey=/\.csv$/i.test(s.path),ew=/\.tsv$/i.test(s.path),e_=(0,S.z)(s.path),eN=(0,p.useCallback)(async()=>{if(!(null==K?void 0:K.uuid))return void q(Z.formatMessage({defaultMessage:"Unable to load file content",id:"0IswH+G61x"}));V(!0),q(null);try{let e=s.path.replace("computer://","");if(eg||ev){let t=e.split("/"),s=t[t.length-1];t[t.length-1]="."+s,e=t.join("/")+".pdf"}let t=await y(E?{organizationUuid:K.uuid,snapshotUuid:L,filePath:e,isShared:!0}:{organizationUuid:K.uuid,conversationUuid:L,filePath:e,isShared:!1});if(eu){let e=await t.blob(),s=URL.createObjectURL(e);W(s),F(""),B(!1)}else if(ep||eg||ev||ej||eb||ey||ew){let e=await t.blob(),s=await e.arrayBuffer(),a=btoa(new Uint8Array(s).reduce((e,t)=>e+String.fromCharCode(t),""));F(a),B(!1),W(null)}else{let e=await t.text();F(e),B(!0),W(null)}q(null)}catch(e){q(Z.formatMessage({defaultMessage:"Failed to load file content",id:"6u3/Jh2Vzp"}))}finally{V(!1)}},[null==K?void 0:K.uuid,s.path,Z,eu,ep,eg,ev,ej,eb,ey,ew,E,L]);(0,p.useEffect)(()=>{eN()},[eN]),(0,p.useEffect)(()=>()=>{G&&URL.revokeObjectURL(G)},[G]);let ek=()=>{(null==K?void 0:K.uuid)&&(0,N.J)(E?{filepath:s.path,orgUuid:K.uuid,snapshotUuid:L,isShared:!0}:{filepath:s.path,orgUuid:K.uuid,conversationUuid:L,isShared:!1})},eM=async()=>{eu||(await Y(R),$(Z.formatMessage({defaultMessage:"Copied to clipboard",id:"93oVThAHvU"})))},eC=async t=>{let{operation:a}=t;if(e.isShared)return;let n=await er.mutateAsync({path:s.path,operation:a}),i=P(a,n,ec);i&&await Y(i)},{displayName:eS,displayExt:eA}=(0,M.F)(s);return(0,a.jsxs)("div",{className:"flex h-full flex-col relative",children:[(0,a.jsx)(a.Fragment,{children:"share"===eo?(0,a.jsx)(w.ke,{isOpen:et,isProjectArtifact:!!(null==(t=en.data)?void 0:t.is_private),isLoading:er.isPending,sharedLink:ed||"",isShared:!!er.data,onClose:()=>es(!1),handleClickShareButton:()=>void eC({operation:"share"}),updateSharedState:()=>void 0}):"publish"===eo?(0,a.jsx)(m.aF,{hasCloseButton:!0,modalSize:"lg",isOpen:et,onClose:()=>es(!1),title:(0,a.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:(0,a.jsx)(v.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),children:(0,a.jsx)("div",{className:"mt-2 flex flex-col gap-2.5",children:er.data?(0,a.jsx)(_.L_,{artifactUuid:er.data.artifact_uuid,publishedLink:ed||"",onClose:()=>es(!1)}):(0,a.jsx)(_._L,{title:Q,isLoading:er.isPending,fetchScreenshot:()=>Promise.resolve(),setScreenshot:()=>void 0,handlePublishArtifact:()=>{eC({operation:"publish"})}})})}):null}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 py-2 bg-bg-000 gap-2",children:[U?(0,a.jsx)(o.$,{variant:"ghost",size:"icon",onClick:A,children:(0,a.jsx)(r.nk,{})}):null,(0,a.jsxs)("h2",{className:(0,f.A)("text-sm font-normal text-text-200 flex-1"),children:[eS," \xb7 ",null!=eA?eA:""]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e_&&!E&&e.conversationUuid&&(0,a.jsx)(k.M,{file:s,conversationUUID:e.conversationUuid,variant:"secondary",size:"icon_sm",className:"!px-2.5"}),eu?(0,a.jsx)(o.$,{variant:"secondary",onClick:ek,className:"text-sm",children:(0,a.jsx)(v.A,{defaultMessage:"Download",id:"5q3qC0sC3r"})}):(0,a.jsx)("div",{className:"[&_button]:text-sm mx-2 [&>div]:h-9",children:(0,a.jsxs)(d.g,{defaultButtonLabel:(0,a.jsx)(v.A,{defaultMessage:"Download",id:"5q3qC0sC3r"}),onClickDefaultButton:ek,align:"end",children:[(0,a.jsx)(c.tJ,{onSelect:eM,children:(0,a.jsx)(v.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),R?(0,a.jsx)(c.tJ,{disabled:!el,onSelect:()=>es(!0),children:(0,a.jsxs)("div",{className:"flex flex-col",children:["share"===eo?(0,a.jsx)(v.A,{defaultMessage:"Share",id:"OKhRC6eWRw"}):(0,a.jsx)(v.A,{defaultMessage:"Publish",id:"syEQFEKfku"}),(0,a.jsx)("span",{className:"text-text-300 text-xs",children:D?ei?null:(0,a.jsx)(v.A,{defaultMessage:"File is too large",id:"uFwMw7Ndmt"}):(0,a.jsx)(v.A,{defaultMessage:"Cannot share non-text files",id:"/YyI01IMjH"})})]})},(null!=eo?eo:"")+"-"+s.path):null]})}),(0,a.jsx)(o.$,{variant:"ghost",size:"icon",onClick:eN,disabled:J,children:(0,a.jsx)(r.Mv,{size:20})}),(0,a.jsx)(o.$,{variant:"ghost",size:"icon",onClick:z,children:(0,a.jsx)(r.X,{size:20})})]})]}),(0,a.jsx)("div",{className:"flex-1 min-h-0 bg-bg-000 overflow-auto",children:J?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(u.Loading,{size:"md"})}):H?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,a.jsx)("div",{children:H}),(0,a.jsx)(o.$,{variant:"secondary",size:"sm",onClick:eN,children:(0,a.jsx)(v.A,{defaultMessage:"Try again",id:"FazwRldA7z"})})]}):R||G?eu&&G?(0,a.jsx)("div",{className:"h-full p-5",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-full relative w-full",children:(0,a.jsx)(h.default,{src:G,alt:Q,fill:!0,className:"object-contain"})})}):(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(O,{content:R,type:ex||em||ef||eh||ep||eg||ev||ej||eb||ey||ew?"rich":"code",language:ee,richSandboxRef:X,fileName:Q,onRefresh:eN,isSvg:em,isReact:ef,isMermaid:eh,isPdf:ep||eg||ev,isExcel:ej,isExcelLegacy:eb,isCsv:ey,isTsv:ew})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,a.jsx)(v.A,{defaultMessage:"No file content available",id:"H8DU08sy24"}),(0,a.jsx)(o.$,{variant:"secondary",size:"sm",onClick:eN,children:(0,a.jsx)(v.A,{defaultMessage:"Load file",id:"xvpw6mFG1S"})})]})})]})};function P(e,t,s){return"share"===e?"".concat(window.location.origin,"/artifacts/").concat(t.artifact_version_uuid):"publish"===e&&t.published_artifact_uuid?"".concat(s,"/public/artifacts/").concat(t.published_artifact_uuid):void 0}},31417:(e,t,s)=>{s.d(t,{w:()=>o,y:()=>c});var a=s(77186),n=s(23661),i=s(7620);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let a=null!=(t=s.get(e.file_name))?t:[];a.push(e),s.set(e.file_name,a)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s.filter(e=>e.file_kind===n.M.Blob);return 0===a.length?null:a[a.length-1]}function o(){let e=function(){let e=(0,a.mn)();return(0,i.useCallback)(async(t,s,a,n,i)=>{let l=r(t,s);if(!l&&n){let s=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(a,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(a,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>0x80000000-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,a,n,i,r)=>{if(!n)return null;let o=function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s[s.length-1];if(a){let e=a.extracted_content;return new TextEncoder().encode(e)}return null}(t,s);return o||await e(t,a,n,i,r)},[e])}function c(e,t,s,a,n){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,a,n),[e,t,s,a,l,n])}},33792:(e,t,s)=>{s.d(t,{l:()=>a});var a=function(e){return e.Standard="Standard",e.TimelineGroup="TimelineGroup",e}({})},39741:(e,t,s)=>{s.d(t,{NotificationListener:()=>z,hG:()=>A,Wo:()=>C});var a=s(98518),n=s(1761),i=s(90119),l=s(89598),r=s(44180),o=s(20996),c=s(9801),d=s(7620),u=s(42071),m=s(24478),x=s(27511),f=s(65988);let h=(0,m.w)("CiRhbnRocm9waWMvY2xhdWRlL3B1c2gvZW52ZWxvcGUucHJvdG8SFWFudGhyb3BpYy5jbGF1ZGUucHVzaCJfChVQdXNoT3BlcmF0aW9uRW52ZWxvcGUSDwoHc2VydmljZRgBIAEoCRIOCgZtZXRob2QYAiABKAkSJQoHcmVxdWVzdBgDIAEoCzIULmdvb2dsZS5wcm90b2J1Zi5BbnlC4wEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCDUVudmVsb3BlUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[f.f]),p=(0,x.Z)(h,0);var g=s(48021);let v=(0,m.w)("CiZhbnRocm9waWMvY2xhdWRlL3B1c2gvb3BlcmF0aW9ucy5wcm90bxIVYW50aHJvcGljLmNsYXVkZS5wdXNoIpEBCg9PcGVuQ2hhdFJlcXVlc3QSIgoMYWNjb3VudF91dWlkGAEgASgJUgxhY2NvdW50X3V1aWQSLAoRb3JnYW5pemF0aW9uX3V1aWQYAiABKAlSEW9yZ2FuaXphdGlvbl91dWlkEiwKEWNvbnZlcnNhdGlvbl91dWlkGAMgASgJUhFjb252ZXJzYXRpb25fdXVpZDJrCh1Mb2dnZWRJblB1c2hPcGVyYXRpb25zU2VydmljZRJKCghPcGVuQ2hhdBImLmFudGhyb3BpYy5jbGF1ZGUucHVzaC5PcGVuQ2hhdFJlcXVlc3QaFi5nb29nbGUucHJvdG9idWYuRW1wdHlC5QEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCD09wZXJhdGlvbnNQcm90b1ABWkFnaXRodWIuY29tL2FudGhyb3BpY3MvbW9iaWxlLWFwcHMvZ28vcHJvdG9zL2FudGhyb3BpYy9jbGF1ZGUvcHVzaKICA0FDUKoCFUFudGhyb3BpYy5DbGF1ZGUuUHVzaMoCFUFudGhyb3BpY1xDbGF1ZGVcUHVzaOICIUFudGhyb3BpY1xDbGF1ZGVcUHVzaFxHUEJNZXRhZGF0YeoCF0FudGhyb3BpYzo6Q2xhdWRlOjpQdXNoYgZwcm90bzM",[g.t]),j=(0,x.Z)(v,0);var b=s(95084),y=s(49642),w=s(66612);let _=(0,b.Iq)(v);var N=s(40459);let k={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:N.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:N.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},M="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",C=()=>{let[e,t]=(0,d.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,d.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,l.M)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},S=async e=>{let{isClaudeElectronApp:t,onTokenReceived:s,track:a}=e;if(!("Notification"in window))return!1;try{let e=await Notification.requestPermission();if(a&&a({event_key:"claudeai.notification.permission.result",permission:e}),"granted"!==e)return a&&a({event_key:"claudeai.notification.permission.result",permission:e}),!1;{let e,a;if(t||(e=0===(0,o.Dk)().length?(0,o.Wp)(k):(0,o.Sx)(),!await (0,c.TT)()))return!1;try{a=(0,c.dG)(e)}catch(e){return!1}let n=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!n&&1)try{n=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,r.Cp)(e,{tags:{action:"registerServiceWorker"}})}try{let e=await (0,c.gf)(a,{vapidKey:M,serviceWorkerRegistration:n});if(e)s(e);else throw(0,r.Cp)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,r.Cp)(e,{tags:{action:"getToken"}}),e}}return"granted"===e}catch(e){return(0,r.Cp)(e,{tags:{action:"requestPermission"}}),!1}},A=()=>{let{track:e}=(0,a.st)(),{mutate:t}=(0,u.E)(),s=(0,i.V)();return(0,d.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await S({isClaudeElectronApp:s,onTokenReceived:e=>{t({channel_type:u.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},track:e})),[t,s,e])},z=()=>{let e=(0,d.useRef)(null),{account:t}=(0,n.YL)(),{mutate:s}=(0,u.E)(),a=(0,i.V)(),l=async()=>{let t;if(t=0===(0,o.Dk)().length?(0,o.Wp)(k):(0,o.Sx)(),!await (0,c.TT)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let s=(0,c.dG)(t);return e.current=s,{app:t,messaging:s}},m=async e=>{try{return await (0,c.gf)(e,{vapidKey:M})}catch(e){return(0,r.Cp)(e,{tags:{action:"getFCMToken"}}),null}},x=(0,d.useCallback)(e=>{s({channel_type:u.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[s]);return(0,d.useEffect)(()=>{var e;let t=!0,s=null;(async()=>{if(!a&&"Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await l();if(!e||!t)return;let a=await m(e);a&&t&&x(a),s=(0,c.xD)(e,e=>{var t,s;let a=(null==(t=e.data)?void 0:t.title)||"Claude",n={body:null==(s=e.data)?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},i=new Notification(a,n);i.onclick=()=>{var t;if(window.focus(),i.close(),null==(t=e.data)?void 0:t.payload){let t=function(e){if(!e)return null;try{let t=(0,y.Rf)(p,JSON.parse(e),{registry:_});if(!t.request||!t.method)return null;if("OpenChat"===t.method){let e=(0,w.rW)(t.request,j);if(null==e?void 0:e.conversationUuid){let t=e.conversationUuid;if(t.startsWith("/code/"))return{method:"OpenChat",targetUrl:t};return{method:"OpenChat",targetUrl:"/chat/".concat(t)}}}return null}catch(e){return null}}(e.data.payload);if(t){window.location.href=t.targetUrl;return}}window.location.href="/"}})}catch(e){(0,r.Cp)(e,{tags:{action:"setupNotifications"}})}})();let n=e=>{let t=e.data;(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl)};return null==(e=navigator.serviceWorker)||e.addEventListener("message",n),()=>{var e;t=!1,s&&s(),null==(e=navigator.serviceWorker)||e.removeEventListener("message",n)}},[t,a,x]),null}},42071:(e,t,s)=>{s.d(t,{E:()=>u,Hg:()=>o,gT:()=>c,vn:()=>d,zZ:()=>r});var a=s(77186),n=s(1761),i=s(87606);let l="notificationPreferences";var r=function(e){return e.FCM="FCM",e.APNS="APNS",e}({});let o=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid;return(0,a.Sk)("/api/organizations/".concat(t,"/notification/preferences"),{queryKey:[l,{orgUUID:t}],enabled:!!t})},c=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUUID:t}]})}})},d=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PATCH",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUUID:t}]})}})},u=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:["notificationChannels",{orgUUID:t}]})},meta:{noToast:!0}})}},49146:(e,t,s)=>{s.d(t,{S:()=>I,o:()=>T});var a=s(54568),n=s(69044),i=s(35438),l=s(97255),r=s(12165),o=s(43526),c=s(37783),d=s(45466),u=s(15429),m=s(86548),x=s(64515),f=s(21773),h=s(43342),p=s(85263),g=s(12777),v=s(94923),j=s(94753),b=s(30336),y=s(80004),w=s(77693),_=s(96986),N=s(70262),k=s(51627),M=s(3489),C=s(59388),S=s(47211),A=s(95038);let z={html:"html",htm:"html",xhtml:"html",css:"css",scss:"scss",sass:"sass",less:"less",js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",json:"json",yaml:"yaml",yml:"yaml",xml:"xml",svg:"svg",py:"python",rb:"ruby",php:"php",java:"java",c:"c",h:"c",cpp:"cpp",cc:"cpp",cxx:"cpp",hpp:"cpp",cs:"csharp",go:"go",rs:"rust",swift:"swift",kt:"kotlin",scala:"scala",dart:"dart",lua:"lua",pl:"perl",r:"r",sh:"bash",bash:"bash",zsh:"bash",fish:"fish",bat:"batch",cmd:"batch",ps1:"powershell",md:"markdown",markdown:"markdown",mermaid:"mermaid",mmd:"mermaid",tex:"latex",rst:"restructuredtext",asciidoc:"asciidoc",adoc:"asciidoc",csv:"csv",tsv:"tsv",toml:"toml",ini:"ini",conf:"ini",cfg:"ini",sql:"sql",graphql:"graphql",gql:"graphql",dockerfile:"dockerfile",dockerignore:"docker",gitignore:"git",gitattributes:"git",editorconfig:"editorconfig",diff:"diff",patch:"diff",nginx:"nginx",htaccess:"apacheconf"};function E(e){var t;return(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""}function I(e){return z[E(e).toLowerCase()]||"plaintext"}function T(e){let{path:t,size:s=16}=e;switch(E(t)){case"pdf":return(0,a.jsx)(n.T,{size:s});case"c":return(0,a.jsx)(i.s,{size:s});case"cs":return(0,a.jsx)(l.e,{size:s});case"cpp":return(0,a.jsx)(A.y,{size:s});case"css":return(0,a.jsx)(r.y,{size:s});case"csv":return(0,a.jsx)(o.F,{size:s});case"doc":case"docx":return(0,a.jsx)(c.j,{size:s});case"html":case"htm":case"xhtml":return(0,a.jsx)(d._,{size:s});case"jpg":case"jpeg":return(0,a.jsx)(u.a,{size:s});case"js":return(0,a.jsx)(m.u,{size:s});case"jsx":return(0,a.jsx)(x.m,{size:s});case"md":return(0,a.jsx)(f.C,{size:s});case"png":return(0,a.jsx)(h.K,{size:s});case"ppt":case"pptx":return(0,a.jsx)(p.z,{size:s});case"py":return(0,a.jsx)(g.I,{size:s});case"rs":return(0,a.jsx)(v.q,{size:s});case"sql":return(0,a.jsx)(j.b,{size:s});case"svg":return(0,a.jsx)(b.V,{size:s});case"ts":return(0,a.jsx)(y.G,{size:s});case"tsx":return(0,a.jsx)(w.M,{size:s});case"txt":return(0,a.jsx)(_.r,{size:s});case"vue":return(0,a.jsx)(N.x,{size:s});case"xls":case"xlsx":return(0,a.jsx)(k.K,{size:s});case"zip":return(0,a.jsx)(M.g,{size:s});case"gif":case"bmp":case"webp":case"ico":return(0,a.jsx)(C.C,{size:s});default:return(0,a.jsx)(S.i,{size:s})}}},50361:(e,t,s)=>{s.d(t,{DD:()=>o,UU:()=>l,q_:()=>r});var a=s(87856),n=s(7620),i=s(92947);function l(){return new a.K({name:"claude-ai",version:"0.1.0"},{capabilities:{}})}async function r(e){let t=l();return await t.connect(e),t}function o(){let{servers:e}=(0,i.gt)();return(0,n.useCallback)(t=>{for(let s of e){let e=s.tools.find(e=>"".concat(s.name,":").concat(e.name)===t);if(e)return{tool:e,server:s}}return null},[e])}},50824:(e,t,s)=>{s.d(t,{b:()=>Q});var a=s(54568),n=s(9234),i=s(2019),l=s(94390),r=s(32987),o=s(7620),c=s(8458),d=s(7726),u=s(22529),m=s(28885),x=s(21740),f=s(41417),h=s(64786),p=s(90119),g=s(27261),v=s.n(g),j=s(62971),b=s(50582),y=s(9447),w=s(98518),_=s(12072),N=s(27062),k=s(46760),M=s(95675),C=s(56273),S=s(70028),A=s(1761),z=s(51121),E=s(56370),I=s(18179),T=s(37076),U=s(9786),L=s(93681),R=s(38583),O=s(17937),F=s(83755),D=s(11582),P=s(57622),B=s(34933),G=s(11134),W=s(75032),J=s(99513),V=s(81527);function H(e){let{conversationUUID:t,snapshot:s,closeShareModal:n,showShareModal:i,disabled:l,disabledReason:r}=e,c=(0,k.A)(),u=!!s,{addError:m}=(0,z.Y)(),{account:x,activeOrganization:h}=(0,A.YL)(),p=(0,A.mV)(),g=(0,d.mz)(t),v=null==g?void 0:g.project_uuid,{data:b}=(0,V.fo)(v),y=(null==s?void 0:s.uuid)?q(s.uuid):"",{copyToClipboard:_,didCopy:N}=(0,U.C)(),{mutateAsync:M,isPending:C}=(0,d.Du)(t),{mutate:E,isPending:D}=(0,d.gG)(t,null==s?void 0:s.uuid),P=(0,o.useCallback)(async()=>{try{await M({project_uuid:null==g?void 0:g.project_uuid})}catch(e){m(c.formatMessage({defaultMessage:"Something went wrong while sharing this conversation. Please refresh the page.",id:"bMqfGRVujK"}))}},[M,m,null==g?void 0:g.project_uuid,c]),{track:B}=(0,w.st)(),G=(0,o.useCallback)(()=>{u?(B({event_key:"chat.share.modal.unshare_button.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),E()):(B({event_key:"chat.share.modal.share_button.clicked",conversation_uuid:t}),P())},[u,E,P,B,t,null==s?void 0:s.uuid]);return(0,a.jsx)(T.aF,{title:u?c.formatMessage({defaultMessage:"Chat shared",id:"svB/EMJSZy"}):c.formatMessage({defaultMessage:"Share chat",id:"bXa+lJhlYV"}),isOpen:i,onClose:n,modalSize:"lg",hasCloseButton:!0,children:x?(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)($,{upToDate:null==s?void 0:s.up_to_date,upsertSnapshot:P,isShared:!!u,disabled:l,disabledReason:r,isRaven:p})}),(0,a.jsx)(K,{isShared:u,project:b,orgName:null==h?void 0:h.name,toggleShare:G,isRaven:p}),u&&(0,a.jsxs)("button",{className:"w-full flex items-center justify-between bg-inherit h-auto text-text-300 border border-border-300 rounded-md px-3 py-2 cursor-pointer hover:bg-bg-300/50",onClick:()=>{B({event_key:"chat.share.open_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),window.open(q((null==s?void 0:s.uuid)||""),"_blank")},children:[(0,a.jsx)("span",{className:"truncate",children:q((null==s?void 0:s.uuid)||"")}),(0,a.jsx)(L.F,{size:16})]}),!p&&(0,a.jsxs)("div",{className:"flex flex-row gap-1.5 rounded-lg bg-bg-400 p-2 text-text-300 text-xs",children:[(0,a.jsx)(R.R,{size:16,className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(j.A,{defaultMessage:"Don’t share personal information or third-party content without permission, and see our <usagePolicyLink>Usage Policy</usagePolicyLink>.",id:"RkAGrm1doc",values:{usagePolicyLink:e=>(0,a.jsx)(S.LegalLink,{type:"aup",className:"hover:text-text-100 underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-2 flex w-full items-center gap-2",children:u?(0,a.jsx)(f.$,{size:"lg",variant:N?"outline":"primary",onClick:()=>{B({event_key:"chat.share.copy_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),_(y)},prepend:N?(0,a.jsx)(O.r,{size:16}):(0,a.jsx)(F.N,{size:16}),children:N?(0,a.jsx)(j.A,{defaultMessage:"Copied",id:"p556q3uvbn"}):(0,a.jsx)(j.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}):(0,a.jsx)(f.$,{size:"lg",loading:C||D,onClick:G,children:(0,a.jsx)(j.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})]}):(0,a.jsx)("div",{className:"mb-4 mt-8 flex h-full w-full items-center justify-center",children:(0,a.jsx)(I.Loading,{})})})}let q=e=>new URL("/share/".concat(e),window.location.origin).toString();function K(e){let{isShared:t,orgName:s,project:n,toggleShare:i,isRaven:l}=e,o=(0,a.jsxs)("button",{className:(0,r.A)("border-border-300 relative flex flex-row items-center justify-between gap-2 w-full rounded-xl border text-left !py-2 !px-3",t?"!bg-bg-000 text-text-000 cursor-pointer":"text-text-300 cursor-default"),children:[(0,a.jsx)(Y,{state:t?"shared":"private",orgName:s,project:n,isRaven:l}),t&&(0,a.jsx)(W.a,{size:14,className:"right-3.5 top-3.5 text-text-000"})]});return t?(0,a.jsxs)(E.ms,{align:"start",trigger:o,children:[(0,a.jsx)(E.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(Y,{state:"private",isCurrentState:!t,orgName:s,project:n,isRaven:l})}),(0,a.jsx)(E.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(Y,{state:"shared",isCurrentState:t,orgName:s,project:n,isRaven:l})})]}):(0,a.jsx)("div",{children:o})}function Y(e){let{state:t,isCurrentState:s,orgName:n,project:i,isRaven:l}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("span",{className:"inline-flex flex-row items-center justify-between gap-3 max-w-full overflow-hidden",children:[(0,a.jsxs)("span",{className:"inline-flex flex-row items-center gap-1.5 max-w-full",children:[(0,a.jsxs)("span",{className:"text-text-300 shrink-0",children:["private"===t&&(0,a.jsx)(D.c,{size:18}),"shared"===t&&l&&(0,a.jsx)(P.m,{size:18}),"shared"===t&&!l&&(0,a.jsx)(B.q,{size:18})]}),(0,a.jsxs)("p",{className:(0,r.A)("text-ellipsis overflow-hidden",s&&"font-medium text-text-000"),children:["private"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{defaultMessage:"Private (only you have access)",id:"EsW/fizDS4"}),"\xa0",s&&"private"!==t&&(0,a.jsx)("span",{className:"text-text-300 text-sm font-normal",children:(0,a.jsx)(j.A,{defaultMessage:"(Unshare this chat)",id:"EZEp1AdoRv"})})]}),"shared"===t&&l&&(0,a.jsx)(j.A,{defaultMessage:"Shared (anyone in {scope} can view)",id:"mG1NQd3Jzv",values:{scope:(null==i?void 0:i.is_private)?i.name:n}}),"shared"===t&&!l&&(0,a.jsx)(j.A,{defaultMessage:"Public (anyone on the web can view)",id:"no0TFMuRD0"})]})]}),s&&(0,a.jsx)(J.J,{size:16,weight:"bold",className:"text-accent-secondary-100 shrink-0"})]})})}function $(e){let{upToDate:t,isShared:s,upsertSnapshot:n,disabled:i,disabledReason:l="",isRaven:r}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,a.jsx)("div",{className:"text-text-300 flex flex-row items-center gap-1 text-sm",children:s?(0,a.jsx)(a.Fragment,{children:r&&(t?(0,a.jsx)(j.A,{defaultMessage:"Future messages aren’t included",id:"YiRN6e1JBr"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{defaultMessage:"New messages since last shared",id:"RnySEeXsUF"}),(0,a.jsx)(_.m,{tooltipContent:i?l:(0,a.jsx)(j.A,{defaultMessage:"Share the most recent chat content",id:"oAf7Y+LN9j"}),children:(0,a.jsx)(f.$,{variant:"underline",size:"unset",className:"ml-1 gap-1",onClick:n,prepend:(0,a.jsx)(G.P,{}),disabled:i,children:(0,a.jsx)(j.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})]}))}):(0,a.jsx)(j.A,{defaultMessage:"Only messages up until now will be shared",id:"OUOkOQvr8p"})})})}function X(e){var t;let{controlsSidebarIsOpen:s,closeControlsSidebar:n,openControlsSidebar:i,conversationUUID:l,isStreaming:c,wiggleFilesCount:u=0,isTemporary:x}=e,g=(0,k.A)(),v=(0,N.fS)("claudeai_beam").value,b=(0,p.V)(h.E_),y=function(e){let{track:t}=(0,w.st)(),{data:s}=(0,d.O2)(e.conversationUUID),[a,n]=(0,o.useState)(!1),i=(0,o.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUUID}),n(!0)},[t,e.conversationUUID]),l=!!(null==s?void 0:s.snapshot),r=l||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),c=e.isStreaming||!l&&!(null==s?void 0:s.shareable);return{conversationUUID:e.conversationUUID,showShareModal:a,openShareModal:i,closeShareModal:()=>n(!1),isShared:l,showShareFlow:r,disabled:c,...s}}({conversationUUID:l,isStreaming:c}),{isDrawerExpanded:S,setIsDrawerExpanded:A}=(0,M.x)(),{dispatchChatResource:z}=(0,C.i)(),E=!!i&&!!n&&!s;return(0,a.jsxs)("div",{className:(0,r.A)("flex items-center gap-1","transition-opacity duration-300",s?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!E&&"hidden"),children:[y.showShareFlow&&!x&&(0,a.jsx)(_.m,{tooltipContent:null!=(t=y.disabled_reason)?t:b&&(0,a.jsx)(j.A,{defaultMessage:"Share chat",id:"bXa+lJhlYV"}),side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(f.$,{variant:b?"ghost":"secondary",size:b?"icon_sm":"default",onClick:y.openShareModal,disabled:y.disabled||!E,prepend:b&&(0,a.jsx)(m.SY,{}),children:!b&&(0,a.jsx)(j.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})}),u>0?(0,a.jsx)(_.m,{tooltipContent:g.formatMessage({defaultMessage:"Open sidebar",id:"+G35mRWa75"}),side:"bottom",children:(0,a.jsx)(f.$,{variant:"ghost",size:b?"icon_sm":"icon",onClick:()=>{S||(z({type:"CLEAR_SELECTED"}),A(!0))},disabled:!E,children:v?(0,a.jsx)(m.EZ,{}):(0,a.jsx)(m.nk,{})})}):null,b&&(0,a.jsx)(_.m,{tooltipContent:(0,a.jsx)(j.A,{defaultMessage:"New chat",id:"ATDyLPIoxz"}),side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(f.$,{href:"/new",size:"icon_sm",variant:"flat",disabled:!E,className:"ml-1",children:(0,a.jsx)(m.OM,{size:16})})})}),y.showShareFlow&&(0,a.jsx)(H,{...y})]})}let Z=(0,o.memo)(function(e){let{conversationUUID:t,name:s,isInteractive:n=!0,sharedBy:i,project:l,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:g,isStreaming:w,isSharedChat:_,wiggleFilesCount:N=0}=e,{data:k}=(0,d.Bq)(t,{enabled:!_}),M=!!l&&!l.is_harmony_project,C=(0,p.V)(h.E_);return(0,a.jsxs)(y.z,{className:(0,r.A)("h-12",!C&&"-mb-6"),contentClassName:"gap-6 pr-2",sticky:!0,children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 shrink flex-col md:flex-row md:items-center",children:[M&&(0,a.jsx)(v(),{href:"/project/".concat(l.uuid),className:"text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 max-md:font-base font-large",children:(0,a.jsxs)("div",{className:"truncate",children:[l.name," ",(0,a.jsx)("span",{className:"opacity-50",children:"/"})]})}),(0,a.jsx)("div",{className:"flex min-w-0 shrink-1 items-center max-md:font-base font-large group",children:n&&k?k.is_temporary?(0,a.jsxs)("div",{className:"flex flex-row items-center text-text-300 gap-2 cursor-default",children:[(0,a.jsx)(x.X3,{}),(0,a.jsx)(u.YX,{id:"jasmine_sapphire_rocket"})]}):(0,a.jsx)(b.p,{conversation:k,initialName:s,trigger:(0,a.jsx)(f.$,{variant:"ghost",size:"default",className:"!text-text-000 !shrink gap-1 !px-1 !py-0 !scale-100 !h-7",append:(0,a.jsx)(m.bi,{size:16}),"data-testid":"chat-menu-trigger",children:(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"truncate",children:s.length>0?s:(0,a.jsx)(j.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}):(0,a.jsx)("div",{className:"truncate",children:s.length>0?s:(0,a.jsx)(j.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,a.jsxs)("div",{className:"right-3 flex gap-2",children:[i&&(0,a.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 font-base",children:(0,a.jsx)(j.A,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!_&&(0,a.jsx)(X,{conversationUUID:t,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:g,isStreaming:w,wiggleFilesCount:N,isTemporary:null==k?void 0:k.is_temporary})]})]})});function Q(e){let{headerProps:t,mainElement:s,drawerElement:d,auxilaryElement:u,isDrawerOpen:m,autoscrollRef:x,autoscrollDisabled:f,rightSidebarElement:h}=e,[p,g]=(0,o.useState)(!1),v=(0,o.useRef)(null),j=(0,o.useRef)(null),b=(0,o.useRef)(null),y=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:w}=(0,M.x)(),_=(0,i.F)("md");(0,o.useEffect)(function(){let e=!0;if(!j.current||!v.current||!N.current||!b.current)return;let t=v.current,s=j.current,a=b.current;if(_){let e=m?window.innerWidth/2-c.r:s.getBoundingClientRect().width;a.style.width="".concat(e,"px")}let n=Date.now(),i=m?0:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return m&&(requestAnimationFrame(function i(){if(!e)return;let l=(Date.now()-n)/220,r=50*l;if(l>=1||!_){t.style.flex=String(50),s.style.flex=String(50),a.style.width="auto";return}t.style.flex=String(100-r),s.style.flex=String(r),requestAnimationFrame(i)}),y.current.interacted=!0),!m&&y.current.interacted&&requestAnimationFrame(function l(){if(!e)return;let r=(Date.now()-n)/220,o=i-r*i;if(r>=1||!_){t.style.flex=String(100),s.style.flex=String(0),a.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(l)}),()=>{e=!1}},[m]);let[N,k]=(0,l.w)();return(0,o.useEffect)(()=>{if(!j.current||!v.current||!N.current)return;let e=N.current.getBoundingClientRect(),t=v.current.getBoundingClientRect();if(window.innerWidth<768||t.width>420)return;let s=420/e.width*100;v.current.style.flex=String(s),j.current.style.flex=String(100-s)},[k.width,k.height,N]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,r.A)("flex flex-1 h-screen w-full overflow-hidden relative",p&&"select-none"),ref:N,onMouseUp:function(){g(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{var t;if(!p||!j.current||!v.current||!N.current)return;let s=N.current.getBoundingClientRect(),a=v.current.getBoundingClientRect(),n=(t=e.clientX-a.left,Math.min(Math.max(t,420),s.width-240)/s.width*100);v.current.style.flex=String(n),j.current.style.flex=String(100-n)},children:[(0,a.jsxs)("div",{ref:v,className:"h-screen flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,a.jsx)(Z,{...t}),(0,a.jsx)(n.Z,{ref:x,disabled:f,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,a.jsxs)("div",{className:(0,r.A)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!m&&"hidden"),onMouseDown:function(){g(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,a.jsx)("div",{className:(0,r.A)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",p&&"!bg-accent-secondary-000")}),(0,a.jsx)("div",{className:(0,r.A)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",p&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,a.jsx)("div",{ref:j,className:(0,r.A)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",m?"max-md:flex-1":"max-md:hidden",p&&"pointer-events-none"),style:{flex:"0 0"},children:(0,a.jsxs)("div",{ref:b,className:"flex flex-col h-full overflow-hidden",children:[(0,a.jsx)("div",{className:"h-12 md:hidden bg-bg-500 bg-opacity-60",onClick:()=>{w(!1)}}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:d})]})}),h]}),null!=u?u:null]})}},55563:(e,t,s)=>{s.d(t,{z:()=>x});var a=s(54568),n=s(56340),i=s(89697),l=s(41417),r=s(12072),o=s(9786),c=s(32987),d=s(46760),u=s(62971),m=s(92479);let x=e=>{let{className:t,code:s,codeTagProps:l,language:r,title:d}=e,{codeStyle:u}=(0,i.V)(),{didCopy:x,copyToClipboard:h}=(0,o.C)();return(0,a.jsxs)("div",{className:(0,c.A)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,a.jsx)(f,{language:r,title:d,handleCopy:()=>{h(s)},didCopy:x}),(0,a.jsx)(m.A,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:l,language:r,PreTag:"div",style:u,renderer:n.G,wrapLongLines:!0,children:s})]})},f=e=>{let{handleCopy:t,didCopy:s,language:n,title:i}=e,m=(0,d.A)();return(0,a.jsxs)("div",{className:"flex justify-between items-center h-3",children:[(0,a.jsx)("p",{className:(0,c.A)("text-text-300 text-[0.6875rem]",i?"font-ui font-medium tracking-tight":"font-mono font-[450]"),children:i||n}),(0,a.jsx)(r.m,{side:"bottom",tooltipContent:(0,a.jsx)(u.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),children:(0,a.jsx)(l.$,{"aria-label":m.formatMessage({defaultMessage:"Copy to clipboard",id:"aCdAsIsVv0"}),size:"icon_sm",variant:"ghost",className:"!-mr-1 !w-6 !h-6",onClick:t,children:(0,a.jsx)(o.u,{didCopy:s,className:"text-text-500"})})})]})}},56326:(e,t,s)=>{s.d(t,{$:()=>r,Q:()=>l});var a=s(54568),n=s(7620);let i=n.createContext({renderToolUseCell:void 0}),l=()=>n.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,n.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,a.jsx)(i.Provider,{value:l,children:s})}},58977:(e,t,s)=>{s.d(t,{g:()=>tI,v:()=>tE});var a=s(42977),n=s(54568),i=s(7726),l=s(57931),r=s(97527),o=s(66442),c=s(8974),d=s(57067),u=s(77187),m=s(85644),x=s(45483),f=s(96784),h=s(1761),p=s(2341),g=s(55554),v=s(90510),j=s(22529),b=s(61547),y=s(12072),w=s(54890),_=s(27062),N=s(85544),k=s(32987),M=s(37463),C=s(70272),S=s.n(C),A=s(68864),z=s(64155),E=s(27261),I=s.n(E),T=s(62942),U=s(7620),L=s(46760),R=s(62971),O=s(75006),F=s(81527),D=s(56147),P=s(80731),B=s(48367),G=s(97830),W=s(84137),J=s(39741);async function V(e,t,s){try{let a=new URL("/api/organizations/".concat(e,"/conversations/").concat(t,"/wiggle/list-files"),window.location.origin);void 0!==s&&a.searchParams.append("prefix",s);let n=await fetch(a.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)return[];return(await n.json()).files||[]}catch(e){return[]}}function H(e,t,s,a){let[n,i]=(0,U.useState)([]),[l,r]=(0,U.useState)(!1),[o,c]=(0,U.useState)(null),{activeOrganization:d}=(0,h.YL)(),{value:u}=(0,_.fS)("trials_and_tribulations_of_high_school_football"),m=u&&!a,x=(0,U.useCallback)(async()=>{if(m&&t&&(null==d?void 0:d.uuid)){r(!0),c(null);try{let s=(await V(d.uuid,t,e)).map(e=>{let t=e.split("/").pop()||e;return{path:e,name:t}});i(s)}catch(e){c("Failed to load files")}finally{r(!1)}}},[m,t,null==d?void 0:d.uuid,e]);return(0,U.useEffect)(()=>{m&&s&&x()},[m,s,x]),{files:n,isLoading:l,error:o,refetch:x}}s(97354);var q=s(70067);function K(e){var t;return!!Y(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function Y(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}var $=s(31417),X=s(85330),Z=s(28885),Q=s(41417),ee=s(22336),et=s(88346),es=s(56273),ea=s(11515),en=s(37711),ei=s(9786),el=s(98769),er=s(69307),eo=s(61437),ec=s(76761),ed=s(96377),eu=s(99272),em=s(58911),ex=s(49645),ef=s(89256),eh=s.n(ef),ep=s(94748),eg=s(22134);let ev=e=>{let{onClose:t,onBack:s,onDebug:a,title:i,isHidden:l,className:r}=e;return(0,n.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,n.jsx)(Q.$,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,n.jsx)(er.Z,{size:16})}),(0,n.jsx)("h2",{className:(0,k.A)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!a&&(0,n.jsx)(Q.$,{variant:"ghost",size:"icon_sm",onClick:a,disabled:l,children:(0,n.jsx)(eo.z,{size:16})})]}),(0,n.jsx)(Q.$,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,n.jsx)(ec.X,{size:16})})]})};function ej(e){let{compassStatus:t,onOpenSources:s}=e;if(!t.total_sources)return null;let a=(e=>{let t=new Map,s=new Map;for(let a of e)for(let e of a.annotated_snippets)for(let a of e.tool_calls)if("web_search"===a.tool_name||"web_fetch"===a.tool_name){let e=[];if("web_search"===a.tool_name){if(!a.output||"rich_content"!==a.output.type||!a.output.content)continue;e=a.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===a.tool_name){if(!a.output||"rich_link"!==a.output.type||!a.output.link.url)continue;e=[a.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),a="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=s.get(i);s.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,n.jsx)(ea.d,{url:a,size:14})})}catch(e){}}else if(a.output){let e=a.integration_name||a.tool_name,s="rich_content"===a.output.type?a.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+s,icon:(null==i?void 0:i.icon)||(0,n.jsx)(eg.r,{canShowLetterIcon:!0,size:14,iconUrl:a.server_icon_url||void 0,integrationName:a.integration_name||void 0,toolName:a.tool_name})})}let a=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(s.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return a.concat(i).slice(0,4-a.length)})(t.agents),i=a.length>0?a[0][1].count:0,l=t.total_sources-a.reduce((e,t)=>t[1].count+e,0);return 0===a.length?null:(0,n.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:(0,n.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[a.map((e,t)=>{let[s,{count:a,icon:l}]=e;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,n.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:s,children:s}),(0,n.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,n.jsx)(R.A,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:a}})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(M.P.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(a/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)}),l>0&&(0,n.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,n.jsx)(ed.H,{size:16,className:"text-text-300 mr-2"}),(0,n.jsx)("p",{children:(0,n.jsx)(R.A,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let eb=e=>{let{title:t,complete:s,className:a}=e;return(0,n.jsx)(M.P.h3,{className:(0,k.A)("text-base text-text-100 font-claude-response",a),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,n.jsx)(en.N,{children:t})},t)};function ey(e){let{title:t,description:s,numSources:a,onClick:i,complete:l}=e;return(0,n.jsxs)(M.P.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,n.jsx)(eb,{title:null!=s?s:t,complete:l}),(0,n.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===a?(0,n.jsx)(R.A,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,n.jsx)(R.A,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:a}})})]})}function ew(e){let{status:t,allSnippets:s,onOpenSources:a}=e,[i,l]=(0,U.useState)([]);return(0,U.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,W.mk)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,n.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,n.jsx)(ej,{compassStatus:t,onOpenSources:()=>a(!0)}),s&&s.length>0&&(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)(M.P.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,n.jsx)(ey,{...e,onClick:()=>a(!0,e.globalAgentIndex)},t))})})]})}function e_(e){let{data:t,onClose:s}=e,[a,i]=(0,U.useState)(!1),[l,r]=(0,U.useState)({sourcesOpen:!1}),{conversationUUID:o,organizationUUID:c,isShared:d,taskId:u}=t,{compassStatus:m}=(0,W.CH)({organizationUUID:c,conversationUUID:o,taskId:u,isShared:d});if(!m)return null;let x=(e,t)=>{r({sourcesOpen:e,index:t})},f=void 0,h=l.sourcesOpen||a;return(0,n.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,n.jsx)(M.P.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,n.jsx)(eN,{compassStatus:m,onClose:s,onDebug:f,handleOpenSources:x})}),(0,n.jsx)("div",{className:(0,k.A)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,n.jsx)(M.P.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:el.A.snappyOut},className:(0,k.A)("absolute top-0 left-0 right-0 bottom-0"),children:(0,n.jsx)(eC,{isHidden:!h,compassStatus:m,onBack:a?()=>i(!1):()=>x(!1),onClose:s,onDebug:f,isDebug:a,agentIndex:l.index})})]})}function eN(e){let{compassStatus:t,onClose:s,onDebug:a,handleOpenSources:i}=e,l=(0,L.A)(),r=(0,W.OQ)(t),o=t.status,c=(0,W.Nw)(t),d=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,total_sources:e.total_sources,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),m=N.P5.indexOf(o),x=[{title:o===N.zu.Starting||o===N.zu.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:c?(0,n.jsx)(W.GT,{thought:c,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!c},{title:o===N.zu.InitiatingAgents||o===N.zu.Searching?0===d?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:d}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:d}),titleIcons:(0,n.jsx)(W.mq,{hrefs:(0,W.mk)({agents:t.agents,n:3})}),children:(0,n.jsx)(ew,{allSnippets:u,status:t,onOpenSources:i}),shown:m>=2||t.agents.length>1,expandable:u.length>0},{title:o===N.zu.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:m>=4,expandable:!1}],f=x.filter(e=>e.expandable).length,h=x.findLastIndex(e=>!!e.expandable),p=(0,U.useRef)(h),[g,v]=(0,U.useState)(h),[j,b]=(0,U.useState)(!0),y=(0,U.useCallback)((e,t,s)=>{b(s),t?v(e):v(+(0===e))},[b,v]);(0,U.useEffect)(()=>{h!==p.current&&y(h,!0,!1)},[y,h]);let w=[N.zu.Cancelled,N.zu.Failed,N.zu.TimedOut].includes(t.status),_=x.filter(e=>e.shown).length;return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,n.jsx)(ev,{onClose:s,onDebug:a,title:r,className:"font-medium"}),(0,n.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[x.map((e,s)=>{let{expandable:a,shown:i,title:l,titleIcons:r,children:o}=e,c=w||s<_-1||t.status===N.zu.Completed;return(0,n.jsx)(ek,{title:l,titleIcons:r,noShimmer:c||w,complete:c,isExpanded:a&&g===s,snappyTransition:j,showLine:s<_-1||w||g===s,handleExpand:e=>y(s,e,!0),expandable:a,collapsible:f>1,shown:i,children:o},s)}),w&&(0,n.jsx)(ek,{title:t.status===N.zu.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:eh(),shown:w})]})]})}function ek(e){let{title:t,titleIcons:s,complete:a,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:c,snappyTransition:d,noShimmer:u,isError:m,showLine:x,children:f}=e;return!!r&&(0,n.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,n.jsx)("div",{className:(0,k.A)("transition-all w-2.5 h-2.5 rounded-full shrink-0",m?"bg-danger-200":a?"bg-text-500":"bg-accent-main-200")}),x&&(0,n.jsx)("div",{className:(0,k.A)("transition-all h-full -mb-1 w-[1px]",a?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,n.jsxs)("div",{className:"w-full flex flex-col",children:[(0,n.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>c(!o),disabled:!i||o&&!l,children:(0,n.jsxs)("h4",{className:(0,k.A)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",m&&"!text-danger-200"),children:[u?t:(0,n.jsx)(en.N,{children:t}),(0,n.jsx)(ex.N,{children:!!s&&!o&&(0,n.jsx)(M.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:s})}),!!i&&l&&(0,n.jsx)(eu.a,{className:(0,k.A)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,n.jsx)(ep.NG,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:d,className:"!max-h-none w-full",setIsExpanded:c,children:f})]})]})}function eM(e){var t,s;let{toolCall:a,isHidden:i}=e;if("web_fetch"===a.tool_name&&(null==(t=a.output)?void 0:t.type)==="rich_link"&&a.output.link.url){let{url:e,icon_url:t,title:s,subtitles:l}=a.output.link;return(0,n.jsx)(ep.aX,{isDisabled:i,isStreaming:!1,icon:(0,n.jsx)(ea.d,{fadeInOnLoad:!0,url:t,size:16}),text:(0,n.jsx)(R.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:s,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,n.jsx)(em.B,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return a.output?(0,n.jsx)(eg.K,{integrationName:a.integration_name||void 0,integrationIcon:a.server_icon_url||void 0,message:a.message,isExpandingDisabled:i,result:a.output,isStreaming:!1,isError:a.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null==(s=a.output)?void 0:s.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eC(e){var t;let{isHidden:s,compassStatus:a,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:c}=e,d=(0,U.useRef)(null),u=(0,L.A)(),m=c?!!(null==(t=a.agents[c])?void 0:t.completed_at):a.status===N.zu.Completed,x=void 0===c?null:a.agents[c].description||a.agents[c].name,f=function(e,t){let s=[];for(let a of t?[e.agents[t]]:e.agents)for(let e of a.annotated_snippets)for(let t of e.tool_calls)t.output&&s.push({toolCall:t,timestamp:e.complete&&a.completed_at||a.started_at});return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s.map(e=>{let{toolCall:t}=e;return t})}(a,c),h=void 0===c?a.total_sources:a.agents[c].total_sources;return(0,n.jsxs)("div",{className:(0,k.A)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,n.jsx)(ev,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:m?"":(0,n.jsx)(R.A,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{d.current&&(d.current.scrollTop=0)},500),r()}}),(0,n.jsxs)("div",{ref:d,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!x&&(0,n.jsx)(eb,{title:x,complete:m,className:"pt-1 pb-5"}),f.length>0?(0,n.jsx)("div",{className:"flex flex-col gap-4",children:f.map((e,t)=>(0,n.jsx)(eM,{toolCall:e,isHidden:s},t))}):(0,n.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,n.jsx)(R.A,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}var eS=s(30453),eA=s(23661),ez=s(41932);let eE=e=>{let{docUuid:t,projectUuid:s,goBack:a,onClose:i}=e,{data:l}=(0,ez.Rn)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:eA.R.UserUpload};return(0,n.jsx)(eS.f,{attachment:r,goBack:a,onClose:i})};var eI=s(30977),eT=s(7386),eU=s(32132),eL=s(38583),eR=s(62094),eO=s(98252),eF=s(49146),eD=s(85101),eP=s(74744),eB=s(7582),eG=s(29722),eW=s(89436);let eJ=e=>{let{projectUuid:t}=e,{data:s}=(0,F.fo)(t);return s?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(R.A,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-4",children:[(0,n.jsxs)(I(),{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,n.jsx)(eB.D,{size:16,className:"text-text-300 shrink-0"}),(0,n.jsx)("div",{className:"font-claude-response text-text-200 leading-tight tracking-tight",children:s.name})]}),(0,n.jsx)("div",{children:(0,n.jsx)(eW.t,{project:s,className:"text-text-400 text-xs"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col",children:(0,n.jsx)(eG.b,{isEditable:!1,project:s,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]})}):null};function eV(e){let{conversationUUID:t,projectUuid:s,wiggleSharedArtifacts:a,wiggleOutputFiles:i,wiggleScratchpadFiles:l,onSelectArtifactVersion:r,onSelectWiggleFile:o,onClose:c,onRefreshFiles:d}=e,{activeOrganization:u}=(0,h.YL)(),[m,x]=(0,U.useState)(!1),f=(0,L.A)(),[p,g]=(0,U.useState)(!1),v=0===i.length&&0===a.length&&0===l.length&&!s;return(0,n.jsxs)("div",{className:"py-2 px-6 overflow-auto h-full",children:[(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(Q.$,{variant:"ghost",size:"icon",disabled:m,onClick:async()=>{if(!m)try{x(!0),await d()}catch(e){}finally{x(!1)}},children:(0,n.jsx)(Z.Mv,{size:20,className:m?"text-text-500":""})}),(0,n.jsx)(Q.$,{variant:"ghost",size:"icon",onClick:c,children:(0,n.jsx)(ec.u,{size:20})})]}),v?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center text-sm text-text-400 p-4",children:(0,n.jsx)("p",{children:"No files found"})}):null,(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[i.length?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"font-medium px-1",children:(0,n.jsx)(R.A,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),i.length>1?(0,n.jsx)(Q.$,{variant:"ghost",prepend:(0,n.jsx)(eU.e,{}),className:"text-sm font-medium",onClick:()=>{(null==u?void 0:u.uuid)&&(0,eO.y)({filepaths:i.map(e=>e.path),orgUuid:u.uuid,conversationUuid:t,isShared:!1})},children:(0,n.jsx)(R.A,{defaultMessage:"Download all",id:"V1UrPNM96z"})}):null]}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:i.map(e=>(0,n.jsx)(eD._,{file:e,conversationUUID:t,onOpen:()=>{o(e.path)},isInSidebar:!0,isShared:!1},e.path))})]}):null,a.length?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"font-medium px-1",children:(0,n.jsx)(R.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:a.map(e=>(0,n.jsx)(Q.$,{variant:"ghost",className:"!justify-start !px-1",onClick:()=>{r(e.uuid)},children:e.title},e.uuid))})]}):null,l.length?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("button",{className:"flex font-medium items-center justify-between p-1 hover:bg-bg-300 rounded-md",onClick:()=>g(e=>!e),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(R.A,{defaultMessage:"Scratchpad",id:"Qb4YubxAW2"}),(0,n.jsx)(y.m,{tooltipContent:f.formatMessage({defaultMessage:"Files used to create artifacts",id:"T2w69cOLhV"}),side:"right",children:(0,n.jsx)(eL.m,{})})]}),(0,n.jsx)(eR.J,{className:(0,k.A)("transition",p?"rotate-90":"")})]}),(0,n.jsx)(eH,{isExpanded:p,children:(0,n.jsx)("div",{className:"flex flex-col gap-2",children:l.map(e=>(0,n.jsx)(Q.$,{variant:"ghost",prepend:(0,n.jsx)(eF.o,{path:e.path}),className:"!justify-start",onClick:()=>{o(e.path)},children:e.name},e.path))})})]}):null,s&&(0,n.jsx)(eJ,{projectUuid:s}),(0,n.jsx)(eq,{})]})]})}function eH(e){let{children:t,isExpanded:s}=e;return(0,n.jsx)(M.P.div,{className:"overflow-hidden shrink-0",tabIndex:-1,initial:{opacity:0,height:s?"auto":0},animate:s?"expanded":"collapsed",transition:{ease:"easeInOut",duration:.4},variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:t})}function eq(){let{chatResourceState:{files:e,attachments:t,syncSources:s},dispatchChatResource:a}=(0,es.i)();return e.length+s.length>0?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"font-medium px-1",children:(0,n.jsx)(R.A,{defaultMessage:"Content",id:"Jq3FDzj0/T"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:(0,n.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[e.map((e,t)=>(0,n.jsx)(eT.NM,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),t.map((e,t)=>(0,n.jsx)(eT.NM,{size:"stretch",file:e,handleClick:()=>a({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),s.map(e=>(0,n.jsx)(eP.br,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]})})]}):null}let eK=(0,U.memo)(function(e){var t,s,a,i,l;let{conversationUUID:r,onClose:o,isStreaming:c,projectUuid:d,sendMessage:u,isOpen:m,messages:x,isTemporary:f=!1}=e,{activeOrganization:p}=(0,h.YL)(),{chatResourceState:{selectedItem:g,artifacts:v,activeMessageUUID:j,attachments:b,files:y},dispatchChatResource:w}=(0,es.i)(),N=null==p?void 0:p.uuid,{value:k}=(0,_.fS)("trials_and_tribulations_of_high_school_football"),M=H("",r,m,f),C=(0,U.useMemo)(()=>{var e;let t=[],s=[];return null==(e=M.files)||e.forEach(e=>{"/mnt/user-data/README.md"!==e.path&&(e.path.startsWith("/mnt/user-data/uploads/")||(e.path.startsWith("/mnt/user-data/outputs/")?t.push(e):s.push(e)))}),{output:t,scratchpad:s}},[M.files]),S=(0,ee.f)({conversationUUID:r,source:"w"}),A=null==(t=S.data)?void 0:t.artifact_versions,z=!!((null==A?void 0:A.length)||(null==(s=C.output)?void 0:s.length)||(null==(a=C.scratchpad)?void 0:a.length)),E=(0,U.useMemo)(()=>{if(!g||"artifact"!==g.type||!A)return;let e=A.find(e=>e.uuid===(null==g?void 0:g.versionUUID));if(e)return{id:e.artifact_uuid,title:e.title,language:e.code_language,type:e.artifact_type,version_uuid:e.uuid,versions:[{command:"create",uuid:e.uuid,resultState:e.result_state,content:e.result_state,message:e.message_uuid,created_at:e.created_at,source:e.source,isClosed:!0}]}},[A,g]),I=(0,U.useCallback)(async()=>{k&&await Promise.all([M.refetch(),S.refetch()])},[k,M,S]),T=(0,X.f)({artifactContext:(null==g?void 0:g.type)==="artifact"&&g.versionUUID?{uuid:g.versionUUID,type:"artifact_version"}:void 0}),L=(0,$.y)(b,y,N,d),R=(0,U.useMemo)(()=>({claudeComplete:T,getFile:L}),[T,L]),O=(0,U.useCallback)(e=>{(null==g?void 0:g.type)==="artifact"&&w({type:"SELECT_ARTIFACT",id:g.id,versionUUID:e})},[g,w]),F=(0,U.useCallback)((e,t)=>{w({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[w]),D=(0,U.useCallback)(e=>w({type:"SELECT_DOC",id:e}),[w]),P=(0,U.useCallback)(()=>w({type:"CLEAR_SELECTED"}),[w]);(0,U.useEffect)(()=>{!g&&m&&I()},[m,x.length,null==g?void 0:g.type]);let B=(null==g?void 0:g.type)==="artifact"&&v[g.id]?v[g.id]:E,G=(0,n.jsx)(eV,{conversationUUID:r,projectUuid:d,wiggleSharedArtifacts:null!=(l=null==(i=S.data)?void 0:i.artifact_versions)?l:[],wiggleOutputFiles:C.output,wiggleScratchpadFiles:C.scratchpad,onClose:o,onRefreshFiles:I,onSelectWiggleFile:e=>{F(e,j||"")},onSelectArtifactVersion:e=>{w({type:"SELECT_ARTIFACT",id:"",versionUUID:e})}});return(0,n.jsx)(n.Fragment,{children:(null==g?void 0:g.type)==="artifact"&&B?(0,n.jsxs)("div",{className:"relative h-full",children:[z&&(0,n.jsx)("div",{className:"absolute top-2 left-3 z-50",children:(0,n.jsx)(Q.$,{variant:"ghost",size:"icon_sm",onClick:P,className:"bg-bg-000/90 backdrop-blur-sm",children:(0,n.jsx)(Z.nk,{size:20})})}),(0,n.jsx)(et.CV,{isStreaming:c,artifact:B,selectedArtifactMessageUUID:j,selectedArtifactVersionUUID:g.versionUUID,setSelectedArtifactVersionUUID:O,onClose:o,projectUuid:d,selectDoc:D,sendMessage:u,richSandboxCapabilities:R,isOpen:m,isTemporary:f})]}):(null==g?void 0:g.type)!=="artifact"||v[g.id]?(null==g?void 0:g.type)==="attachment"?(0,n.jsx)(eS.f,{goBack:()=>w({type:"CLEAR_SELECTED"}),attachment:g.attachment,onClose:o}):(null==g?void 0:g.type)==="compass"?(0,n.jsx)(e_,{data:g.data,onClose:o,goBack:P}):d&&(null==g?void 0:g.type)==="doc"?(0,n.jsx)(eE,{docUuid:g.id,projectUuid:d,onClose:o,goBack:()=>w({type:"CLEAR_SELECTED"})}):(null==g?void 0:g.type)==="file"?(0,n.jsx)(eI.y,{file:{path:g.path,name:g.path.split("/").pop()||g.path},messages:x,showBackButton:g.path.startsWith("/mnt/user-data/outputs/"),goBack:()=>w({type:"CLEAR_SELECTED"}),onClose:o,conversationUuid:r,projectUuid:d,isTemporary:f,isShared:!1}):!g&&k?G:null:(0,n.jsx)(et.CV,{isStreaming:c,artifact:void 0,selectedArtifactMessageUUID:j,selectedArtifactVersionUUID:(null==g?void 0:g.type)==="artifact"?g.versionUUID:void 0,setSelectedArtifactVersionUUID:O,onClose:o,projectUuid:d,selectDoc:D,sendMessage:u,richSandboxCapabilities:R,isOpen:m,isTemporary:f})})});var eY=s(51121),e$=s(18395);function eX(e){let{conversationUuid:t,message:s}=e,a=(0,T.useRouter)(),i=(0,eY.Y)(),[l,r]=(0,U.useState)(!1);return(0,n.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-ui tracking-tight z-10 p-6 ",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,n.jsx)("div",{className:"text-lg",children:(0,n.jsx)(R.A,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(Q.$,{onClick:()=>a.push("/new"),children:(0,n.jsx)(R.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,n.jsx)(Q.$,{variant:"secondary",onClick:()=>r(!0),children:(0,n.jsx)(R.A,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,n.jsx)(e$.B,{conversationUuid:t,message:s,requestedFeedbackType:"chat_ended",setRequestedFeedbackType:()=>{},isOpen:l,onClose:()=>{r(!1)},onSuccess:()=>i.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var eZ=s(60098),eQ=s(74039),e0=s(77186),e1=s(53248),e2=s(50824),e3=s(56326),e5=s(98518),e6=s(10158),e4=s(46612),e7=s(92075);function e9(){let e=(0,a._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return e9=function(){return e},e}let e8=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],te=e=>{let{long:t}=e;return(0,n.jsx)("a",{className:"underline",href:e4.Z1,target:"_blank",rel:"noreferrer",children:t?(0,n.jsx)(R.A,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,n.jsx)(R.A,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},tt={consumer_restricted_mode:[{isDismissible:!1,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.A,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,n.jsx)(te,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.A,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,n.jsx)(te,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.A,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,n.jsx)(te,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(R.A,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(R.A,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(R.A,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function ts(e){let{isClaudeDot:t,content:s,isDismissible:a,handleDismiss:i}=e;return(0,n.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,n.jsx)(tn,{$isFloating:t,children:(0,n.jsxs)("div",{className:"items-top flex justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:s}),a&&i&&(0,n.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,n.jsx)(ec.X,{size:24})})]})})})}function ta(e){let{conversationUuid:t}=e,s=(0,e5.st)(),a=(0,e6.fZ)(),{account:i,activeOrganization:l}=(0,h.YL)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:c}=(0,e7.iD)(),{data:d}=(0,e7.Nj)(null==l?void 0:l.uuid),u=(0,e6._r)().ipCountry,m=(null==d?void 0:d.active_flags)&&(null==d?void 0:d.active_flags.map(e=>e.type)),{shownFlagType:x,shownFlagDetails:f}=function(e,t){let s=e8.findIndex(e=>null==t?void 0:t.includes(e)),a=e8[s];if(!a)return{shownFlagType:null,shownFlagDetails:null};let n=tt[a].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===n.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:a,shownFlagDetails:n[0]}}(u,m);if((0,U.useEffect)(()=>{r&&o&&x&&s.track({event_key:"ts.banner.shown",flag_type:x,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,x,t,r,o,u]),!x||!f)return;let{isDismissible:p,content:g}=f,v=async()=>{if(!p)return;let e=[x];"consumer_second_warning"===x&&(null==m?void 0:m.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>c({flagType:e})))};return(0,n.jsx)(ts,{isClaudeDot:a,content:g,isDismissible:p,handleDismiss:v})}let tn=v.J.div(e9(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var ti=s(68020),tl=s(47211),tr=s(21599),to=s(26237),tc=s(79900),td=s(99318),tu=s(8884);let tm=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],tx=e=>{var t;let{selectedLabel:s,disabled:a}=e,l=(0,L.A)(),{track:r}=(0,e5.st)(),o=new Map([["apps_and_websites",l.formatMessage({defaultMessage:"Apps and websites",id:"HC16Tj5QBT"})],["documents_and_templates",l.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",l.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",l.formatMessage({defaultMessage:"Productivity tools",id:"t/RMra2cqp"})],["creative_projects",l.formatMessage({defaultMessage:"Creative projects",id:"gZSnjM59XP"})],["quiz_or_survey",l.formatMessage({defaultMessage:"Quiz or survey",id:"yyPDfhkUT7"})],["start_from_scratch",l.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),c=new Map(Array.from(o,e=>e.reverse())),d=new Map([["apps_and_websites",ti.E],["documents_and_templates",tl.i],["games",tr.H],["productivity_tools",to.l],["creative_projects",tc.e],["quiz_or_survey",td.S],["start_from_scratch",tu.f]]),{sendTransparentMessage:u,conversation:m}=(0,eZ.o)(),{mutate:x}=(0,i.HF)(null==m?void 0:m.id),f=null!=(t=c.get(null!=s?s:""))?t:"default",h=async e=>{o.has(e)&&(r({event_key:"artifact.studio.create_mode_selected",create_mode:e}),(null==m?void 0:m.id)&&x({settings:{enabled_monkeys_in_a_barrel:!1}}),await u(o.get(e)))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-claude-response-body pl-2 mt-1",children:(0,n.jsx)(R.A,{defaultMessage:"Let’s get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-stretch w-full",children:tm.map(e=>{let t=d.get(e);return(0,n.jsx)("div",{className:(0,k.A)("relative w-full h-full min-h-[3.5rem] sm:h-28 p-3 sm:p-3.5 font-base bg-bg-000 rounded-lg transition-colors group",f===e&&"border-0.5 text-text-100 bg-bg-000 shadow-sm",("default"!==f&&f!==e||"default"===f&&a)&&"text-text-500 bg-bg-000/50 border-0.5 border-border-300","default"===f&&!a&&"border-0.5 border-border-300 text-text-300 hover:border-text-200 hover:bg-bg-000 hover:text-text-100 cursor-pointer shadow-sm"),onClick:async()=>{"default"!==f||a||await h(e)},children:(0,n.jsxs)("div",{className:"flex flex-row sm:flex-col items-center sm:items-start justify-center sm:justify-start h-full w-full gap-3 sm:gap-0",children:[t&&(0,n.jsx)(t,{size:20,weight:"light",className:(0,k.A)("transition-transform duration-300 ease-out shrink-0 sm:absolute sm:bottom-4 sm:right-4","default"===f&&!a&&"group-hover:-rotate-2 sm:group-hover:rotate-2 group-hover:scale-105")}),(0,n.jsx)("span",{className:"flex-1 text-left",children:o.get(e)})]})},e)})})]})};var tf=s(95675);let th=e=>{var t,s,a,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:c,invalidator:d}=e,[u,m]=(0,U.useState)(0),x=(0,U.useCallback)(()=>{var e,t,s,a;let n=(null==(e=l.lastAssistantMessage.current)?void 0:e.clientHeight)||0,i=(null==(t=l.lastHumanMessage.current)?void 0:t.clientHeight)||0,r=(null==(s=l.chatInput.current)?void 0:s.clientHeight)||0,o=(null==(a=l.extras.current)?void 0:a.clientHeight)||0,c=Math.max(window.innerHeight-i-n-o-r-110,0);c!==u&&m(c)},[l,u]);return(0,U.useLayoutEffect)(()=>{x()},[d,x,null==(t=l.lastAssistantMessage.current)?void 0:t.clientHeight,null==(s=l.lastHumanMessage.current)?void 0:s.clientHeight,null==(a=l.extras.current)?void 0:a.clientHeight,null==(i=l.chatInput.current)?void 0:i.clientHeight]),(0,U.useLayoutEffect)(()=>(window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)),[x]),(0,U.useLayoutEffect)(()=>{r&&(setTimeout(()=>{var e;null==(e=c.current)||e.scrollToBottomIfPinned("smooth")},0),o(!1))},[r,o,c]),(0,U.useEffect)(()=>{var e;null==(e=c.current)||e.scrollToBottomIfPinned("instant")},[c]),(0,n.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function tp(){return(0,n.jsx)(M.P.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-100 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,n.jsxs)("h2",{className:"font-title flex flex-col items-center justify-center gap-2 sm:flex-row",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(b.a,{state:"waiting"})}),(0,n.jsx)(R.A,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var tg=s(71710);let tv="/Spark/",tj=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],tb="".concat(tv,"/Check.svg"),ty=O.z.object({changeTitle:O.z.boolean().optional(),titleDelayMs:O.z.number().optional(),changeFavicon:O.z.boolean().optional(),faviconDelayMs:O.z.number().optional(),playSound:O.z.boolean().optional()}),tw={};var t_=s(98878),tN=s(77763),tk=s(11062);function tM(e){let{chatId:t,chatName:s,onSend:a}=e,{activeOrganization:n}=(0,h.YL)(),i=(0,e0.mn)(),l=(0,U.useRef)(!1);return(0,t_._v)(tN.A.ChatInfo,{getCurrentChatInfo:()=>Promise.resolve({chatId:t,chatName:s}),sendToChatWithPayload:e=>e.chatId===t&&!l.current&&!!n&&(l.current=!0,(async()=>{try{let t=[];if("images"in e)for(let s of e.images)try{t.push(...await (0,tk.bl)(s.base64,s.mimeType,n.uuid,i))}catch(e){}else if(e.imageBase64&&e.imageMimeType)try{t.push(...await (0,tk.bl)(e.imageBase64,e.imageMimeType,n.uuid,i))}catch(e){}return await a({prompt:e.text,files:t}),!0}catch(e){return!1}finally{l.current=!1}})(),!0)},[t,s,n,i,a]),null}var tC=s(69347),tS=s(77336);function tA(){let e=(0,a._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return tA=function(){return e},e}let tz=()=>{let[e,t]=(0,U.useState)(""),s=(0,L.A)(),a=(0,U.useMemo)(()=>[s.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),s.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),s.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[s]),i=(0,U.useMemo)(()=>s.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[s]),l=(0,U.useMemo)(()=>s.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[s]);return(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(a[Math.floor(Math.random()*a.length)])},5e3);return()=>clearTimeout(e)},[a]),(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(i)},15e3);return()=>clearTimeout(e)},[i]),(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(l)},3e4);return()=>clearTimeout(e)},[l]),(0,n.jsx)(M.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:e})};function tE(e){var t,s,a,v,M,C,E,V,$,X,Z,Q,ee,et,ea;let{changeDisplayedConversationPath:en,conversationTitle:ei,conversationUUID:el,editMessage:er,isStreaming:eo,isTemporary:ec=!1,isLoading:ed,messages:eu,name:em,onRetry:ex,onSend:ef,projectUuid:eh,setPersonalizedStyleCallback:ep,onToolAllow:eg}=e,{account:ev,activeOrganization:ej}=(0,h.YL)(),{selectedTier:eb}=(0,g.t)(),ey=(0,p.B)(),ew=(0,L.A)(),{value:e_}=(0,_.fS)("claudeai_beam"),eN=(0,U.useRef)(null),ek=(0,U.useRef)(null);ek.current=null==(t=eu[eu.length-1])?void 0:t.uuid;let{chatResourceState:eM,dispatchChatResource:eC}=(0,es.i)(),{serverLastChatMessageWarningProps:eS,updateServerLastChatMessageWarningPropsForNewMessage:eA}=function(e,t){let[s,a]=(0,U.useState)(null),n=function(e){let{activeOrganization:t}=(0,h.YL)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:a}=(0,e0.L2)(s,"POST",{meta:{noToast:!0}});return(0,U.useCallback)(async e=>{let t=await a(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[a])}(e),i=(0,U.useCallback)(e=>{async function t(){try{a(await n(e))}catch(e){}}a(null),t()},[n]),l=(0,U.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==d.gF?s:null}})},[i]);return function(e){let{chatMessages:t,onLastMessageLoaded:s}=e,a=(0,U.useRef)(t.filter(e=>"human"===e.sender).pop());(0,U.useEffect)(()=>{if(!a.current)return;let e=(0,e1.C)(a.current);e&&s({uuid:a.current.uuid,messageText:e})},[s])}({chatMessages:t,onLastMessageLoaded:(0,U.useCallback)(e=>{let{uuid:t,messageText:s}=e;i({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[i])}),{serverLastChatMessageWarningProps:s,updateServerLastChatMessageWarningPropsForNewMessage:l}}(el,eu),{setSandboxState:ez}=(0,r.q)(),eE=(0,T.useSearchParams)(),[eI,eT]=(0,U.useState)(!1),[eU,eL]=(0,U.useState)(null),eR={lastAssistantMessage:(0,U.useRef)(null),lastHumanMessage:(0,U.useRef)(null),chatInput:(0,U.useRef)(null),extras:(0,U.useRef)(null),extraSpace:(0,U.useRef)(null)},eO=(0,U.useCallback)(()=>{let e=eR.lastAssistantMessage.current;if(!e)return!0;let t=e.getBoundingClientRect(),s=window.innerHeight;return t.bottom<s+50},[eR.lastAssistantMessage]);(0,U.useEffect)(()=>(eo?c.Z.setVisibilityCheck(eO):c.Z.clearVisibilityCheck(),()=>{c.Z.clearVisibilityCheck()}),[eo,eO]);let eF=(0,U.useRef)(null),eD=(0,U.useCallback)(async e=>{let{prompt:t,attachments:s,files:a,syncSources:n,personalized_style:i,compass_mode:l}=e;if(eo)return;eC({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eA({messageText:t,parentMessageUuid:ek.current}),ez(el,{conversationFiles:[...eM.files,...a],allAttachments:[...eM.attachments,...s],projectUuid:eh});let r={prompt:t,attachments:s,files:a,syncSources:n,rethrowErrors:!0,parent_message_uuid:ek.current||d.gF,personalized_style:i,org_type_override:null!=eb?eb:void 0,compass_mode:l};eT(!0),await ef(r)},[eo,eC,eA,ez,el,eM.files,eM.attachments,ef,eh,eb]),eP=(0,U.useCallback)((e,t)=>{eC({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),ez(el,{conversationFiles:eM.files,allAttachments:eM.attachments,projectUuid:eh}),ex(e,t)},[eC,ez,el,eM.files,eM.attachments,ex,eh]),eB=(0,U.useCallback)(async()=>{if(eo)return;let e=ew.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await ef({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:ek.current||d.gF})},[ew,eo,ek,ef]),eG=(0,U.useCallback)((e,t)=>{if(er){var s;eC({type:"CLEAR_SELECTED"}),er(e,t),eA({messageText:t,parentMessageUuid:null!=(s=e.parent_message_uuid)?s:null})}},[eC,er,eA]),eW=(0,U.useMemo)(()=>(0,z.A)(),[]);(0,U.useEffect)(()=>(eW.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;eP(t,s)}),eW.on("edit",e=>{let{message:t,text:s}=e;eG(t,s)}),()=>{eW.off("retry"),eW.off("edit")}),[eW,eP,eG]);let[eJ,eV]=(0,U.useState)("");(0,U.useEffect)(()=>{eo||eV(eu.map(e=>(0,i.Rs)(e)).join(" "))},[eu,eo]);let eH=(0,f.F)(eJ),{files:eq,attachments:eY,artifacts:e$}=eM,{isDrawerExpanded:e5,setIsDrawerExpanded:e6}=(0,tf.x)(),e4=(0,U.useCallback)(()=>{eC({type:"CLEAR_SELECTED"}),e6(!0)},[eC,e6]),e7=(0,U.useCallback)(()=>{e6(!1)},[e6]),e9=(0,tS.V)(eu);(0,U.useEffect)(()=>{eC({type:"UPDATE_FILES",files:e9})},[e9,eC]),(0,U.useEffect)(()=>{eC({type:"UPDATE_ATTACHMENTS",attachments:eu.flatMap(e=>e.attachments)})},[eC,eu]),(0,U.useEffect)(()=>{eC({type:"UPDATE_SYNC_SOURCES",syncSources:eu.flatMap(e=>e.sync_sources)})},[eC,eu]);let e8=(0,U.useCallback)(e=>{e4(),eC({type:"SELECT_ATTACHMENT",attachment:e})},[eC,e4]),te=(0,U.useMemo)(()=>!!((null==ey?void 0:ey.preview_feature_uses_artifacts)||eu.some(e=>K(e))),[ey,eu]),tt=(0,U.useCallback)((e,t,s)=>{e4(),eC({type:"SELECT_ARTIFACT",id:e,versionUUID:s}),eC({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[eC,e4]),ts=(0,U.useCallback)((e,t)=>{e4(),eC({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[eC,e4]),tn=eu[eu.length-1];(0,U.useEffect)(()=>{if(!te)return;let e={};eu.forEach(t=>{(0,w.Xz)(t).forEach(t=>{var s,a,n;let{id:i,currentVersion:l,type:r,title:o,language:c}=t,d=(0,w.zI)(l,null==(n=e[i])||null==(a=n.versions)||null==(s=a.slice(-1)[0])?void 0:s.resultState),u={...l,resultState:d};e[i]?e[i].versions.push(u):e[i]={id:i,type:r||"document",title:o||"Untitled",language:c||void 0,versions:[u]}})}),eC({type:"UPDATE_ARTIFACTS",artifacts:e})},[eu,te,tn,eC]);let ti=tn?(0,w.Xz)(tn):[],tl=null!=(ee=S()(ti))?ee:null,tr=null!=(et=null==tl?void 0:tl.id)?et:null,{files:to,refetch:tc}=H("outputs",el,!0,ec);(0,U.useEffect)(()=>{eu.length},[eu,tc,ec]);let td=(0,U.useRef)({lastOpenedId:null});(0,U.useEffect)(()=>{td.current.lastOpenedId},[eo,ts,null,null==tn?void 0:tn.uuid]),(0,U.useEffect)(()=>{let e=td.current.lastOpenedId===tr;eo&&tr&&!e&&(td.current.lastOpenedId=tr,tt(tr))},[eo,tr,tt]),(0,U.useEffect)(()=>{let e=eE.get("artifactId");e&&(e4(),eC({type:"SELECT_ARTIFACT",id:e}))},[]);let tu=eo&&tn&&tn.content?tn.content[tn.content.length-1]:void 0,tm=eo&&(!tn||!(null==(s=tn.content)?void 0:s[0])&&0===tn.attachments.length&&0===tn.files.length&&0===tn.files_v2.length),t_=tu&&("tool_use"===tu.type||"tool_result"===tu.type),tN=(0,U.useMemo)(()=>{if(tn){let e=Y(tn);if(!e)return;let t=e.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:s}=q.z7.safeParse(t);return null==s?void 0:s.task_id}},[tn]),tk=!eo&&void 0!==tN,{compassStatus:tA}=(0,W.CH)({organizationUUID:null==ej?void 0:ej.uuid,conversationUUID:el,taskId:tN,isShared:!1,enabled:tk}),tE=(0,U.useMemo)(()=>{if(!tn)return!1;let e=Y(tn);return!!(e&&!e.is_error&&(0,N.i3)(null==tA?void 0:tA.status)&&!K(tn))},[tn,tA]),tT=(0,J.Wo)(),tU=(0,J.hG)(),{value:tL}=(0,_.fS)("compass_enable_notifications_web"),tR=(0,U.useMemo)(()=>tm?"thinking":t_||tE?"shimmer":eo?"writing":"static",[tm,t_,eo,tE]);((e,t,s)=>{let a=(0,_.T9)("claude_ai_tabbed_out_notifications","features",tw,ty),n="visible"===(0,tg.f)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=((e,t,s)=>{let a=(0,U.useRef)(null),n=(0,U.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title="Working on it..."},[]),i=(0,U.useCallback)(()=>{if(a.current)return;let t=0;a.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,U.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title=t},[t]);return(0,U.useMemo)(()=>({setThinkingTitle:n,setReceivedTitle:i,resetTitle:l}),[n,i,l])})(["Ready to chat",e],e,a.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:c,resetFavicon:d}=(e=>{let t=(0,U.useRef)(null),s=(0,U.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),a=(0,U.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),n=(0,U.useCallback)(()=>{if(t.current)return;let a=0;t.current=setInterval(()=>{s("".concat(tv,"/").concat(tj[a],".svg")),a=(a+1)%tj.length},e)},[e,s]),i=(0,U.useCallback)(()=>{a(),s(tb)},[s,a]);return(0,U.useMemo)(()=>({setWritingFavicon:n,setCompleteFavicon:i,resetFavicon:a}),[n,i,a])})(a.faviconDelayMs||100),{playSound:u,resetSound:m}=(()=>{let e=(0,U.useRef)(null),t=(0,U.useRef)(!1);(0,U.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,U.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null==(s=e.current)||s.play()}}},[]),a=(0,U.useCallback)(()=>{t.current=!1},[]);return(0,U.useMemo)(()=>({playSound:s,resetSound:a}),[s,a])})(),x=(0,U.useRef)(!1);(0,U.useEffect)(()=>{let e=t&&s,f=!t&&s,h=!t&&!s;e&&!x.current&&(x.current=!0);let p=h&&x.current;if(p&&(x.current=!1),n){a.changeTitle&&r(),a.changeFavicon&&d();return}a.changeTitle&&(e||f?i():p&&l()),a.changeFavicon&&(f?o():p&&(c(),x.current=!1)),a.playSound&&(e?m():p&&u())},[a,t,s,n,i,l,r,o,c,d,u,m])})(ei,tm,eo);let{getCreateParamsForConvo:tO}=(0,x.I)();(0,U.useEffect)(()=>{if(ed)return;let e=tO(el);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&eD(e)},[el,eD,tO,ed]);let{data:tF}=(0,F.fo)(eh),tD=(0,P.K)(),tP=(0,D.ED)(eh),{publishedArtifactsByMessageUuid:tB}=(0,l.rC)({includeDeletedArtifacts:!0}),{mutate:tG,isPending:tW}=(0,i.aC)(el),tJ=(0,x.E)(),tV=(0,U.useCallback)((e,t)=>{eC({type:"CLEAR_SELECTED"}),null==en||en(e,t)},[en,eC]),tH=(0,u.Z3)(el);(0,eQ.hq)(el);let tq=null==tn||null==(a=tn.content)?void 0:a.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),{activeModelOptions:tK}=(0,m.A9)(),tY=O.z.array(O.z.string()),t$=(0,_.T9)("invite_contest_name","model_prefixes",[],tY),{data:tX}=(0,i.Fn)();(0,U.useEffect)(()=>{var e,t;if(!eo&&2===eu.length&&(null==(e=eu[0])?void 0:e.sender)==="human"&&(null==(t=eu[1])?void 0:t.sender)==="assistant"&&t$.some(e=>null==tH?void 0:tH.startsWith(e))&&tX&&tX.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUUID:el,model:tH}});window.dispatchEvent(e)}},[eo,eu,tH,el,t$,tX]);let tZ=(0,U.useMemo)(()=>{let e=ew.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tK.find(e=>e.model===tH);if(!t||!t.knowledgeCutoff)return e;let s=A.c9.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return ew.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:ew.locale});return ew.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tH,tK,ew]),tQ=(0,U.useMemo)(()=>e$,[!eo&&e$]),t0=e5&&eM.selectedItem?eM.selectedItem:void 0,t1=(0,U.useCallback)(e=>(0,n.jsx)(tC.A,{...e,conversationUUID:el,artifacts:tQ,onOpenArtifact:te?tt:void 0,onAllow:e.isLastMessage&&!e.toolResult?eg:void 0,selectedDrawerItem:t0}),[el,tQ,te,tt,eg,t0]),t2=(0,U.useCallback)(()=>{eL({})},[]),t3=(0,U.useMemo)(()=>({id:el,messagesSoFar:eu.length,tokensSoFar:eH,files:eq,attachmentsSoFar:eY.length,isSampling:eo,isStoppingSampling:tW,model:tH,projectKnowledgebaseTokens:null!=tP?tP:0,conversationSettings:ey}),[eY.length,ey,eH,el,eq,tW,eo,eu.length,tH,tP]),t5=(0,U.useMemo)(()=>tn&&"assistant"===tn.sender&&tn.content&&tn.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[tn]),t6=(0,U.useCallback)(()=>{(0,o.OZ)(),tG()},[tG]),t4=(0,U.useCallback)(async e=>{await eD({prompt:e.prompt,attachments:[],files:e.files,syncSources:[]})},[eD]);return ev?(0,n.jsx)(e2.b,{autoscrollDisabled:!0,autoscrollRef:eN,rightSidebarElement:void 0,mainElement:(0,n.jsxs)(eZ._,{conversation:t3,projectUuid:eh,onSend:eD,onCreate:tJ,onStopSampling:t6,setPersonalizedStyleCallback:ep,children:[(0,n.jsx)(tM,{chatId:el,chatName:em,onSend:t4}),(0,n.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,n.jsx)(ta,{conversationUuid:el}),ed?(0,n.jsx)(tI,{className:"pt-2",children:(0,n.jsx)(G.d,{})}):0===eu.length?(0,n.jsx)(n.Fragment,{children:(null==t3||null==(v=t3.conversationSettings)?void 0:v.create_mode)?(0,n.jsx)(tI,{className:"pt-1",children:(0,n.jsx)(tx,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tp,{}),(0,n.jsx)(tI,{})]})}):(0,n.jsxs)(tI,{className:"pt-1",children:[(null==t3||null==(M=t3.conversationSettings)?void 0:M.create_mode)&&(0,n.jsx)(tx,{selectedLabel:(null==eu||null==(V=eu[0])||null==(E=V.content)||null==(C=E[0])?void 0:C.type)==="text"?null==eu||null==(Z=eu[0])||null==(X=Z.content)||null==($=X[0])?void 0:$.text:void 0,disabled:eu.length>0}),(0,n.jsx)(e3.$,{renderToolUseCell:t1,children:eu.map((e,t)=>(0,n.jsx)(G.c,{lastHumanMessageRef:eR.lastHumanMessage,lastAssistantMessageRef:eR.lastAssistantMessage,previousMessage:t>0?eu[t-1]:void 0,message:e,conversationUUID:el,conversationSettings:ey,isStreaming:eo,isLastMessage:t===eu.length-1,isLastHumanMessage:t===eu.length-2,isFirstAssistantMessage:1===t&&"assistant"===e.sender,messageWarningProps:t===eu.length-1&&eS||void 0,onOpenArtifact:te?tt:void 0,onOpenWiggleFile:t=>{ts(t,e.uuid)},selectAttachment:e8,changeDisplayedConversationPath:tV,editable:!0,publishedArtifacts:null==tB?void 0:tB[e.uuid],onResize:t2,actionEmitter:eW,onSendContinue:eB,isResearchPending:tE,isTemporary:ec},t))}),(0,n.jsx)("div",{ref:eR.extras,children:(0,n.jsxs)("div",{className:(0,k.A)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",eo&&"-translate-y-2.5"),children:[(0,n.jsx)("div",{className:"p-1 -translate-x-px",children:(0,n.jsx)(b.a,{state:tR,className:(0,k.A)(ec&&"!text-text-100")})}),2===eu.length&&eo&&(null==(Q=eu[1])?void 0:Q.content)&&0===eu[1].content.length?(0,n.jsx)(tz,{}):null,(0,n.jsx)("div",{className:(0,k.A)("text-text-500 px-2 mt-6 flex-1 text-right text-[0.65rem] leading-[0.85rem] tracking-tighter sm:text-[0.75rem]",eo&&"pointer-events-none"),children:ec?(0,n.jsx)("div",{className:(0,k.A)("inline-block select-none transition-opacity mt-1",!eo&&"opacity-90 delay-300 duration-700",eo&&"opacity-0 duration-0"),children:(0,n.jsx)(j.YX,{id:"heroic_sandwich_butterfly"})}):tE&&tL?(0,n.jsx)("div",{className:"inline-block select-none",children:"default"===tT?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(R.A,{defaultMessage:"Research takes time. Claude can let you know when it’s done.",id:"sPgKzf0LZ9"})}),(0,n.jsx)("button",{onClick:tU,className:"text-text-300 hover:text-text-200 underline",children:(0,n.jsx)(R.A,{defaultMessage:"Enable notifications",id:"AIUVfaT9og"})})]}):(0,n.jsx)(R.A,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,n.jsx)(y.m,{tooltipContent:tZ,side:"bottom",disableHoverableContent:!0,className:"max-w-full",delayDuration:50,children:(0,n.jsx)(I(),{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,k.A)("inline-block select-none",!eo&&"opacity-90 delay-300 duration-700",eo&&"opacity-0 duration-0"),children:(0,n.jsx)("span",{className:"hover:text-text-300 transition",children:t5?(0,n.jsx)(R.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}}):(0,n.jsx)(R.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}})})})})})]})}),(0,n.jsx)(th,{newMessageSent:eI,setNewMessageSent:eT,scrollRefs:eR,scrollContainerRef:eN,invalidator:eU})]}),(null==t3||null==(ea=t3.conversationSettings)?void 0:ea.create_mode)&&0===eu.length?null:tq?(0,n.jsx)("div",{ref:eR.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(eX,{conversationUuid:el,message:tn})}):(0,n.jsx)("div",{ref:eR.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(B.V,{ref:eF,placement:"bottom",disabled:ed})})]})]}),drawerElement:(0,n.jsx)(eK,{conversationUUID:el,isOpen:e5,onClose:e7,isStreaming:eo,projectUuid:eh,sendMessage:eD,messages:eu,isTemporary:ec}),isDrawerOpen:e5,headerProps:{conversationUUID:el,name:em,project:tD?tF:void 0,controlsSidebarIsOpen:e5,closeControlsSidebar:e7,openControlsSidebar:e4,isStreaming:eo,wiggleFilesCount:0}}):null}let tI=v.J.div(tA())},65755:(e,t,s)=>{s.d(t,{u:()=>l});var a=s(40169),n=s(7904),i=s(57259);function l(e){let t=e.trim();return(0,a.yt)(t,{extensions:[(0,n.x)()],htmlExtensions:[(0,i.k)()]})}},67532:(e,t,s)=>{s.d(t,{a:()=>i});var a=s(7620),n=s(11480);let i=(e,t)=>{let s=(0,a.useRef)(!1),i=(0,a.useRef)(null),l=(0,a.useRef)(null),[r,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!e),{expandedItemKey:u,setExpandedItemKey:m}=(0,n.D8)(),x=t&&m,f=(0,a.useCallback)(e=>{x&&m(e?t:void 0),o(e)},[x,m,o,t]),h=x?u===t:r;return(0,a.useEffect)(()=>(i.current&&(clearTimeout(i.current),i.current=null),l.current&&(clearTimeout(l.current),l.current=null),e?(s.current=!0,f(!0),d(!1)):s.current&&(i.current=setTimeout(()=>{f(!1),l.current=setTimeout(()=>{d(!0),s.current=!1},600)},2e3)),()=>{i.current&&(clearTimeout(i.current),i.current=null),l.current&&(clearTimeout(l.current),l.current=null)}),[e,f]),{isExpanded:h,setIsExpanded:f,snappyTransition:c}}},69347:(e,t,s)=>{s.d(t,{A:()=>eg});var a=s(54568),n=s(27062),i=s(77101),l=s(7620),r=s(85717),o=s(43156),c=s(64039),d=s(62971);let u=()=>(0,a.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,a.jsx)(c.R,{size:24}),(0,a.jsx)("p",{className:"font-base ml-3",children:(0,a.jsx)(d.A,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var m=s(94649),x=s(11515),f=s(91961),h=s(85544),p=s(58911),g=s(75006),v=s(94748);let j=g.z.object({url:g.z.string()}),b=e=>{let t,{input:s,toolResult:n,isStreaming:i}=e,r=null==n?void 0:n.is_error,[o,c]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),g=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let s of e.content)if("text"===s.type){let e=function(e){try{return JSON.parse(e)}catch(e){return null}}(s.text);if(null===e)t.push({error_type:"UNKNOWN_ERROR",error_message:s.text});else{let s=h.kS.safeParse(e);s.success&&t.push(s.data)}}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.tD.safeParse(e);if(!t.success)return null;{let e=h.kS.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),b=function(e){switch(e){case"INVALID_URL":return(0,a.jsx)(d.A,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,a.jsx)(d.A,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,a.jsx)(d.A,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,a.jsx)(d.A,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,a.jsx)(d.A,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,a.jsx)(d.A,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,a.jsx)(d.A,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,a.jsx)(d.A,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==g?void 0:g.error_type),{data:y}=j.safeParse(s);if(!y)return;let w=y.url,_=(null==u?void 0:u.title)||w,N=(0,f.Nj)(w);return t=i?N?(0,a.jsx)(d.A,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:N}}):(0,a.jsx)(d.A,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,a.jsx)(d.A,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}):(0,a.jsx)(d.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.aX,{isError:r,errorMessage:b,text:t,secondaryText:i?void 0:N,handleClick:()=>c(!0),icon:(0,a.jsx)(x.d,{fadeInOnLoad:!0,url:w,size:16}),secondaryIcon:(0,a.jsx)(p.B,{size:16,className:"text-text-300"}),...e}),(0,a.jsx)(m.v,{isOpen:o,url:w,onClose:()=>c(!1),onConfirm:()=>{window.open(w,"_blank"),c(!1)}})]})};var y=s(33395),w=s(34059),_=s(34933),N=s(37463),k=s(45376),M=s.n(k),C=s(46760),S=s(74744),A=s(67532);function z(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let E=e=>{let{isExpanded:t,toolName:s,results:n}=e;return(null==n?void 0:n.length)?(0,a.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,a.jsx)(T,{results:n,isExpanded:t}):(0,a.jsx)(U,{results:n,isExpanded:t})}):null},I={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},T=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,a.jsx)(N.P.div,{variants:I,children:(0,a.jsx)(y.$,{disabled:!t,icon:(0,a.jsx)(x.d,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!=(s=e.knowledge.url)?s:void 0})},e.knowledge.url):null})})},U=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(N.P.div,{variants:I,children:(0,a.jsx)(L,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},L=e=>{let{disabled:t,knowledge:s}=e,n=(e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.cI)();return(0,r.yy)()?s?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!s});return(0,a.jsx)(S.Tc,{syncSourceType:i.v8.GDRIVE,syncStatus:n,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},R=g.z.object({query:g.z.string(),n:g.z.number().int().optional()}),O=e=>{var t;let{toolName:s,syncSourceType:n,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:c}=i,{isExpanded:d,setIsExpanded:u,snappyTransition:m}=(0,A.a)(!1,c),x=(0,C.A)(),f=null==r?void 0:r.is_error,p=f?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:z(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return M()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),a=(Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:z(e),knowledge:e}));return M()(a,e=>e.uuid)}catch(e){return[]}}(r),{data:g}=R.safeParse(l),j="web_search"===s?x.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):x.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!g)return;let b=x.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(t=null==p?void 0:p.length)?t:0}),y=!p&&o?j:g.query;return(0,a.jsx)(v.sH,{isExpandingDisabled:!!o,isExpanded:d,setIsExpanded:u,isError:f,text:y,secondaryText:o?void 0:b,icon:"web_search"===s?(0,a.jsx)(_.q,{size:16}):!!n&&(0,a.jsx)(w.A9,{type:n,size:14}),...i,children:(0,a.jsx)(v.NG,{isExpanded:d,snappyTransition:m,isScrollable:!0,children:!f&&!!(null==p?void 0:p.length)&&(0,a.jsx)(E,{isExpanded:d,toolName:s,results:p})})})};var F=s(70067),D=s(1761);g.z.object({prompt:g.z.string()});var P=s(33792),B=s(90909),G=s(54890),W=s(32987);function J(e){var t,s,n,i;let{input:r,toolResult:o,isStreaming:c,isLastMessage:d,onOpenArtifact:u,artifacts:m,message:x,artifactCellType:f,selectedArtifactId:h,selectedArtifactVersion:p,isFirstBlockOfMessage:g,isLastBlockOfMessage:v}=e,j=G.oE.parse(r),{versions:b,...y}=null!=(n=m[null!=(s=j.id)?s:""])?n:{},w=(0,l.useMemo)(()=>{let e=null==b?void 0:b.findIndex(e=>e.uuid===j.version_uuid);if(-1!==e)return e},[b,j.version_uuid]),_=null==(t=null!=(i=j.content)?i:j.new_str)?void 0:t.slice(0,250),N={isClosed:void 0!==o,...y,...j},k=h===N.id&&p===j.version_uuid,M="individual_cell_create"===f||"multi_edit_not_last"!==f;return(0,a.jsx)("div",{className:(0,W.A)(M&&(g?"pt-2":"pt-3"),M&&(v?"pb-2":"pb-3"),"multi_edit_not_last"===f&&"h-0"),children:(0,a.jsx)(B.d,{versionNum:w?w+1:void 0,preview:_,versionCount:null==b?void 0:b.length,properties:N,isStreaming:c,isEdit:"individual_cell_create"!==f,isNotLastEdit:"multi_edit_not_last"===f,isLastMessage:d,onOpenArtifact:e=>{u&&u(e,x.uuid,j.version_uuid)},isExpanded:k})})}var V=s(22134),H=s(41417),q=s(13625),K=s(82199),Y=s(44180),$=s(55563);let X=g.z.object({code:g.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),Z=e=>{var t;let{input:s,toolResult:n,isStreaming:i,groupItemKey:r}=e,o=(0,C.A)(),{isExpanded:c,setIsExpanded:d,snappyTransition:u}=(0,A.a)(i,r),m=null!=(t=X.parse(s).code)?t:"",{toolResultLogs:x,toolResultErrors:f}=(0,l.useMemo)(()=>n?(e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,Y.Cp)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}})(n):{toolResultLogs:"",toolResultErrors:""},[n]);return(0,a.jsx)(v.sH,{isExpanded:c,setIsExpanded:d,icon:(0,a.jsx)(K.N,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,a.jsx)(v.NG,{isExpanded:c,snappyTransition:u,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)($.z,{language:"javascript",code:m}),(0,a.jsx)($.z,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:x}),!!f&&(0,a.jsx)($.z,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:f,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};var Q=s(88781),ee=s(37711);let et=e=>{let{streamingAction:t,errorAction:s,successAction:n,target:i,isStreaming:l=!1,isError:r=!1,description:o}=e;return o&&!r?l?(0,a.jsx)(ee.N,{children:o}):(0,a.jsx)("span",{className:"text-text-200",children:o}):(0,a.jsxs)("span",{className:"flex items-center min-w-0 text-text-200",children:[(0,a.jsx)("span",{className:"whitespace-nowrap mr-1 text-text-200",children:l?t:r?s:n}),(0,a.jsx)("span",{className:"bg-gradient-to-b from-bg-300 via-bg-300/80 to-bg-300 shadow-xs rounded px-1 py-0.5 font-mono truncate overflow-hidden text-ellipsis min-w-0 text-text-200",title:i,children:i})]})},es=g.z.object({returncode:g.z.number().int(),stdout:g.z.string(),stderr:g.z.string()});function ea(e){if(!e.content||0===e.content.length)return null;let t=e.content[0];return(null==t?void 0:t.type)==="text"?t.text:null}let en=e=>{let{input:t,toolResult:s,isStreaming:n,isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,groupItemKey:c,isFirstItemInGroup:d,isLastItemInGroup:u}=e,{isExpanded:m,setIsExpanded:x,snappyTransition:f}=(0,A.a)(!1,c),h=(null==t?void 0:t.command)||"",p=(null==s?void 0:s.is_error)||!1,g=(0,l.useMemo)(()=>(function(e,t,s){if(!e)return;if(t)return{type:"error",rawContent:ea(e)||JSON.stringify(e,null,2)};let a=ea(e);if(!a)return{type:"empty"};try{let e=es.parse(JSON.parse(a));return{type:"success",data:e}}catch(e){try{let e=JSON.parse(a);if(Array.isArray(e)&&e.length>0&&"text"===e[0].type&&e[0].text){let t=es.parse(JSON.parse(e[0].text));return{type:"success",data:t}}}catch(e){}return s?void 0:{type:"parse-error",rawContent:a}}})(s,p,n),[s,p,n]),j=null==t?void 0:t.description;return(0,a.jsx)(v.sH,{isExpanded:m,setIsExpanded:x,isStreaming:!!n,icon:(0,a.jsx)(Q.b,{size:16}),text:(0,a.jsx)(et,{streamingAction:"Running",errorAction:"Failed to run",successAction:"Ran",target:h,isStreaming:n,isError:p,description:j}),isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:u,children:(0,a.jsx)(v.NG,{isExpanded:m,snappyTransition:f,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)($.z,{language:"bash",code:h}),(()=>{if(!g)return null;switch(g.type){case"success":{let{data:e}=g;return(0,a.jsxs)(a.Fragment,{children:[e.stdout&&(0,a.jsx)($.z,{title:"Output",language:"bash",code:e.stdout}),e.stderr&&(0,a.jsx)($.z,{title:"Error",code:e.stderr,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"}),!e.stdout&&!e.stderr&&(0,a.jsx)($.z,{title:"Output",code:"exit code ".concat(e.returncode)})]})}case"error":return(0,a.jsx)($.z,{title:"Command failed",code:g.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"parse-error":return(0,a.jsx)($.z,{title:"Output",code:g.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"empty":return(0,a.jsx)($.z,{title:"No output",code:"Command completed with no output"});default:return null}})()]})})})};var ei=s(28885),el=s(9234),er=s(95675),eo=s(56273),ec=s(49146);let ed=e=>(e.split("/").pop()||e).replace(/\.[^/.]+$/,"").split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),eu=e=>{var t,s;let{input:n,toolResult:i,isStreaming:l,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:c,groupItemKey:u,isFirstItemInGroup:m,isLastItemInGroup:x,message:f,shareType:h}=e,{isExpanded:p,setIsExpanded:g,snappyTransition:j}=(0,A.a)(l,u),{dispatchChatResource:b}=(0,eo.i)(),{setIsDrawerExpanded:y}=(0,er.x)(),w=null==i?void 0:i.is_error,_=null!=(t=null==n?void 0:n.path)?t:"",N=null!=(s=null==n?void 0:n.file_text)?s:"",k=(0,ec.S)(_),M=ed(_),C=null==n?void 0:n.description,S=!w&&_&&(null==f?void 0:f.uuid)&&!h;return l||p||!j?(0,a.jsx)(v.sH,{isExpanded:p,setIsExpanded:g,isStreaming:!!l,icon:(0,a.jsx)(ec.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,a.jsx)(et,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:M,isStreaming:l,isError:w,description:C}),secondaryIcon:S?(0,a.jsx)("span",{className:"text-xs text-text-300",children:(0,a.jsx)(d.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:c,isFirstItemInGroup:m,isLastItemInGroup:x,children:(0,a.jsx)(v.NG,{isExpanded:p,snappyTransition:j,children:(0,a.jsx)(el.Z,{noDefaultScroll:!l,className:"flex flex-col gap-3 p-3 pt-1 max-h-[238px] overflow-y-scroll",disabled:!1,children:(0,a.jsx)("div",{"data-testid":"repl-output",children:N&&(0,a.jsx)($.z,{title:_,language:k,code:N})})})})}):(0,a.jsx)(v.aX,{isStreaming:!!l,handleClick:S?()=>{_&&(null==f?void 0:f.uuid)&&(b({type:"SELECT_FILE",path:_,toolType:"create_file",messageId:f.uuid}),y(!0))}:void 0,icon:(0,a.jsx)(ec.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,a.jsx)(et,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:M,isStreaming:l,isError:w,description:C}),secondaryIcon:S?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-xs text-text-300",children:(0,a.jsx)(d.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}),(0,a.jsx)(ei.fX,{className:"text-text-300",size:16})]}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:c,isFirstItemInGroup:m,isLastItemInGroup:x})};var em=s(25850);let ex=e=>{var t;let{input:s,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:c,isLastItemInGroup:u,message:m,shareType:x}=e,{dispatchChatResource:f}=(0,eo.i)(),{setIsDrawerExpanded:h}=(0,er.x)(),p=null==n?void 0:n.is_error,g=null!=(t=null==s?void 0:s.path)?t:"",j=()=>{g&&(null==m?void 0:m.uuid)&&(f({type:"SELECT_FILE",path:g,toolType:"str_replace",messageId:m.uuid}),h(!0))},b=ed(g),y=null==s?void 0:s.description,w=g.split("/").pop()||g,_=!p&&g&&(null==m?void 0:m.uuid)&&!x;return(0,a.jsx)(v.aX,{isStreaming:!!i,handleClick:_?j:void 0,icon:(0,a.jsx)(em.I,{size:16}),text:(0,a.jsx)(et,{streamingAction:"Editing",errorAction:"Failed to edit",successAction:"Edited",target:b,isStreaming:i,isError:p,description:y}),secondaryIcon:_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.$,{variant:"ghost",size:"sm",className:"text-xs px-2 py-1 h-6",onClick:e=>{e.stopPropagation(),j()},children:i?w:(0,a.jsx)(d.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}),(0,a.jsx)(ei.bi,{className:"transform -rotate-90 text-text-300",size:16})]}):void 0,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:c,isLastItemInGroup:u})};function ef(e){let{toolResult:t,fileSyntax:s}=e,{activeOrganization:n}=(0,D.YL)(),i=null==n?void 0:n.uuid;try{var l;if(t.content&&t.content.length>0&&(null==(l=t.content[0])?void 0:l.type)==="text"){let e=t.content[0].text;try{let s=JSON.parse(e);Array.isArray(s)&&(t.content=s)}catch(e){}}if(!t.content||0===t.content.length||!t.content[0])return(0,a.jsx)(a.Fragment,{});return(0,a.jsx)(a.Fragment,{children:t.content.map((e,t)=>"text"===e.type?(0,a.jsx)($.z,{language:s,code:e.text},t):"image"===e.type?(0,a.jsx)("img",{alt:"",src:"/api/".concat(i,"/files/").concat(e.file_uuid,"/preview"),className:"max-w-md max-h-md h-auto rounded-md"},t):null)})}catch(e){return(0,a.jsx)($.z,{title:"Error displaying content - Raw result:",code:JSON.stringify(t,null,2),codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})}}let eh=e=>{let{path:t}=e,s=t.split("/"),n=s.indexOf("skills"),i=s[n+1]||"",l=ed(s[s.length-1]||"");return(0,a.jsxs)("span",{className:"flex items-center min-w-0 text-text-200",children:[(0,a.jsx)("span",{className:"whitespace-nowrap mr-1 text-text-200",children:(0,a.jsx)(d.A,{defaultMessage:"Loading {skill} skills from",id:"wqLDdSBdkM",values:{skill:i}})}),(0,a.jsx)("span",{className:"bg-gradient-to-b from-bg-300 via-bg-300/80 to-bg-300 shadow-xs rounded px-1 py-0.5 font-mono truncate overflow-hidden text-ellipsis min-w-0 text-text-200",title:t,children:l})]})},ep=e=>{var t;let{input:s,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,groupItemKey:c,isFirstItemInGroup:u,isLastItemInGroup:m,message:x,shareType:f}=e,{isExpanded:h,setIsExpanded:p,snappyTransition:g}=(0,A.a)(!1,c),{dispatchChatResource:j}=(0,eo.i)(),{setIsDrawerExpanded:b}=(0,er.x)(),y=null==n?void 0:n.is_error,w=null!=(t=null==s?void 0:s.path)?t:"",_=(0,ec.S)(w),N=/\.[^/]+$/.test(w),k=()=>{w&&(null==x?void 0:x.uuid)&&(j({type:"SELECT_FILE",path:w,toolType:"view",messageId:x.uuid}),b(!0))},M=w.includes("/mnt/skills/"),C=ed(w),S=null==s?void 0:s.description,z=w.split("/").pop()||w,E=!y&&w&&(null==x?void 0:x.uuid)&&!f;return N?(0,a.jsx)(v.aX,{isStreaming:!!i,handleClick:E?k:void 0,icon:(0,a.jsx)(ec.o,{path:(null==s?void 0:s.path)||"",size:16}),text:M&&!S?(0,a.jsx)(eh,{path:w}):(0,a.jsx)(et,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:C,isStreaming:i,isError:y,description:S}),secondaryIcon:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.$,{variant:"ghost",size:"sm",className:"text-xs px-2 py-1 h-6",onClick:e=>{e.stopPropagation(),k()},children:i?z:(0,a.jsx)(d.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}),(0,a.jsx)(ei.bi,{className:"transform -rotate-90 text-text-300",size:16})]}):void 0,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:m}):(0,a.jsx)(v.sH,{isExpanded:h,setIsExpanded:p,isStreaming:!!i,icon:(0,a.jsx)(ec.o,{path:(null==s?void 0:s.path)||"",size:16}),text:M&&!S?(0,a.jsx)(eh,{path:w}):(0,a.jsx)(et,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:C,isStreaming:i,isError:y,description:S}),isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:m,children:(0,a.jsx)(v.NG,{isExpanded:h,snappyTransition:g,isScrollable:!0,children:(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:n&&(0,a.jsx)(ef,{toolResult:n,fileSyntax:_,isStreaming:i})})})})};function eg(e){let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:c,input:d,message:m,onOpenArtifact:x,publishedArtifacts:f,toolResult:h,artifacts:p,onAllow:g,artifactCellType:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,selectedDrawerItem:_,shareType:N,displayData:k,approvalData:M,context:C,renderMode:S=P.l.Standard,groupItemKey:A,isFirstItemInGroup:z,isLastItemInGroup:E}=e,I=(0,r.fb)(),T=(0,o.be)(),{value:U}=(0,n.fS)("prism_enabled"),L={input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:S,groupItemKey:A,isFirstItemInGroup:z,isLastItemInGroup:E,message:m},R={bash_tool:en,create_file:eu,view:ep,str_replace:ex}[c];if(R)return(0,a.jsx)(R,{...L});if("end_conversation"===c)return(0,a.jsx)(u,{});let D=(null==_?void 0:_.type)==="artifact"?_:void 0,B=!!h&&!!_&&"compass"===_.type&&_.data.toolUseId===h.tool_use_id;switch(c){case"artifacts":return(0,a.jsx)(J,{input:d,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:x,publishedArtifacts:f,artifacts:p,message:m,artifactCellType:v,selectedArtifactId:null==D?void 0:D.id,selectedArtifactVersion:null==D?void 0:D.versionUUID,isFirstBlockOfMessage:j,isLastBlockOfMessage:y});case"dolphin":return(0,a.jsx)(a.Fragment,{});case"repl":return(0,a.jsx)(Z,{...L});case"drive_search":if(!I)break;return(0,a.jsx)(O,{syncSourceType:i.v8.GDRIVE,toolName:c,...L});case"web_search":if(!T)break;return(0,a.jsx)(O,{toolName:c,...L});case"web_fetch":return(0,a.jsx)(b,{...L});case"launch_extended_search_task":return(0,a.jsx)(F.wD,{toolUseId:t,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,toolResult:h,isShared:!!N,isExpanded:B,isStreaming:l,context:C})}let G=c.includes(":");return!G&&(null==k?void 0:k.integrationName)?(0,a.jsx)(V.K,{...k,toolName:c,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:S,groupItemKey:A,isFirstItemInGroup:z,isLastItemInGroup:E}):(0,a.jsx)(q.d,{toolName:G?c.split(":")[1]:c,integrationName:null==k?void 0:k.integrationName,integrationIcon:null==k?void 0:k.integrationIcon,approvalData:M,...L})}},70067:(e,t,s)=>{s.d(t,{wD:()=>P,z7:()=>D});var a=s(54568),n=s(94275),i=s.n(n),l=s(8027),r=s(11515),o=s(77186),c=s(1761),d=s(41417),u=s(37076),m=s(98411),x=s(37711),f=s(98769),h=s(27062),p=s(85544),g=s(4705),v=s(67902),j=s(32987),b=s(37463),y=s(49645),w=s(7620),_=s(46760),N=s(62971),k=s(75006),M=s(92947),C=s(73325),S=s(66436),A=s(73817),z=s(38807),E=s(41264),I=s(33562);function T(e){let{onCancel:t,onConfirm:s}=e,n=(0,w.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,E.$3)(),r=(0,I.Cn)({setMcpDirectoryModalIsOpen:U,setStyleModalOpenWithScreen:U,setCreateProjectModalIsOpen:U,setGithubModalIsOpen:U,setGmailAuthModalIsOpen:U,setCreatePromptArgumentModalIsOpen:U}),o=(0,z._9)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,w.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()})},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(u.aF,{isOpen:!0,modalSize:"2lg",onClose:t,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:(0,a.jsx)(N.A,{defaultMessage:"Enable connectors for Claude to use in research",id:"bnGGwdCceV"})}),(0,a.jsx)("div",{className:"border border-border-300 rounded-lg",children:(0,a.jsxs)("div",{className:"p-2",children:[o.path&&(0,a.jsx)(A.s,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),(0,a.jsx)("div",{className:"space-y-1",children:o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,a.jsx)(S.$,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key},e.key))})]})}),(0,a.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,a.jsx)(N.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,a.jsx)("a",{href:"https://support.anthropic.com/",className:"underline",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-2",children:[(0,a.jsx)(d.$,{variant:"outline",onClick:t,children:(0,a.jsx)(N.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsxs)(d.$,{ref:n,onClick:function(){s({tools:l()})},children:[(0,a.jsx)(N.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,a.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,a.jsx)(C.y,{size:12})})]})]})]})})})}function U(){}var L=s(95675),R=s(56273),O=s(84137),F=s(73347);let D=k.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},k.z.object({task_id:k.z.string()}));function P(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:n=!1,conversationUUID:i,toolResult:l,isShared:r,isExpanded:d=!1,isStreaming:u=!1,context:m}=e,{value:x}=(0,h.fS)("papi_mcp"),{activeOrganization:f}=(0,c.YL)(),{dispatchChatResource:g}=(0,R.i)(),{setIsDrawerExpanded:v}=(0,L.x)(),{decisionState:b,approveTool:y,denyTool:N}=function(e,t,s,a){let[n,i]=(0,w.useState)("pending"),l=!!(e&&t&&a),{isPending:r}=(0,o.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:l}),c=(0,o.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!r),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:r,approveTool:(0,w.useCallback)(e=>{let{tools:t}=e;c({tool_use_id:s,is_approved:!0,params:{tools:t}})},[c,s]),denyTool:(0,w.useCallback)(()=>{c({tool_use_id:s,is_approved:!1})},[c,s])}}(null==f?void 0:f.uuid,i,t,u),k=u?"approved"===b:l&&!(null==l?void 0:l.is_error),M=x&&(null==m?void 0:m.tools.length)&&u&&"pending"===b,C=(0,w.useMemo)(()=>{if(!(null==l?void 0:l.content))return;let e=l.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=D.safeParse(e);return null==t?void 0:t.task_id},[null==l?void 0:l.content]),{compassStatus:S,isLoading:A,error:z}=(0,O.CH)({organizationUUID:null==f?void 0:f.uuid,conversationUUID:i,taskId:C,isShared:r,enabled:k});(0,O.IK)(i,null==S?void 0:S.status);let E=!S,I=(0,w.useCallback)(()=>{E||(v(!0),g({type:"OPEN_COMPASS_STATUS",data:{conversationUUID:i,organizationUUID:null==f?void 0:f.uuid,isShared:r,toolUseId:null==l?void 0:l.tool_use_id,taskId:C}}))},[E,g,i,null==f?void 0:f.uuid,v,r,l,C]),U=(null==S?void 0:S.status)||p.zu.Starting,F=!!z||!!(null==l?void 0:l.is_error),P=(0,_.A)(),{title:B,subtitle:J}=(0,w.useMemo)(()=>{let e,t;if(F)return{title:P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})};let s=(null==S?void 0:S.total_sources)||0,a=0===s?P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:s}),n=P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:s}),i=(0,O.Ui)(S),l=i||P.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),r=i||P.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(U){case p.zu.Starting:{let t=[P.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),P.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),P.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),P.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),P.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),P.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),P.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),P.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),P.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),P.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),P.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case p.zu.Planning:e=l,t=P.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case p.zu.InitiatingAgents:e=l,t=P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case p.zu.Searching:e=l,t=a;break;case p.zu.CreatingArtifact:e=l,t=P.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case p.zu.Completed:t=n,e=r;break;case p.zu.Cancelled:e=l,t=P.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case p.zu.TimedOut:case p.zu.Failed:e=P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),t=n}return{title:e,subtitle:t}},[P,U,S,F]);return M&&(null==m?void 0:m.use_finegrained_approval)?(0,a.jsx)(T,{onCancel:N,onConfirm:e=>{let{tools:t}=e;y({tools:t})}}):M?(0,a.jsx)(V,{tools:m.tools,onCancel:N,onApprove:()=>{y({tools:[]})}}):(0,a.jsx)("div",{className:(0,j.A)("my-3",s?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:A?(0,a.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui tracking-tight rounded-xl border border-border-300 shadow-xs",children:[(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,a.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,a.jsxs)("button",{className:(0,j.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui tracking-tight rounded-xl border shadow-xs overflow-hidden",!E&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",d?"!border-accent-secondary-200":"border-border-300"),disabled:E,onClick:I,children:[(0,a.jsx)(G,{title:B,compassStatus:S,useShimmer:U===p.zu.Starting,isError:F||U===p.zu.Failed||U===p.zu.TimedOut,isExpanded:d}),(0,a.jsx)(W,{subtitle:J,compassStatus:S,isError:U===p.zu.Cancelled,useShimmer:!d&&!!S&&![p.zu.CreatingArtifact,p.zu.Completed,p.zu.Cancelled,p.zu.TimedOut,p.zu.Failed].includes(S.status)})]})})}function B(e){let{className:t,text:s,useShimmer:n}=e,[l,r]=(0,w.useState)(s),[o,c]=(0,w.useState)(!1),[d,u]=(0,w.useState)("");return(0,w.useEffect)(()=>{if(s!==l){u(l),r(s),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[s,l]),(0,a.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,j.A)("relative overflow-hidden",t)||""),children:[(0,a.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@keyframes slideUpFadeOut{0%{transform:translatey(0);opacity:1}100%{transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeIn{0%{transform:translatey(100%);opacity:0}100%{transform:translatey(0);opacity:1}}"}),o&&(0,a.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(x.N,{children:d}):d}),(0,a.jsx)("div",{style:o?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(x.N,{children:l}):l})]})}function G(e){let{title:t,isError:s,compassStatus:n,useShimmer:i,isExpanded:l}=e,[r,o]=(0,w.useState)(!1),c=(0,O.Nw)(n),d=(0,w.useRef)(c);(0,w.useEffect)(()=>{c&&!d.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),d.current=c)},[c]);let u=!l&&r;return(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,a.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[u&&!!c&&(0,a.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,a.jsx)(J,{thought:c})}),(0,a.jsx)(y.N,{initial:!1,children:!(u&&c)&&(0,a.jsxs)(b.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:f.A.inOutQuart},className:(0,j.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,a.jsx)(g.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,a.jsx)("p",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,a.jsx)(B,{text:t,useShimmer:!!i&&!s})})]})})]}),!!n&&(0,a.jsx)(v.K,{size:12,className:"text-text-500 mt-4"})]})}function W(e){var t,s;let{subtitle:n,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,w.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,O.mk)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return n?(0,a.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,a.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,a.jsx)(O.mq,{hrefs:o})}),(null==l?void 0:l.status)===p.zu.Completed&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,a.jsx)(B,{text:n,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,a.jsx)("div",{className:"text-text-500",children:(0,a.jsx)(O.YE,{startedAt:null!=(t=null==l?void 0:l.started_at)?t:null,completedAt:null!=(s=null==l?void 0:l.finished_at)?s:null})})]})]}):null}function J(e){let{thought:t}=e;return(0,a.jsx)("div",{className:"h-9 w-full",children:(0,a.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,a.jsx)(b.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:f.A.inOutBase},children:(0,a.jsx)(O.GT,{thought:t})})})})}function V(e){let{tools:t,onCancel:s,onApprove:n}=e,{servers:i}=(0,M.gt)();return(0,a.jsx)(u.aF,{modalSize:"xl",isOpen:!0,onClose:s,title:(0,a.jsx)(N.A,{defaultMessage:"Claude may use the following custom integrations while researching",id:"OKJu4YENMc"}),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 rounded-lg my-4 relative",children:[(0,a.jsx)("div",{className:"flex flex-col gap-4 p-4 max-h-[300px] overflow-y-auto",children:i.map(e=>{let s=t.filter(t=>t.server_uuid===e.uuid).map(e=>e.tool_name),n=e.tools.filter(e=>s.includes(e.name));return n.length?n.map(t=>(0,a.jsx)(m.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,a.jsx)(r.d,{url:e.url,fallbackSvg:(0,a.jsx)(l.B,{letter:e.name,size:30,fontSize:11,className:"shrink-0 font-medium mt-1"}),size:30}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"text-sm font-mono",style:{fontWeight:700},children:t.name}),(0,a.jsx)(F.M,{text:t.description,className:"text-[0.9rem] !text-text-500"})]})]})},t.name)):null})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-2 right-2 h-6 bg-gradient-to-t from-bg-200 to-bg-200/0 pointer-events-none z-10"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-accent-secondary-900 rounded-lg bg-accent-secondary-900/30",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(g.N,{className:"text-accent-secondary-000",size:16,weight:"bold"}),(0,a.jsx)("h4",{className:"text-accent-secondary-000 font-medium",children:(0,a.jsx)(N.A,{defaultMessage:"You are enabling Claude to retrieve content from your connected apps.",id:"RPQTc1f34V"})})]}),(0,a.jsx)("p",{className:"text-text-300",children:(0,a.jsx)(N.A,{defaultMessage:"Please ensure you have all appropriate permissions and trust these tools before continuing. <link>Learn more</link> about safely using Research with connected apps.",id:"b86SF7HKhH",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/11175166-about-custom-integrations-using-remote-mcp",target:"_blank",rel:"noopener noreferrer",children:e})}})})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(d.$,{variant:"outline",onClick:s,children:(0,a.jsx)(N.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,a.jsx)(d.$,{onClick:n,children:(0,a.jsx)(N.A,{defaultMessage:"Research with {count, plural, one {# tool} other {# tools}}",id:"H0wjvrIsuM",values:{count:t.length}})})]})]})})}},77336:(e,t,s)=>{s.d(t,{E:()=>n,V:()=>i});var a=s(7620);function n(e){let t=[];for(let a of e){var s;for(let e of null!=(s=a.files_v2)?s:a.files)"file_kind"in e&&t.push(e)}return t}let i=e=>(0,a.useMemo)(()=>n(e),[e])},84137:(e,t,s)=>{s.d(t,{CH:()=>b,GT:()=>C,IK:()=>j,Nw:()=>N,OQ:()=>w,Ui:()=>y,YE:()=>M,mk:()=>v,mq:()=>g});var a=s(54568),n=s(7726),i=s(11515),l=s(1336),r=s(77186),o=s(85544),c=s(21036),d=s(32987),u=s(37463),m=s(68864),x=s(7620),f=s(46760),h=s(75006),p=s(60098);function g(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,a.jsx)(u.P.div,{className:(0,d.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,a.jsx)(i.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,a.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function v(e){let{agents:t,n:s=5}=e,a=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(a.add(e.origin),a.size>=s)return Array.from(a).slice(0,s)}catch(e){}}}return Array.from(a)}function j(e,t){let s=!t||t===o.zu.Completed,a=(0,x.useRef)(s),{mutate:i}=(0,n.HF)(e,{refetchOnSettled:!0});(0,x.useEffect)(()=>{s&&!a.current&&i({settings:{compass_mode:null}}),a.current=s},[i,s,e])}function b(e){var t,s;let{organizationUUID:a,conversationUUID:i,taskId:l,isShared:d,enabled:u}=e,[f,h]=(0,x.useState)(!0),[,g]=(0,x.useState)(0),v=(0,c.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),j=null!=(s=null==(t=v[0])?void 0:t.intervalSeconds)?s:30,[b,y]=(0,x.useState)(j),w=(0,n._W)(i),{setCurrentCompassTask:_}=(0,p.o)(),N=d?"/api/organizations/".concat(a,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(a,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:k,isLoading:M,error:C}=(0,r.Sk)(N,{refetchInterval:!!f&&1e3*b,enabled:!!(u&&i&&a&&l),meta:{noToast:!0}}),S=(null==k?void 0:k.status)!==void 0&&!(0,o.i3)(null==k?void 0:k.status);return(0,x.useEffect)(()=>{if(u&&i&&a&&l)if(S)h(!1),_(void 0),w(),g(0);else if(C){if(!(null==k?void 0:k.started_at))return void h(!1);g(e=>{let t=e+1,s=m.c9.fromISO(k.started_at).plus({hours:3}),a=m.c9.now();return h(t<3&&a<s),t})}else k&&!S&&(g(0),_(l))},[u,l,S,C,w,a,i,k,_]),(0,x.useEffect)(()=>{if(!(null==k?void 0:k.started_at)||!f)return;let e=setInterval(()=>{let e=function(e,t){let s=m.c9.fromISO(e),a=m.c9.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||a<e.durationSeconds)return e.intervalSeconds;return 30}(k.started_at,v);e!==b&&y(e)},1e3*b);return()=>clearInterval(e)},[null==k?void 0:k.started_at,f,v,b]),{compassStatus:k,isLoading:M,error:C,completed:S}}let y=e=>{var t;return null==e||null==(t=e.agents[0])?void 0:t.name};function w(e){let t=(0,f.A)(),s=y(e);return s||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=h.z.object({thought:h.z.string()});function N(e){let t=null==e?void 0:e.agents[0];return(0,x.useMemo)(()=>{var e,s,a;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,i=n&&n.length>0?n[0]:void 0;if(i)return i.thinking;let l=null==t||null==(a=t.annotated_snippets[0])||null==(s=a.tool_calls)?void 0:s.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function k(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function M(e){let{startedAt:t,completedAt:s}=e,[n,i]=(0,x.useState)(()=>m.c9.now());if((0,x.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(m.c9.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=m.c9.fromISO(t);if(s){let e=m.c9.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,a.jsx)(a.Fragment,{children:k(e)})}let r=n.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,a.jsx)(a.Fragment,{children:k(r)})}function C(e){let{thought:t,className:s}=e;return t?(0,a.jsx)("div",{className:(0,d.A)("text-text-100 font-claude-response-body",s),children:(0,a.jsx)(l.fP,{text:t})}):null}},85101:(e,t,s)=>{s.d(t,{_:()=>b});var a=s(54568),n=s(90909),i=s(1761),l=s(41417),r=s(54890),o=s(84713),c=s(19921),d=s(49805),u=s(47211),m=s(29292),x=s(38759),f=s(20908),h=s(62971),p=s(20543),g=s(98252),v=s(85799),j=s(21570);function b(e){let{file:t,conversationUUID:s,onOpen:b,isInSidebar:y=!1,isShared:w}=e,{activeOrganization:_}=(0,i.YL)(),N=function(e){var t;let s=null==(t=e.split(".").pop())?void 0:t.toLowerCase();return s?["csv","tsv"].includes(s)?"table":["xls","xlsx"].includes(s)?"spreadsheet":["pptx"].includes(s)?"preso":["pdf","md","docx"].includes(s)?"doc":["mermaid","mmd"].includes(s)?"diagram":["jsx","tsx"].includes(s)?"code":["svg"].includes(s)||r._o.includes(s)?"image":r.Uv.includes(s)?"code":null:null}(t.name),k={code:{IconComponent:c.l,label:"Code",isPreviewable:!0},table:{IconComponent:d.K,label:"Table",isPreviewable:!0},spreadsheet:{IconComponent:d.K,label:"Spreadsheet",isPreviewable:!0},doc:{IconComponent:u.d,label:"Document",isPreviewable:!0},image:{IconComponent:m.x,label:"Image",isPreviewable:!0},diagram:{IconComponent:f.n,label:"Diagram",isPreviewable:!0},preso:{IconComponent:x.Z,label:"Presentation",isPreviewable:!1}},{IconComponent:M,label:C}=N?k[N]:{IconComponent:o.o,label:null},{displayName:S,displayExt:A}=(0,j.F)(t),z=C&&A?" \xb7 ":" ",E="".concat(null!=C?C:"").concat(z).concat(null!=A?A:""),I=!y&&(0,p.z)(t.path);return(0,a.jsx)(n.d,{icon:(0,a.jsx)(M,{size:32,weight:"light"}),properties:{id:t.path,title:S},displayType:E,actions:(0,a.jsxs)("div",{className:"flex items-center justify-center pr-4 gap-2",onClick:e=>{e.stopPropagation()},children:[I&&(0,a.jsx)(v.M,{file:t,conversationUUID:s,variant:"secondary",size:"icon"}),(0,a.jsx)(l.$,{variant:"secondary",onClick:e=>{e.preventDefault(),e.stopPropagation(),(null==_?void 0:_.uuid)&&(0,g.J)(w?{filepath:t.path,orgUuid:_.uuid,snapshotUuid:s,isShared:!0}:{filepath:t.path,orgUuid:_.uuid,conversationUuid:s,isShared:!1})},children:(0,a.jsx)(h.A,{id:"5q3qC0sC3r",defaultMessage:"Download"})})]}),onOpenArtifact:()=>{if((0,r.IO)(t.name))b();else{if(!(null==_?void 0:_.uuid))return;(0,g.J)(w?{filepath:t.path,orgUuid:_.uuid,snapshotUuid:s,isShared:!0}:{filepath:t.path,orgUuid:_.uuid,conversationUuid:s,isShared:!1})}}},t.path)}},85799:(e,t,s)=>{s.d(t,{M:()=>d});var a=s(54568),n=s(34059),i=s(41417),l=s(12072),r=s(62971),o=s(12189),c=s(20543);function d(e){let{file:t,conversationUUID:s,variant:d="ghost",size:u="icon_lg",className:m}=e,{handleOpenInGoogleDrive:x,showConnectionModal:f,setShowConnectionModal:h,connectionError:p,isExporting:g}=(0,c.N)({conversationUUID:s});return(0,c.z)(t.path)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.m,{tooltipContent:(0,a.jsx)(r.A,{defaultMessage:"Open in Drive",id:"r80/2fFyeU"}),side:"bottom",children:(0,a.jsx)(i.$,{variant:g?"secondary":d,size:u,loading:g,onClick:e=>{e.preventDefault(),e.stopPropagation(),x(t.path)},className:m,children:!g&&(0,a.jsx)(n.ft,{size:"icon_sm"===u?16:"icon"===u?20:24})})}),(0,a.jsx)(o.h,{isOpen:f,onClose:()=>{h(!1)},errorType:p,callerIdentifier:"google-drive-export-button"})]}):null}},88346:(e,t,s)=>{s.d(t,{CV:()=>et,ke:()=>ei});var a=s(42977),n=s(54568),i=s(68096),l=s(57931),r=s(27143),o=s(57067),c=s(98518),d=s(1761),u=s(51121),m=s(9537),x=s(90510),f=s(28885),h=s(41417),p=s(56370),g=s(24934),v=s(18179),j=s(37076),b=s(12072),y=s(9786),w=s(54890),_=s(64786),N=s(90119),k=s(61670),M=s(32987),C=s(49645),S=s(37463),A=s(20591),z=s.n(A),E=s(27261),I=s.n(E),T=s(7620),U=s(62971),L=s(46760),R=s(93901),O=s(41932),F=s(81527),D=s(56273),P=s(65755),B=s(42153),G=s(67048),W=s(7845);function J(){let e=(0,a._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return J=function(){return e},e}function V(e){let t,{onClose:s,onSubmitRating:a,onSubmitNotes:i}=e,l=(0,L.A)(),[r,o]=(0,T.useState)(!1),[c,d]=(0,T.useState)(""),u=e=>{a(e),o(!0)},x=()=>{s()};return t=r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("div",{className:"ml-1",children:(0,n.jsx)(U.A,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsx)("button",{onClick:x,children:(0,n.jsx)(B.X,{size:20})})})]}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(c),x()},children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(m.ks,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:c,onChange:e=>d(e.target.value)})}),(0,n.jsx)("div",{children:(0,n.jsx)(h.$,{variant:"primary",type:"submit",children:(0,n.jsx)(U.A,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(U.A,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,n.jsx)(G.t,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,n.jsx)(W.S,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:x,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,n.jsx)(B.X,{size:20})})]})]}),(0,n.jsxs)(H,{children:[(0,n.jsx)("div",{className:"p-3",children:t}),(0,n.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,n.jsx)("a",{className:"hover:underline",href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,n.jsx)(U.A,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let H=x.J.div(J());var q=s(66849),K=s(26631);let Y=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:a}=e,i=(0,T.useCallback)(()=>{a(!1)},[a]),{chatResourceState:{artifacts:l},dispatchChatResource:r}=(0,D.i)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),c=(0,T.useRef)(t),d=(0,T.useRef)(!1),u=(0,T.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUUID:e.versions[e.versions.length-1].uuid})})},[r]);(0,T.useEffect)(()=>{let e=c.current;return()=>{e&&!d.current&&(null==t?void 0:t.id)!==e.id&&u(e),d.current=!1}},[]);let m=(0,q.w)(),x=(0,L.A)();return o.length<2?null:(0,n.jsxs)(K.bL,{open:s,onOpenChange:e=>a(e),children:[(0,n.jsx)(K.l9,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,n.jsx)(b.m,{side:"right",className:"ml-2",tooltipContent:s?"":x.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,n.jsx)(f.S0,{size:20})})})}),(0,n.jsx)(K.UC,{align:"start",asChild:!0,children:(0,n.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>c.current&&u(c.current),children:o.map((e,t)=>{var s;let a=e.type?m[e.type]:null,l=(null==(s=c.current)?void 0:s.id)===e.id,r=x.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),f=e.versions.length>1?"".concat(e.versions.length):"",h=e.versions.length>1&&a?" \xb7 ":"";return(0,n.jsx)(S.P.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,n.jsxs)(K.q7,{className:(0,M.A)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",l?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>(e=>{d.current=!0,i();let t=o[e];c.current=t,u(t)})(t),onMouseEnter:()=>{u(e)},"aria-label":"".concat(e.title).concat(a?", ".concat(a):"").concat(f?", ".concat(f," ").concat(r):""),children:[(0,n.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,n.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,n.jsxs)(n.Fragment,{children:[f," ",r]}):null,h?(0,n.jsx)(n.Fragment,{children:h}):null,a]})]},e.id)},e.id)})})})]})};var $=s(96900),X=s(95549);async function Z(e){if(e.type!==w.vU.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return new Promise((s,a)=>{try{var n;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null==(n=l.contentWindow)?void 0:n.document);if(!r){document.body.removeChild(l),a(Error("Could not access iframe document"));return}let o=(null==e?void 0:e.title)||"Artifact";r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(o,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                * Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(t.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let c=document.title,d=()=>{try{document.title=c,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var t,n;document.title="".concat((null==e?void 0:e.title)||"Markdown Artifact");try{null==(t=l.contentWindow)||t.print()}catch(e){null==(n=l.contentDocument)||n.execCommand("print")}setTimeout(()=>{d(),s()},100)}catch(e){d(),a(e)}},l.onerror=e=>{d(),a(e)}}catch(e){a(e)}})}function Q(){let e=(0,a._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return Q=function(){return e},e}function ee(){let e=(0,a._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return ee=function(){return e},e}let et=e=>{var t,s,a,u,m,x,f,h,p,g,v;let{onClose:j,artifact:b,isStreaming:y,selectedArtifactMessageUUID:_,selectedArtifactVersionUUID:N,setSelectedArtifactVersionUUID:A,projectUuid:z,selectDoc:E,disablePublishing:I,sendMessage:U,richSandboxCapabilities:L,isOpen:O,isTemporary:P=!1}=e,{account:B}=(0,d.YL)(),G=(0,c.st)(),[W,J]=(0,T.useState)("normal"),H=(0,T.useRef)(null),[q,K]=(0,T.useState)(!1),Y=(0,d.mV)(),[Z,Q]=(0,T.useState)(!0),{data:ee}=(0,F.fo)(z),{data:et}=(0,R.m)({entityId:N,artifactEntityType:"artifact_version"}),ea=(0,T.useMemo)(()=>(null==et?void 0:et.mcp_servers)||[],[et]),ei=!I&&!Y,[el,{open:er,close:eo}]=(0,k.j)(!1),ec=(0,T.useCallback)(()=>{Q(!1)},[]),{data:ed}=(0,l.rC)({includeDeletedArtifacts:!0}),eu=y&&!(null==b||null==(t=b.versions[b.versions.length-1])?void 0:t.isClosed),em=(0,T.useMemo)(()=>{if(!b)return 0;if(!eu&&N&&_!==o.gv){let e=b.versions.findIndex(e=>e.uuid===N);if(-1!==e)return e}return!eu&&_&&_!==o.gv?b.versions.findIndex(e=>e.message===_):b.versions.length-1},[_,N,eu,b]),ex=null==b||null==(s=b.versions[em])?void 0:s.uuid;(0,T.useEffect)(()=>{ex&&ex!==N&&A(ex),J("normal")},[null==b?void 0:b.id,ex,A,N]);let ef=Y&&!P,[eh,{open:ep,close:eg}]=(0,k.j)(!1),ev=b&&(null==ed||null==(a=ed.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===b.id&&s===b.versions[em].message}))?void 0:a.published_artifact_uuid),ej=null!=(h=null==ed?void 0:ed.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ev&&s}))&&h,eb=null==b||null==(u=b.versions[em])?void 0:u.message,[ey,ew]=(0,T.useState)(!1);(0,T.useEffect)(()=>ew(ey||y),[ey,y]);let[e_,eN]=(0,T.useState)(!1);(0,T.useEffect)(()=>eN(!1),[_,eb]);let[ek,eM]=(0,T.useState)(!1),{data:eC}=(0,l.SN)(),{mutate:eS}=(0,i.Jy)(),{track:eA}=(0,c.st)(),ez=null!=(p=(0,D.i)().chatResourceState.conversationUUID)?p:"",{mutateAsync:eE}=(0,l._2)(ez),eI=(0,T.useCallback)(async()=>{if(!N)try{var e;let{artifactVersionUUID:t}=await eE({version_index:em,artifact_identifier:null!=(e=null==b?void 0:b.id)?e:""});A(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}eA({event_key:"artifact.share_button_clicked",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),ep()},[N,ep,eE,em,null==b?void 0:b.id,A,eA,eb,null==b?void 0:b.type,null==b?void 0:b.language]),eT=(0,T.useCallback)(()=>{eA({event_key:"artifact.publish_button_clicked",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),er()},[er,eA,eb,null==b?void 0:b.type,null==b?void 0:b.language]),eU=(null==b?void 0:b.type)===w.vU.Text,eL=(null==b?void 0:b.type)===w.vU.Markdown||(null==b?void 0:b.type)===w.vU.Code,eR=(null==b?void 0:b.type)===w.vU.Html||(null==b?void 0:b.type)===w.vU.React,eO=(null==b?void 0:b.type)!==w.vU.Text&&!(eu&&((null==b?void 0:b.type)===w.vU.Svg||(null==b?void 0:b.type)===w.vU.Mermaid||(null==b?void 0:b.type)===w.vU.React||(null==b?void 0:b.type)===w.vU.Html)),eF=!eO||"raw"===W,eD=e_||ey&&!y&&!ek&&!(null==B?void 0:B.settings.dismissed_artifact_feedback_form)&&eC,eP=null!=(g=null==b?void 0:b.versions.length)?g:0,[eB,eG]=(0,T.useState)(!1),eW=z&&b?{show:!eu&&!(null==ee?void 0:ee.is_starter_project),artifact:b,projectUuid:z,selectedVersion:em,selectDoc:E}:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)(b?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eB&&eG(!1),children:[(0,n.jsx)(es,{versionCount:eP,selectedVersion:em,artifact:b,canRenderNormal:eO,canOnlyRenderRaw:eU,canOnlyRenderNormal:eL,viewing:W,setViewing:J,showRaw:eF,canRefresh:eR,isSandboxLoading:Z,handleRefresh:()=>{Q(!0),H.current&&H.current.refresh()},canShare:ef,handleOpenShareModal:eI,isStreaming:y,onClose:j,hasMenuOpen:eB,setHasMenuOpen:eG,canPublish:ei,wasUnpublished:ej,publishedArtifactUuid:ev,openPublishModal:eT,projectParams:eW,richSandboxRef:H,hasArtifactToolConfig:!!(null==et||null==(m=et.mcp_servers)?void 0:m.length),setShowArtifactMcpModal:K,handleVersionSelect:e=>{let t=null==b?void 0:b.versions[e].uuid;t&&A(t)}}),(0,n.jsx)(r.k,{isOpen:O,content:null!=(v=null==b||null==(x=b.versions[em])?void 0:x.resultState)?v:"",type:null==b?void 0:b.type,citations:null==b||null==(f=b.versions[em])?void 0:f.citations,language:void 0===b?void 0:b.language||w.K5[b.type].syntaxName,showRaw:eF,richSandboxRef:H,isCurrentStreaming:eu,isChatStreaming:y,onSandboxConfirmation:ec,sendMessage:U,richSandboxCapabilities:L,isLatestVersion:!!b&&em===b.versions.length-1,artifactId:null==b?void 0:b.id,artifactContext:N?{uuid:N,type:"artifact_version"}:void 0,artifactVersion:em,onArtifactRuntimeError:e=>{G.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==N?void 0:N.toString(),error_type:e.type,source:null==b?void 0:b.versions[em].source})},artifact:b,hasMenuOpen:eB,ArtifactMcpModal:$.I}),(0,n.jsx)(C.N,{children:eD&&(0,n.jsx)(S.P.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,n.jsx)("div",{children:(0,n.jsx)(V,{onSubmitNotes:e=>{eA({event_key:"artifact.feedback.note",note:e,message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eN(!1)},onSubmitRating:e=>{eA({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eS({...null==B?void 0:B.settings,dismissed_artifact_feedback_form:!0}),eN(!0)},onClose:()=>{eM(!0),eS({...null==B?void 0:B.settings,dismissed_artifact_feedback_form:!0}),eN(!1)}})})})})]}),(null==b?void 0:b.versions[em])&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X.Dr,{messageUuid:b.versions[em].message,isOpen:el&&!ej,onClose:eo,artifact:b,selectedVersion:em,publishedArtifactUuid:ev,richSandboxRef:H}),ef&&N&&(0,n.jsx)(en,{isOpen:eh,onClose:eg,artifactVersionUuid:N,artifact:b,messageUuid:b.versions[em].message,isProjectArtifact:!!(null==ee?void 0:ee.is_private)})]}),q&&N&&(0,n.jsx)($.I,{isOpen:q,requestedServers:ea,onClose:()=>K(!1),artifactContext:{uuid:N,type:"artifact_version"}})]})};function es(e){var t;let{versionCount:s,selectedVersion:a,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:c,setViewing:d,showRaw:x,canRefresh:j,isSandboxLoading:k,handleRefresh:C,canShare:S,handleOpenShareModal:A,isStreaming:E,canPublish:I,wasUnpublished:R,publishedArtifactUuid:F,projectParams:D,onClose:B,openPublishModal:G,handleVersionSelect:W,hasMenuOpen:J,setHasMenuOpen:V,richSandboxRef:H,hasArtifactToolConfig:q,setShowArtifactMcpModal:K}=e,$=(0,L.A)(),X=(0,N.V)(_.E_),{copyToClipboard:Q,didCopy:ee}=(0,y.C)(),{copyToProject:et,isCopiedToProject:es}=function(e){let{projectUuid:t,artifact:s,selectedVersion:a}=e,[i,l]=(0,T.useState)(!1),{mutateAsync:r,data:o}=(0,O.fh)(null!=t?t:""),{addError:c}=(0,u.Y)();return(0,T.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(w.K5[s.type].extension()),content:null!=(e=s.versions[a].resultState)?e:""})}catch(e){c((0,n.jsx)(U.A,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}))}},isCopiedToProject:i}}({artifact:i,projectUuid:null!=(t=null==D?void 0:D.projectUuid)?t:"",selectedVersion:a});async function en(){var e,t;if(!i)return;let s=i.type===w.vU.Markdown,n=i.type===w.vU.React,l=null!=(e=i.versions[a].resultState)?e:"";if(n&&H.current){let e=await (null==(t=H.current)?void 0:t.copyHtmlContent());e?await Q({text:e,html:e}):await Q(l)}else if(s)try{let e=(0,P.u)(l);await Q({text:l,html:e})}catch(e){await Q(l)}else await Q(l)}let{ref:ei,width:el}=function(){let e=(0,T.useRef)(null),[t,s]=(0,T.useState)(()=>{var t,s;return null!=(s=null==(t=e.current)?void 0:t.offsetWidth)?s:null});return(0,T.useEffect)(()=>{let t=z()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),a=new ResizeObserver(t);if(e.current){let s=e.current;return t(),a.observe(s),()=>a.disconnect()}},[]),{ref:e,width:t}}(),er=el&&el<480,eo=!x&&j,{addError:ec}=(0,u.Y)(),ed=(null==i?void 0:i.type)===w.vU.Markdown&&"raw"!==c?(0,n.jsx)(p.tJ,{onSelect:async()=>{try{await Z(i)}catch(e){ec((0,n.jsx)(U.A,{defaultMessage:"Error saving as PDF",id:"kemaiSh7+2"}))}},children:(0,n.jsx)(U.A,{defaultMessage:"Save as PDF",id:"rv9NrWszM1"})},"saveAsPdf"):null,eu=i?(0,n.jsx)(p.tJ,{asChild:!0,"data-testid":"export-download",children:(0,n.jsx)(ea,{artifact:i,selectedVersion:a})},"download"):null;return(0,n.jsxs)("div",{ref:ei,className:(0,M.A)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",X?[_.X_,_.zo,"draggable"]:"py-2"),children:[i&&(0,n.jsx)(Y,{currentArtifact:i,hasMenuOpen:J,setHasMenuOpen:V}),J?(0,n.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,n.jsx)(U.A,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!x&&eo&&k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)("flex items-center flex-1 gap-2"),children:[!(!l||r||o)&&(0,n.jsx)(m.Iz,{options:[{key:"normal",label:(0,n.jsx)(f.kU,{size:16}),ariaLabel:$.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,n.jsx)(f.Cy,{size:16}),ariaLabel:$.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===c?"normal":"code",onSelect:e=>{d("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===c?"normal":"code"),s>1?(0,n.jsx)(p.ms,{align:"start",trigger:(0,n.jsxs)(h.$,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",a+1,er||a!==s-1?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"∙"}),(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,n.jsx)(f.bi,{size:16,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,n.jsxs)(p.tJ,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>W(e-1),children:[(0,n.jsx)(U.A,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,n.jsxs)(n.Fragment,{children:[" - ",(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===a?(0,n.jsx)(f.Jl,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,n.jsxs)("div",{className:(0,M.A)("flex gap-2 items-center text-sm"),children:[er?(0,n.jsxs)(p.ms,{align:"end",trigger:(0,n.jsx)(h.$,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger","aria-label":$.formatMessage({defaultMessage:"More options for artifact",id:"O91Ji7GVP2"}),children:(0,n.jsx)(f.tx,{size:16})}),children:[eo&&(0,n.jsx)(p.tJ,{disabled:k,onSelect:C,children:(0,n.jsx)(U.A,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),q&&!x&&(0,n.jsx)(p.tJ,{onSelect:()=>K(!0),children:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"})},"manage-connectors"),(0,n.jsx)(p.tJ,{onSelect:en,children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),S?(0,n.jsx)(p.tJ,{onSelect:A,children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,R?(0,n.jsx)(p.tJ,{disabled:!0,onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):I?(0,n.jsx)(p.tJ,{onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,eu,ed]}):(()=>{let e=!x&&eo&&(k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:C,children:(0,n.jsx)(f.Mv,{size:16})})),t=S&&(0,n.jsx)(h.$,{onClick:A,variant:"primary",size:"sm",disabled:E,prepend:(0,n.jsx)(f.SY,{size:16,className:"mr-0.5"}),children:(0,n.jsx)("span",{className:"text-sm",children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})}),s=I&&(0,n.jsx)(b.m,{open:!!R&&void 0,tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,n.jsx)(h.$,{onClick:G,variant:"primary",size:"sm",disabled:R||E,className:(0,M.A)(R&&"!pointer-events-auto"),children:(0,n.jsx)("span",{className:"text-sm",children:void 0===F||R?(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,n.jsx)(U.A,{defaultMessage:"Published",id:"w7tf2zwi6+"})})})}),a=(0,n.jsxs)(g.g,{align:"end",defaultButtonLabel:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:(0,M.A)(ee?"invisible":""),children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),ee?(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(f.Jl,{size:16})}):null]}),onClickDefaultButton:en,children:[(null==D?void 0:D.show)?es?(0,n.jsx)(p.tJ,{disabled:!0,children:(0,n.jsx)(U.A,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,n.jsx)(p.tJ,{onSelect:et,children:(0,n.jsx)(U.A,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,eu,ed]}),i=q&&!x&&(0,n.jsx)(b.m,{tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>K(!0),children:(0,n.jsx)(f.wB,{size:16})})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[e,i]}),a,t,s]})})(),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:B,children:(0,n.jsx)(f.X,{size:16})})]})]})]})}function ea(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:a,filename:i}=((e,t)=>{let[s,a]=(0,T.useState)(""),[n,i]=(0,T.useState)("");return(0,T.useEffect)(()=>{var s;let n=null!=(s=e.versions[t].resultState)?s:"",l=(0,w.eg)(e),r=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(r);return a(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:n}})(t,s),l=function(e){switch(e.type){case w.vU.Markdown:return"Markdown";case w.vU.Html:return"HTML";case w.vU.React:return"TSX";case w.vU.Svg:return"SVG";case w.vU.Text:return"TXT";case w.vU.Mermaid:return"Mermaid";case w.vU.Code:var t;return null!=(t=w.K5[e.type].extension(e))?t:null;default:return null}}(t);return(0,n.jsx)("a",{href:a,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000",children:l?(0,n.jsx)(U.A,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,n.jsx)(U.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}x.J.div(Q()),x.J.div(ee());let en=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:a,artifact:i,messageUuid:r,isProjectArtifact:o}=e,d=(0,L.A)(),{track:u}=(0,c.st)(),{mutateAsync:m,isPending:x}=(0,l.yE)(a),{data:f,isLoading:h}=(0,l.EC)(a),p=(null==f?void 0:f.visibility)==="shared",g=x||h,[v,j]=(0,T.useState)("");(0,T.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>j(""),5e3);return()=>clearTimeout(e)},[v]);let b="".concat(window.location.origin,"/artifacts/").concat(a),{copyToClipboard:w}=(0,y.C)(),_=g?"loading":p?"shared":"private",N=(0,T.useRef)(_);N.current!==_&&("loading"!==N.current&&"private"===_&&j(d.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),N.current=_);let k=e=>{"private"===e&&p&&m({visibility:"private"}).then(()=>t()),"shared"!==e||p||m({visibility:"shared"}).then(()=>w(b))};return(0,n.jsx)(ei,{isOpen:s,onClose:t,isLoading:g,isShared:p,isProjectArtifact:o,sharedLink:b,updateSharedState:k,handleClickShareButton:()=>{k("shared"),u({event_key:"artifact.share.modal.share_button_clicked",message_uuid:r,artifact_type:i.type,artifact_language:i.language})}})};function ei(e){let{isOpen:t,onClose:s,isShared:a,isProjectArtifact:i,sharedLink:l,isLoading:r,updateSharedState:o,handleClickShareButton:c}=e,{copyToClipboard:d,didCopy:u}=(0,y.C)();return(0,n.jsx)(j.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:a?(0,n.jsx)(U.A,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,n.jsx)(U.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:t,onClose:s,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsx)("div",{className:"mt-1 flex flex-col gap-2.5",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(f.qz,{className:"mt-1",size:16})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,n.jsx)("p",{className:"text-text-300 tracking-tight",children:i?(0,n.jsx)(U.A,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(I(),{className:"text-text-300 truncate text-sm",href:l,children:l}),(0,n.jsx)(h.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{d(l)},prepend:u?(0,n.jsx)(f.rA,{size:16}):(0,n.jsx)(f.Xq,{size:16}),children:u?(0,n.jsx)(U.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)(U.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(h.$,{size:"lg",variant:"secondary",loading:r,onClick:()=>o("private"),children:(0,n.jsx)(U.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:i?(0,n.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,n.jsx)(f.R2,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)(U.A,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,n.jsx)("p",{children:(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,n.jsx)(f.c_,{className:"mt-0.5",size:16}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,n.jsx)("p",{className:"text-text tracking-tight-300",children:(0,n.jsx)(U.A,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(h.$,{size:"lg",loading:r,onClick:c,children:(0,n.jsx)(U.A,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})})})}},89436:(e,t,s)=>{s.d(t,{t:()=>l});var a=s(54568),n=s(1761),i=s(62971);function l(e){let t,{project:s,className:l}=e,{account:r}=(0,n.YL)();if(s.is_starter_project)t=(0,a.jsx)(i.A,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var o;t=(null==(o=s.creator)?void 0:o.full_name)?s.creator.uuid===(null==r?void 0:r.uuid)?(0,a.jsx)(i.A,{defaultMessage:"Created by you",id:"WEhuQZAqE6"}):(0,a.jsx)(i.A,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,a.jsx)(i.A,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,a.jsx)("span",{className:l,children:t})}},93901:(e,t,s)=>{s.d(t,{X:()=>o,m:()=>r});var a=s(77186),n=s(1761),i=s(87606);let l="artifact_tool_configuration",r=e=>{let{entityId:t,artifactEntityType:s}=e,{activeOrganization:i}=(0,n.YL)(),r=null==i?void 0:i.uuid;return(0,a.Sk)("/api/organizations/".concat(r,"/artifacts/").concat(s,"/").concat(t,"/tools"),{queryKey:[l,{orgUuid:r,entityId:t,artifactEntityType:s}],enabled:!!r&&!!t,meta:{noToast:!0}})},o=e=>{let{entityId:t,artifactEntityType:s}=e,{activeOrganization:r}=(0,n.YL)(),o=null==r?void 0:r.uuid,c=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(o,"/artifacts/").concat(s,"/").concat(t,"/tools"),"POST",{enabled:!!o&&!!t,onSuccess:()=>{c.invalidateQueries({queryKey:[l,{orgUuid:o,entityId:t,artifactEntityType:s}]})},meta:{noToast:!0}})}},94748:(e,t,s)=>{s.d(t,{NG:()=>f,aX:()=>h,sH:()=>p});var a=s(54568),n=s(28885),i=s(64359),l=s(37711),r=s(12072),o=s(98769),c=s(32987),d=s(37463),u=s(7620),m=s(33792),x=s(11480);let f=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:n,children:l,className:r,onTransitionEnd:m,collapsesHalfway:x,setIsExpanded:f,footer:h}=e,p=(0,u.useRef)(t),g=!!(x&&!t&&f),v=x&&!t;return(0,a.jsxs)(d.P.div,{className:(0,c.A)("overflow-hidden shrink-0",!t&&g&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:p.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:.6*!!x,height:72*!!x}},whileHover:{opacity:1},transition:n?{ease:o.A.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:m,onClick:g?()=>f(!0):void 0,children:[(0,a.jsx)(i.r,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,c.A)("h-full",s&&"!max-h-[238px]",r,v&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l}),h]})},h=e=>{let{handleClick:t,isDisabled:s,isExpanded:i,isStreaming:o,isError:u,errorMessage:f,icon:h,text:p,secondaryIcon:g,secondaryText:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,className:y,wrapperClassName:w,children:_,renderMode:N=m.l.Standard,isFirstItemInGroup:k,isLastItemInGroup:M}=e,C=s||!t,S=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:t,className:(0,c.A)("group/row flex flex-row items-center justify-between gap-4 transition-colors duration-200 rounded-lg text-text-300 hover:text-text-200 h-[2.625rem] py-2 px-3",C?"cursor-default":"cursor-pointer hover:text-text-000",y),disabled:C,children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[h&&N!==m.l.TimelineGroup&&(0,a.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:h}),(0,a.jsx)("div",{className:"relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:o?(0,a.jsx)(l.N,{children:p}):p})]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:u?(0,a.jsx)(r.m,{tooltipContent:f,align:"center",children:(0,a.jsx)(n.N5,{size:16,className:"text-danger-000"})}):(0,a.jsxs)(a.Fragment,{children:[!!v&&(0,a.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap",children:v}),g]})})]},o?"streaming":"non-streaming"),_]});return N===m.l.TimelineGroup?(0,a.jsx)(x.i1,{icon:h,isExpanded:i,isFirstItem:!!k,isLastItem:!!M,isActive:o&&b&&M,children:S}):(0,a.jsx)(d.P.div,{initial:{opacity:+!o},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,c.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!i&&"hover:bg-bg-000 hover:shadow-sm",j?"mt-2":"mt-3",b?"mb-2":"mb-3",i&&"bg-bg-000 shadow-sm",w),children:S})},p=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...i}=e,{isExpanded:l,isError:r,secondaryIcon:o}=i,d=t||r;return(0,a.jsx)(h,{...i,isDisabled:d,handleClick:()=>s(!l),secondaryIcon:(0,a.jsxs)(a.Fragment,{children:[o,!d&&(0,a.jsx)(n.bi,{className:(0,c.A)("relative bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",l?"-rotate-180":"rotate-0",d&&"opacity-15"),size:16})]})})}},95549:(e,t,s)=>{s.d(t,{Dr:()=>A,L_:()=>M,_L:()=>k});var a=s(54568),n=s(57931),i=s(98518),l=s(10158),r=s(9537),o=s(28885),c=s(41417),d=s(37076),u=s(12072),m=s(9786),x=s(91961),f=s(27062),h=s(32987),p=s(92012),g=s.n(p),v=s(61773),j=s(27261),b=s.n(j),y=s(7620),w=s(62971),_=s(46760);let N=e=>{let{artifact:t,selectedVersion:s,messageUuid:r,isOpen:o,richSandboxRef:c,copyToClipboard:d}=e,{track:u}=(0,i.st)(),{publishedArtifactsBaseUrl:m}=(0,l._r)(),{mutateAsync:x,isPending:f}=(0,n.yx)(),[h,p]=(0,y.useState)(),g=(0,y.useCallback)(async()=>{var e;let t=await (null==(e=c.current)?void 0:e.getScreenshot());t&&p(t)},[c]);return(0,y.useEffect)(()=>{o&&c.current&&g()},[c,o,g]),(0,a.jsx)(k,{canScreenshot:!0,title:t.title,isLoading:f,screenshot:h,fetchScreenshot:g,setScreenshot:p,handlePublishArtifact:()=>{var e;x({title:t.title,artifact_type:t.type,code_language:t.language,message_uuid:r,artifact_identifier:t.id,content:null!=(e=t.versions[s].resultState)?e:"",screenshot:h,artifact_version_uuid:t.versions[s].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return d("".concat(m,"/public/artifacts/").concat(t))}),u({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:r,artifact_type:null==t?void 0:t.type,artifact_language:null==t?void 0:t.language})}})};function k(e){let{canScreenshot:t,title:s,isLoading:n,screenshot:i,fetchScreenshot:l,setScreenshot:r,handlePublishArtifact:d}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,a.jsx)("p",{children:(0,a.jsx)(w.A,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet and potentially visible in search engine results. Your chat will remain private.",id:"zG4O5rdNXZ"})})}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[t?(0,a.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[i?(0,a.jsx)("img",{src:i,alt:s,className:"w-full h-auto bg-always-white"}):(0,a.jsx)(v.default,{src:"/images/claude_ogimage.png",alt:s,className:"w-full h-auto",width:1138,height:640}),!i&&(0,a.jsx)(E,{handleCapture:()=>void l()})]}),i&&(0,a.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,a.jsx)(z,{handleRemove:()=>r(void 0)})})]}):null,(0,a.jsx)("div",{children:null!=s?s:(0,a.jsx)(w.A,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,a.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,a.jsx)(o.R2,{size:16,className:"mt-0.5 shrink-0"}),(0,a.jsx)("span",{children:(0,a.jsx)(w.A,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Don’t share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,a.jsx)(b(),{href:"https://www.anthropic.com/legal/aup",target:"_blank",className:"underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(c.$,{size:"lg",loading:n,onClick:d,children:(0,a.jsx)(w.A,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})}let M=e=>{let{artifactUuid:t,publishedLink:s,onClose:i}=e,{copyToClipboard:l,didCopy:r}=(0,m.C)(),{mutateAsync:d,isPending:u}=(0,n.lT)(t),x=async()=>{await d({}),i()};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl my-3",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(o.qz,{className:"mt-1",size:16})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(w.A,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,a.jsx)("p",{className:"text-text-300 tracking-tight",children:(0,a.jsx)(w.A,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(b(),{className:"text-text-300 truncate text-sm",href:s,children:s}),(0,a.jsx)("div",{children:(0,a.jsx)(c.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{l(s)},prepend:r?(0,a.jsx)(o.rA,{size:16}):(0,a.jsx)(o.Xq,{size:16}),children:r?(0,a.jsx)(w.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(w.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(c.$,{size:"lg",variant:"secondary",loading:u,onClick:x,children:(0,a.jsx)(w.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,a.jsxs)("p",{className:"text-text-400 text-xs tracking-tight",children:[(0,a.jsx)(w.A,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,a.jsx)("br",{}),(0,a.jsx)(w.A,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]})},C=e=>e.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0),S=e=>{let{artifactUuid:t,closeEmbedSettings:s,embedLink:i}=e,l=(0,_.A)(),{mutateAsync:d}=(0,n.eH)(t),{data:u,isSuccess:x}=(0,n.gY)(t),{copyToClipboard:f,didCopy:h}=(0,m.C)(),p='<iframe src="'.concat(i,'" title="Claude Artifact" width="100%" height="600" frameborder="0" allow="clipboard-write" allowfullscreen></iframe>'),[v,j]=(0,y.useState)(""),[b,N]=(0,y.useState)(!1),[k,M]=(0,y.useState)(!1),S=/^(?:(\*\.)?)(?:[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,24}[a-z0-9]$/,A=C(v),z=A.filter(e=>!S.test(e)),[E,I]=(0,y.useState)([]),T=!g()(A.toSorted(),E.toSorted());(0,y.useEffect)(()=>{if(u){var e,t;let s=null!=(t=null==(e=u.embed_whitelist)?void 0:e.join(", "))?t:"";j(s),I(C(s))}},[x,u]);let U=async()=>{t&&(await d({embed_whitelist:A}),I(A),M(!0))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-text-100 font-base-bold",children:(0,a.jsx)(w.A,{defaultMessage:"Allowed domains",id:"J1MOf/PGed"})}),(0,a.jsx)("p",{className:"text-text-300 font-small mb-2",children:(0,a.jsx)(w.A,{defaultMessage:"Only these domains can embed this artifact. Separate with commas.",id:"mySCaN71No"})}),(0,a.jsx)(r.fs,{value:v,onValueChange:e=>{j(null!=e?e:""),N(!0),M(!1)},onBlur:()=>{N(!1),T&&0===z.length&&U()},placeholder:"www.example.com, www.myblog.com",minRows:1,className:"text-sm"}),(0,a.jsx)("div",{className:"font-base mt-2 text-danger-000",children:z.length>0&&!b?1===z.length?l.formatMessage({defaultMessage:"{invalidDomain} is not a valid domain",id:"4BVWTznQQj"},{invalidDomain:z[0]}):l.formatMessage({defaultMessage:"{invalidDomains} are not valid domains",id:"woDBbyq+SX"},{invalidDomains:"".concat(z.slice(0,z.length-1).join(", ")," and ").concat(z[z.length-1])}):void 0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-text-100 font-base-bold mb-2",children:(0,a.jsx)(w.A,{defaultMessage:"Embed code",id:"O4prKQr/hN"})}),(0,a.jsx)(r.fs,{value:p,readOnly:!0,className:"text-sm read-only:text-text-200 read-only:!opacity-100",rows:5}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-4",children:[k&&(0,a.jsxs)("div",{className:"text-xs flex-grow flex items-center gap-1",children:[(0,a.jsx)(o.Jl,{size:12,className:"inline"}),(0,a.jsx)(w.A,{defaultMessage:"Saved",id:"fsB/4pdUqN"})]}),(0,a.jsx)(c.$,{size:"default",variant:"secondary",onClick:s,children:(0,a.jsx)(w.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(c.$,{size:"default",variant:"primary",prepend:h?(0,a.jsx)(o.rA,{size:14}):(0,a.jsx)(o.QR,{size:14}),onClick:()=>f(p),className:"w-28",children:(0,a.jsx)(w.A,{defaultMessage:"Copy code",id:"CNXQN5zp9z"})})]})]})]})},A=e=>{let t,s,{onClose:n,isOpen:i,artifact:r,selectedVersion:u,messageUuid:x,publishedArtifactUuid:p,richSandboxRef:g}=e,v=(0,_.A)(),{publishedArtifactsBaseUrl:j,publishedArtifactsEmbedBaseUrl:b}=(0,l._r)(),{value:k}=(0,f.fS)("embed_artifacts"),C=!!p,[A,z]=(0,y.useState)(!1),E="".concat(j,"/public/artifacts/").concat(p),I="".concat(b,"/public/artifacts/").concat(p,"/embed"),[T,U]=(0,y.useState)("");(0,y.useEffect)(()=>{if(""===T)return;let e=setTimeout(()=>U(""),5e3);return()=>clearTimeout(e)},[T]);let{copyToClipboard:L}=(0,m.C)(),R=C?"shared":"private",O=(0,y.useRef)(R);O.current!==R&&("private"===R&&U(v.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),O.current=R);let F=()=>{U(""),z(!1),n()};return A?(t=(0,a.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[(0,a.jsx)(c.$,{variant:"unstyled",size:"unset",className:"-mt-1",onClick:()=>z(!1),children:(0,a.jsx)(o.ZK,{})}),(0,a.jsx)(w.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})]}),s=(0,a.jsx)(S,{artifactUuid:null!=p?p:"",closeEmbedSettings:()=>z(!1),embedLink:I})):C?(t=(0,a.jsx)(w.A,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}),s=(0,a.jsx)(M,{artifactUuid:null!=p?p:"",publishedLink:E,onClose:F})):(t=(0,a.jsx)(w.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),s=(0,a.jsx)(N,{artifact:r,selectedVersion:u,messageUuid:x,isOpen:i,richSandboxRef:g,copyToClipboard:L})),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(d.aF,{title:(0,a.jsx)("span",{className:"text-text-200 font-heading  font-medium",children:t}),isOpen:i,onClose:F,modalSize:"lg",hasCloseButton:!0,className:(0,h.A)(!A&&"-mt-20","!p-8 !rounded-2xl"),children:[(0,a.jsxs)("div",{className:"mt-2 flex flex-col gap-2.5",children:[T&&(0,a.jsx)("div",{className:"bg-accent-secondary-900 text-accent-secondary-000 rounded-2xl px-3 py-2 text-sm",children:T}),s]}),k&&C&&!A&&(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-3",children:(0,a.jsx)("div",{className:"bg-bg-100 border-0.5 border-border-300 rounded-2xl shadow-lg p-3",onClick:()=>{z(!0)},children:(0,a.jsxs)(c.$,{variant:"ghost",className:"flex items-center justify-between py-3 pl-3 pr-3 cursor-pointer hover:bg-bg-200/50 transition-colors rounded-xl w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",children:(0,a.jsx)(o.NG,{size:16,className:"text-text-300"})}),(0,a.jsx)("span",{className:"text-text-100",children:(0,a.jsx)(w.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})})]}),(0,a.jsx)(o.K3,{size:16,className:"text-text-300"})]})})})]})})},z=e=>{let{handleRemove:t}=e;return(0,a.jsx)(u.m,{tooltipContent:(0,a.jsx)(w.A,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,a.jsx)("button",{className:(0,h.A)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,x.Fr)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,a.jsx)(o.X,{size:12})})})},E=e=>{let{handleCapture:t}=e;return(0,a.jsx)("div",{className:"absolute inset-0 items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,a.jsx)(u.m,{tooltipContent:(0,a.jsx)(w.A,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,a.jsx)(c.$,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,a.jsx)(o.i7,{})})})})}},96900:(e,t,s)=>{s.d(t,{I:()=>R});var a=s(42977),n=s(54568),i=s(18472),l=s(8027),r=s(11515),o=s(51121),c=s(86030),d=s(9537),u=s(90510),m=s(22529),x=s(28885),f=s(41417),h=s(64359),p=s(37076),g=s(12072),v=s(62094),j=s(43989),b=s(32987),y=s(27261),w=s.n(y),_=s(7620),N=s(46760),k=s(62971),M=s(93901),C=s(92075),S=s(92947),A=s(45078),z=s(66436),E=s(88185);function I(){let e=(0,a._)(["\n  bg-bg-000 \n  border-0.5 \n  border-border-300 \n  rounded-lg \n  shadow-sm\n  p-5\n  flex \n  flex-col \n  gap-4\n  items-stretch\n  self-stretch\n"]);return I=function(){return e},e}let T=u.J.div(I()),U=e=>{let{isOpen:t,onClose:s,variant:a,unknownServerCount:i}=e,l=(0,N.A)();return(0,n.jsxs)(p.aF,{title:l.formatMessage({defaultMessage:"Connectors unavailable",id:"nKB/o0ajrR"}),isOpen:t,onClose:s,children:[(0,n.jsx)("div",{className:"flex flex-col gap-3 py-3",children:(0,n.jsx)(T,{children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:"disabled"===a?(0,n.jsx)(k.A,{defaultMessage:"Your organization admin has disabled connectors in artifacts. To use this feature, ask your admin to enable connectors in artifacts.",id:"+0AXIvgEHO"}):(0,n.jsx)(k.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:i||0,link:(0,n.jsx)(w(),{href:"/settings/connectors",className:"underline",children:(0,n.jsx)(k.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})})}),(0,n.jsx)(p.vW,{children:(0,n.jsx)(f.$,{variant:"primary",onClick:s,children:(0,n.jsx)(k.A,{defaultMessage:"Close",id:"rbrahOGMC3"})})})]})},L=e=>{let{server:t,variant:s,onClick:a,enabledToolsCount:o}=e,{isRemoteServerInDirectory:d}=(0,E.hW)(),u=(0,S.QD)(),[m,x]=(0,_.useState)(!1),h=!!t&&"remote"===t.type&&d(t);return(0,n.jsxs)("div",{className:(0,b.A)("w-full flex items-center justify-between rounded-lg bg-bg-000",a&&"connect"!==s&&"cursor-pointer hover:bg-bg-100 transition-colors"),onClick:"connect"===s?void 0:a,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,n.jsx)(i.O,{size:28,className:"flex-shrink-0",children:(0,n.jsx)(r.d,{url:t.url,fallbackSvg:(0,n.jsx)(l.B,{letter:t.name||t.url||"",size:16}),size:16})}),(0,n.jsxs)("div",{className:"flex gap-2 items-center min-w-0 flex-1",children:[(0,n.jsx)(g.m,{tooltipContent:t.url||t.name||"",children:(0,n.jsx)("div",{className:"font-medium text-sm truncate",children:t.name||t.url||""})}),!h&&(0,n.jsx)(c.E,{className:"flex-shrink-0",children:(0,n.jsx)(k.A,{defaultMessage:"CUSTOM",id:"Jg/zGahNtM"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:"connect"===s?(0,n.jsx)(f.$,{variant:"secondary",size:"sm",onClick:e=>{e.stopPropagation(),x(!0),u({uuid:t.uuid||"",url:t.url})},loading:m,className:"ml-2",children:(0,n.jsx)(k.A,{defaultMessage:"Connect",id:"+vVZ/G11Zg"})}):(0,n.jsxs)(n.Fragment,{children:[o&&o>0?(0,n.jsx)("span",{className:"text-sm text-accent-secondary-100",children:(0,n.jsx)(k.A,{defaultMessage:"{count} enabled",id:"yA/nbBqm+9",values:{count:o}})}):(0,n.jsx)("span",{className:"text-sm text-fg-400",children:(0,n.jsx)(k.A,{defaultMessage:"Disabled",id:"tthToSLF5Z"})}),(0,n.jsx)(v.J,{className:"w-4 h-4 text-fg-400"})]})})]})},R=e=>{let{isOpen:t,requestedServers:s,onClose:a,artifactContext:i}=e,r=(0,N.A)(),{servers:c}=(0,S.gt)(),{addError:u}=(0,o.Y)(),g=r.formatMessage({defaultMessage:"Failed to save tool configuration. Please try again.",id:"ZohwwHXd08"}),{data:v}=(0,C.rX)(),b=!(null==v?void 0:v.disabled_features.includes("mcp_artifacts")),[y,E]=(0,_.useState)(null),[I,R]=(0,_.useState)(""),[O,F]=(0,_.useState)({}),{data:D}=(0,M.m)({entityId:i.uuid,artifactEntityType:i.type}),{knownServers:P,unknownServers:B}=(0,_.useMemo)(()=>{if(!c)return{knownServers:void 0,unknownServers:[]};let e=[...s||[]],t=new Set((null==s?void 0:s.map(e=>e.url).filter(Boolean))||[]);(null==D?void 0:D.mcp_servers)&&D.mcp_servers.forEach(s=>{t.has(s.url)||e.push({name:s.name,url:s.url})});let a=[],n=[];return e.forEach(e=>{let t=c.find(t=>{let s="remote"===t.type,a=t.url===e.url;return s&&a});t?a.push(t):n.push(e)}),{knownServers:a,unknownServers:n}},[s,c,D]),G=(0,A.vP)("enabled_mcp_tools"),W=(0,_.useMemo)(()=>G||{},[G]),{mutateAsync:J}=(0,M.X)({entityId:i.uuid,artifactEntityType:i.type}),V=(0,_.useCallback)(e=>e.tools?I?e.tools.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())):e.tools:[],[I]);if((0,_.useEffect)(()=>{if((null==D?void 0:D.mcp_servers)&&(null==P?void 0:P.length)){let e={};D.mcp_servers.forEach(t=>{let s=P.find(e=>e.url===t.url);(null==s?void 0:s.tools)&&s.tools.forEach(s=>{let a=t.allowed_tools.includes(s.name);e[s.enabledKey]=a})}),F(e)}else Object.keys(W).length>0&&F(W)},[D,P,W]),!(null==P?void 0:P.length)&&!B.length)return a(),null;if(!(null==P?void 0:P.length))return(0,n.jsx)(U,{isOpen:t,onClose:a,variant:"empty",unknownServerCount:B.length});let H=P.filter(e=>e.isConnected||e.isAuthless||e.isLoading),q=async e=>{try{await K(e),a()}catch(e){u(g)}},K=async e=>{let t=P.map(t=>{let s=t.tools||[],a=[],n=[],i=t.isConnected||t.isAuthless;return e&&s.length>0&&i?s.forEach(e=>{!1!==O[e.enabledKey]?a.push(e.name):n.push(e.name)}):!e&&s.length>0&&s.forEach(e=>{n.push(e.name)}),{name:t.name||"",url:t.url||"",allowed_tools:a,disallowed_tools:n,pending_tool_section:!!e&&!i}}),s=B.map(e=>({name:e.name||"",url:e.url||"",allowed_tools:[],disallowed_tools:[],pending_tool_section:!1}));await J({mcp_servers:[...t,...s]})},Y=e=>!!e.tools&&0!==e.tools.length&&e.tools.filter(e=>!1!==O[e.enabledKey]).length>0;return y?(0,n.jsx)(p.aF,{title:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>E(null),className:"hover:bg-bg-200 rounded transition-colors",children:(0,n.jsx)(j.A,{className:"w-5 h-5"})}),(0,n.jsx)("span",{children:(0,n.jsx)(k.A,{defaultMessage:"Customize {serverName}",id:"xtLJnxdHqO",values:{serverName:y.name||y.url||""}})})]}),isOpen:t,onClose:a,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(m.YX,{id:"crystal_muffin_bicycle"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)(T,{className:"!gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2.5 px-1.5",children:[(0,n.jsx)(x.vj,{className:"w-4 h-4 text-text-500/50"}),(0,n.jsx)(d.ks,{placeholder:r.formatMessage({defaultMessage:"Search tools",id:"QVlai1/dYD"}),value:I,onChange:e=>R(e.target.value),className:"flex-1 !border-none !outline-none !p-0 !text-sm text-text-300 placeholder:text-text-500/70"})]}),y.tools&&y.tools.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(z.$,{item:{key:"select-all",type:"switch",label:Y(y)?r.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):r.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"}),icon:(0,n.jsx)(l.p,{letter:y.tools[0].name,size:16}),isChecked:Y(y),onClick:()=>{let e=!Y(y);if(y.tools){let t={...O};y.tools.forEach(s=>{t[s.enabledKey]=e}),F(t)}}}}),(0,n.jsx)("div",{className:"border-t border-border-300"})]}),V(y).map(e=>{let t=e.enabledKey,s=!1!==O[t];return(0,n.jsx)(z.$,{item:{key:t,type:"switch",label:e.name,icon:(0,n.jsx)(l.B,{letter:e.name,size:16}),isChecked:s,onClick:()=>{F(e=>({...e,[t]:!s}))}}},t)})]})})]})}):b?(0,n.jsxs)(p.aF,{title:r.formatMessage({defaultMessage:"Allow access to {count} connectors",id:"gqJuzJIhGT"},{count:P.length}),isOpen:t,onClose:a,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(m.YX,{id:"penguin_tomato_umbrella"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)(T,{children:[P.map(e=>(0,n.jsx)(L,{server:e,variant:H.includes(e)?"tools":"connect",onClick:()=>E(e),enabledToolsCount:(e=>e.tools&&0!==e.tools.length?e.tools.filter(e=>!1!==O[e.enabledKey]).length:null)(e)},e.uuid||e.url)),B.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),(0,n.jsx)("p",{className:"text-xs text-text-500",children:(0,n.jsx)(k.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:B.length,link:(0,n.jsx)(w(),{href:"/settings/connectors",className:"underline",children:(0,n.jsx)(k.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})]})]}),(0,n.jsx)(T,{className:"bg-bg-100",children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:(0,n.jsx)(k.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})})]})})]}),(0,n.jsxs)(p.vW,{children:[(0,n.jsx)(f.$,{variant:"secondary",onClick:()=>q(!1),children:(0,n.jsx)(k.A,{defaultMessage:"Disallow all tools",id:"Vm8mYnmEt3"})}),(0,n.jsx)(f.$,{onClick:()=>q(!0),variant:"primary",children:(0,n.jsx)(k.A,{defaultMessage:"Continue with enabled tools",id:"V6ki9Tnm7q"})})]})]}):(0,n.jsx)(U,{isOpen:t,onClose:a,variant:"disabled"})}},97527:(e,t,s)=>{s.d(t,{I:()=>n,q:()=>i});var a=s(7620);let n=(0,a.createContext)(null),i=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},97830:(e,t,s)=>{s.d(t,{c:()=>tp,d:()=>tg});var a=s(42977),n=s(54568),i=s(7620),l=s(50787),r=s(57322);r.A.blockRegex;let o=r.A.defaultRules,c=r.A.parserFor;r.A.defaultBlockParse;let d=r.A.outputFor,u=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(u);if(i.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){let t=e.props.children,s=u(t);if(s!==t)return i.cloneElement(e,void 0,s)}return e}if((e=>"object"==typeof e&&null!==e&&"$$typeof"in e&&"type"in e&&"props"in e)(e)){let{type:t,props:s,key:a}=e,n={};return s&&"object"==typeof s&&(Object.assign(n,s),"children"in s&&(n.children=u(s.children))),null!=a&&(n.key=a),i.createElement(t,n)}return e};var m=s(56340);let x={...{fence:{...o.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,n.jsx)(m.I.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...o.blockQuote,react:(e,t,s)=>(0,n.jsx)(m.I.blockQuote,{children:t(e.content,s)})},list:{...o.list,react:(e,t,s)=>{let a=e.ordered?m.I.ol:m.I.ul;return(0,n.jsx)(a,{children:e.items.map((e,a)=>(0,n.jsx)(m.I.li,{children:t(e,s)},a))},s.key)}},newline:o.newline,paragraph:{...o.paragraph,react:(e,t,s)=>(0,n.jsx)(m.I.p,{children:t(e.content,s)},s.key)},u:o.u,del:o.del,inlineCode:{...o.inlineCode,react:e=>{let t=e.content;if(t&&l.yT.test(t)){var s;if((null==(s=t.match(l.yT))?void 0:s[0])===t)return(0,n.jsxs)(m.I.code,{children:[(0,n.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,n.jsx)(l.qU,{color:t})}),t]})}return(0,n.jsx)(m.I.code,{children:t})}},text:{...o.text,react:e=>(0,l.fz)(e.content)}},url:o.url,link:{...o.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,n.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}},em:o.em,strong:o.strong},f=(0,i.memo)(e=>{let{text:t}=e,s=c(x)(t,{inline:!1});return((e,t,s)=>{let a=d(e,t,s),n=(e,t)=>u(a(e,t));return n.displayName="OutputFor_".concat(String(t)),n})(x,"react")(s)});f.displayName="AnthropicMarkDown";var h=s(7409),p=s(33200),g=s(90510),v=s(41417),j=s(27062),b=s(4705),y=s(82015),w=s(38583),_=s(46760),N=s(62971),k=s(70497);function M(){let e=(0,a._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return M=function(){return e},e}function C(){let e=(0,a._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return C=function(){return e},e}function S(){let e=(0,a._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return S=function(){return e},e}function A(){let e=(0,a._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return A=function(){return e},e}let z=g.J.div(M()),E=(0,g.J)(z)(C()),I=(0,g.J)(z)(S()),T=(0,g.J)(z)(A()),U=(0,i.memo)(function(e){let{message:t,messageWarningPropsFromParent:s,hasLink:a,hasCode:l,hasDriveDocWithImages:r,onRetry:o,onSendContinue:c,conversationSettings:d,isLastMessage:u}=e,m=(0,_.A)(),{value:x}=(0,p.N)(null!=d?d:{}),f=null==d?void 0:d.enabled_web_search,{value:h}=(0,j.fS)("claudeai_web_search"),g=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,n.jsx)("a",{...s,className:"underline"})}}),[]);if((null==s?void 0:s.style)==="prominent")return(0,n.jsxs)(I,{"data-testid":"message-warning",children:[(0,n.jsx)(b.N,{className:"shrink-0",size:16}),(0,n.jsx)(k.o,{components:g,children:s.contentMarkdown})]});let M="human"===t.sender;if(!M&&"error"===t.stop_reason&&o)return(0,n.jsxs)(T,{"data-testid":"message-warning",onClick:()=>o(t.parent_message_uuid),children:[(0,n.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,n.jsx)(b.N,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,n.jsx)(y.o,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,n.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,n.jsx)(N.A,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!M&&u&&"max_tokens"===t.stop_reason&&c)return(0,n.jsx)(E,{"data-testid":"message-warning",children:(0,n.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(w.R,{className:"shrink-0",size:16}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(N.A,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,n.jsx)("div",{className:"ml-6",children:(0,n.jsx)(v.$,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==c?void 0:c(),"aria-label":m.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,n.jsx)(N.A,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});let C=[];return(M?(a&&!f&&(h?C.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search to get up to date info from web links.",id:"fPI2JySdII"})):C.push(m.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"}))),r&&C.push(m.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(a&&!f&&(h?C.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search for up to date and accurate links.",id:"sN35Yf2Rzl"})):C.push(m.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"}))),l&&!x&&C.push(m.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),t.stop_reason,"conversation_length_limit"===t.stop_reason&&C.push(m.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),s&&C.push(s.contentMarkdown)),0===C.length)?null:(0,n.jsxs)(E,{"data-testid":"message-warning",children:[(0,n.jsx)(w.R,{className:"shrink-0",size:16}),(0,n.jsx)(k.o,{components:g,children:C.reverse().join(" ")})]})});var L=s(32987),R=s(1336);class O{isInsideStructure(){return this.inCodeBlock||this.inList||this.inTable||this.inBlockquote}processLine(e){let t=e.trim(),s=this.isInsideStructure();(t.startsWith("```")||t.startsWith("~~~"))&&(this.inCodeBlock?t.startsWith(this.codeBlockDelimiter)&&(this.inCodeBlock=!1,this.codeBlockDelimiter=""):(this.inCodeBlock=!0,this.codeBlockDelimiter=t.substring(0,3))),/^[-*+]|\d+\./.test(t)&&!this.inCodeBlock?this.inList=!0:this.inList&&""===t&&(this.inList=!1),t.includes("|")&&!this.inCodeBlock?this.inTable=!0:this.inTable&&""===t&&(this.inTable=!1);let a=t.startsWith(">");a&&!this.inCodeBlock?this.inBlockquote=!0:this.inBlockquote&&""===t&&!a&&(this.inBlockquote=!1);let n=this.lastLineWasEmpty;this.lastLineWasEmpty=""===t;let i=s&&!this.isInsideStructure();return{insideStructure:this.isInsideStructure(),structureJustClosed:i,previousLineWasEmpty:n}}reset(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}constructor(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}}let F=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],hasLinkRef:a,hasCodeRef:i,className:l,linkTarget:r="_blank",flagShowCodeHeader:o,unsafeAllowNavigationWithoutConfirmation:c,onOpenArtifact:d,isLastMessage:u,publishedArtifacts:m,messageUuid:x,onLinkClick:f}=e;return(0,n.jsx)(R.fP,{text:t,blockCitations:s,hasLinkRef:a,hasCodeRef:i,className:l,linkTarget:r,isStreaming:!1,flagShowCodeHeader:o,unsafeAllowNavigationWithoutConfirmation:c,onOpenArtifact:d,isLastMessage:u,publishedArtifacts:m,messageUuid:x,onLinkClick:f})},(e,t)=>e.text===t.text);F.displayName="MemoizedMarkdownChunk";let D=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],hasLinkRef:a,hasCodeRef:l,className:r,linkTarget:o="_blank",isStreaming:c=!1,flagShowCodeHeader:d,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:x,publishedArtifacts:f,messageUuid:h,onLinkClick:p}=e,{completedChunks:g,streamingChunk:v}=((e,t)=>{let[s,a]=(0,i.useState)([]),[n,l]=(0,i.useState)(""),r=(0,i.useRef)(new O);return(0,i.useEffect)(()=>{if(!e){a([]),l("");return}if(!t){a([e]),l(""),r.current.reset();return}let s=e.split("\n"),n=[],i=[],o=-1;r.current.reset();for(let e=0;e<s.length;e++){let t=s[e],{insideStructure:a,structureJustClosed:l,previousLineWasEmpty:c}=r.current.processLine(t);if(i.push(t),l||!a&&""===t.trim()&&i.length>1&&!c){for(;i.length>0&&""===i[i.length-1].trim();)i.pop();i.length>0&&(n.push(i.join("\n")),o=e,i=[])}}let c=s.slice(o+1).join("\n");a(n),l(c)},[e,t]),{completedChunks:s,streamingChunk:n}})(t,c);return(0,n.jsxs)("div",{className:(0,L.A)("grid-cols-1 grid gap-2.5 [&_>_*]:min-w-0",r),children:[g.map((e,t)=>(0,n.jsx)(F,{text:t>0?"\n\n"+e:e,blockCitations:s,hasLinkRef:a,hasCodeRef:l,className:"",linkTarget:o,flagShowCodeHeader:d,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:x,publishedArtifacts:f,messageUuid:h,onLinkClick:p},t)),v&&(0,n.jsx)(R.fP,{text:g.length>0?"\n\n"+v:v,blockCitations:s,hasLinkRef:a,hasCodeRef:l,className:"",linkTarget:o,isStreaming:!0,flagShowCodeHeader:d,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:x,publishedArtifacts:f,messageUuid:h,onLinkClick:p})]})});D.displayName="ProgressiveStandardMarkDown";var P=s(74610),B=s(1761),G=s(93877),W=s(9537),J=s(54890),V=s(92007),H=s(77101),q=s(12655),K=s(32132),Y=s(21036),$=s(37463),X=s(85717),Z=s(12072);function Q(e){let{Icon:t,children:s,tooltipContent:a,...i}=e;return(0,n.jsx)(Z.m,{side:"bottom",tooltipContent:a,disableHoverableContent:!0,children:(0,n.jsxs)(v.$,{...i,variant:"ghost",size:"icon_sm",className:"select-auto",children:[t,s]})})}var ee=s(85644),et=s(2341),es=s(28885),ea=s(9786),en=s(53248),ei=s(49645),el=s(75006),er=s(92075),eo=s(45078),ec=s(60098),ed=s(77186),eu=s(89697),em=s(77187),ex=s(56370),ef=s(18179),eh=s(37076),ep=s(96377),eg=s(92479),ev=s(22126);function ej(e){let{isOpen:t,onClose:s,conversationUUID:a,messageUUID:i,text:l}=e;return(0,n.jsx)(eh.aF,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,children:(0,n.jsx)(eb,{conversationUUID:a,messageUUID:i,text:l})})}function eb(e){let{conversationUUID:t,messageUUID:s,text:a}=e,{data:l,isPending:r,mutateAsync:o}=((e,t)=>{let{activeOrganization:s}=(0,B.YL)(),a=null==s?void 0:s.uuid;return(0,ed.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")})(t,s),{model:c}=(0,ec.o)(),d=(0,eo.vP)("paprika_mode"),u=(0,et.B)(),m=(0,ev.n)(u||{}),{codeStyle:x}=(0,eu.V)(),f=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let a=JSON.parse(s);e.logs.api_usage[t]=a}catch(e){}return e}(l),null,2):"",h=(0,em.Z3)(t);(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:c||h,tools:m(),personalized_styles:[],paprika_mode:d})})()},[o,c,m,d,h]);let{didCopy:p,copyToClipboard:g}=(0,ea.C)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eh.vW,{layout:"left",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("h2",{className:"font-ui tracking-tight text-accent-pro-000 text-xl font-medium",children:[(0,n.jsx)(N.A,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),"\xa0",(0,n.jsx)("span",{className:"ml-1 text-sm font-medium text-danger-000",children:(0,n.jsx)(N.A,{defaultMessage:"FOR INTERNAL USE ONLY",id:"ISVSjyq5f9"})})]})}),(0,n.jsxs)(v.$,{variant:"ghost",onClick:()=>{g(f)},disabled:r,children:[(0,n.jsx)(ea.u,{didCopy:p,className:"mr-2"}),(0,n.jsx)(N.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})]}),(0,n.jsx)(ey,{text:a})]}),r?(0,n.jsx)("div",{className:"my-2 flex h-full w-full items-center justify-center",children:(0,n.jsx)(ef.Loading,{})}):(0,n.jsx)(eg.A,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:x,children:f})]})}let ey=e=>{let{text:t}=e,{copyToClipboard:s}=(0,ea.C)(),a=(0,_.A)();return(0,n.jsx)(ex.ms,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,n.jsx)(v.$,{variant:"ghost",size:"icon","aria-label":a.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:(0,n.jsx)(ep.H,{size:20})}),children:(0,n.jsx)(ex.tJ,{className:"text-md",onSelect:()=>{s(t)},children:(0,n.jsx)("div",{className:"flex items-center justify-between gap-1",children:(0,n.jsx)("div",{className:"flex grow items-center",children:(0,n.jsx)(N.A,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})})})})})};var ew=s(18395);function e_(e){var t,s;let{conversationUuid:a,message:l}=e,[r,o]=(0,i.useState)(void 0),[c,d]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o("flag"):"upvote"!==r&&o("upvote"),d(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Q,{className:(0,L.A)((null==(t=l.chat_feedback)?void 0:t.type.includes("upvote"))&&"bg-bg-200 !text-accent-secondary-100"),Icon:(0,n.jsx)(es.tw,{size:16}),tooltipContent:(0,n.jsx)(N.A,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote")}),(0,n.jsx)(Q,{className:(0,L.A)((null==(s=l.chat_feedback)?void 0:s.type.includes("flag"))&&"bg-bg-200 !text-danger-100"),Icon:(0,n.jsx)(es.Su,{size:16}),tooltipContent:(0,n.jsx)(N.A,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag")}),(0,n.jsx)(ew.B,{conversationUuid:a,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:c,onClose:()=>d(!1)})]})}var eN=s(22529),ek=s(35368);function eM(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:a,parentMessageUUID:l,setPaprikaModeState:r}=e,[o,c]=(0,i.useState)(!1),d=(0,ek.Wi)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{a(e,t),r(t)},[a,r]);return(0,n.jsxs)(ex.ms,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:c,trigger:(0,n.jsx)(v.$,{variant:"ghost",size:"sm",className:"!font-base select-none !pl-2 !pr-1",append:(0,n.jsx)(es.bi,{className:"text-text-500"}),children:(0,n.jsx)(N.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}),children:[(0,n.jsx)(ex.tJ,{className:"text-sm",onClick:()=>a(l),children:(0,n.jsx)(N.A,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),d.map(e=>(0,n.jsx)(ex.tJ,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,n.jsx)(N.A,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,n.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,n.jsx)(eN.X5,{id:e.description_key}):e.description})]})},e.id))]})}var eC=s(65755);let eS={default:{allowed:"never"}},eA=el.z.record(el.z.object({allowed:el.z.enum(["never","first_turn","always"])}));function ez(e){var t,s,a,l,r,o,c,d;let{message:u,conversationUUID:m,isStreaming:x,isTemporary:f=!1,onRetry:h,isLastMessage:p,isLastHumanMessage:g=!1,isInteractive:b=!0,changeDisplayedConversationPath:y,editMessage:w,isFirstAssistantMessage:_,isResearchPending:k}=e,[M,C]=(0,i.useState)(!1),S=null!=(r=null==(t=(0,et.B)())?void 0:t.preview_feature_uses_artifacts)&&r,A="human"===u.sender,z="assistant"===u.sender,E=x&&p,{value:I}=(0,j.fS)("anthropic_internal_only_expose_chat_debug"),T=!x&&(null!=(o=u.nOptions)?o:0)>1&&y,U=!x&&!k&&w&&u.parent_message_uuid&&b,L=null==u||null==(s=u.content)?void 0:s.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),R=!x&&!k&&b&&!L,O=(0,en.C)(u),{didCopy:F,copyToClipboard:D}=(0,ea.C)(),P=async()=>{let e=(S?(0,J.it)(O):O).trim();try{let t=(0,eC.u)(e);await D({text:e,html:t})}catch(t){await D(e)}},B=(0,er.QY)(),{toggleConversationSetting:G}=(0,eo.rX)(),W=(0,eo.vP)("paprika_mode"),{model:V}=(0,ec.o)(),{allModelOptions:H}=(0,ee.A9)(),q=(0,j.iW)("claude_ai_paprika_retry",eS,eA),K=null!=(d=null!=(c=V&&(null==(a=q[V])?void 0:a.allowed))?c:null==(l=q.default)?void 0:l.allowed)?d:"never";if(A&&!U&&!T)return null;let Y=H.find(e=>e.model===V),$=null==Y?void 0:Y.paprika_modes,X=$&&$.length>0&&!W&&("always"===K||"first_turn"===K&&_);return(0,n.jsx)(eE,{isStreaming:E,isLastMessage:p||g,isInteractive:b,isAssistant:z,children:(0,n.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[z&&I&&(0,n.jsx)(Q,{Icon:(0,n.jsx)(es.IF,{}),tooltipContent:(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsx)(N.A,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),(0,n.jsx)("div",{className:"px-1 py-px -mr-0.5 text-xs bg-always-white/20 rounded",children:(0,n.jsx)(N.A,{defaultMessage:"Internal",id:"2KtWqT5Nl+"})})]}),onClick:()=>C(!0)}),z&&I&&(0,n.jsx)(ej,{isOpen:M,onClose:()=>C(!1),messageUUID:u.uuid,text:O,conversationUUID:m}),A&&U&&(0,n.jsx)(v.$,{variant:"ghost",size:"sm",className:"!font-base !px-2 !h-7 !min-w-0",onClick:()=>w(u,"test edit message"),children:(0,n.jsx)(N.A,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),z&&(0,n.jsx)(Q,{tooltipContent:(0,n.jsx)(N.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),onClick:P,"data-testid":"action-bar-copy",children:(0,n.jsx)("div",{children:(0,n.jsx)(ea.u,{didCopy:F})})}),z&&!E&&!k&&b&&"error"!==u.stop_reason&&B&&!f&&(0,n.jsx)(e_,{conversationUuid:m,message:u}),(0,n.jsxs)("div",{className:"flex items-center",children:[T&&(0,n.jsx)(eI,{message:u,changeDisplayedConversationPath:y}),z&&R&&(X?(0,n.jsx)(eM,{paprikaMode:W,supportedPaprikaModes:$,onRetry:h,parentMessageUUID:u.parent_message_uuid,setPaprikaModeState:e=>{G("paprika_mode",null!=e?e:null)}}):(0,n.jsx)(v.$,{variant:"ghost",size:"sm",className:"!font-base !px-2 !min-w-0",onClick:()=>h(u.parent_message_uuid),children:(0,n.jsx)(N.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})}let eE=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:a,isAssistant:i,children:l}=e;return(0,n.jsx)(ei.N,{children:!t&&(0,n.jsx)($.P.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,n.jsx)("div",{className:(0,L.A)("rounded-lg transition min-w-max pointer-events-auto",i?"translate-x-2":"translate-y-4 bg-bg-100/80 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})};function eI(e){var t;let{message:s,changeDisplayedConversationPath:a}=e,i=(null!=(t=s.selectedOption)?t:0)+1,l=i===s.nOptions;return(0,n.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,n.jsx)(v.$,{variant:"ghost",size:"icon_xs",disabled:1===i,onClick:()=>a(s,-1),children:(0,n.jsx)(es.ZK,{})}),(0,n.jsx)("span",{className:"self-center shrink-0 select-none font-small text-text-300",children:(0,n.jsx)(N.A,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:i,totalOptions:s.nOptions}})}),(0,n.jsx)(v.$,{variant:"ghost",size:"icon_xs",disabled:l,onClick:()=>a(s,1),children:(0,n.jsx)(es.K3,{})})]})}var eT=s(98518),eU=s(34059),eL=s(98614);let eR=()=>{let e=(0,eT.st)(),{initDriveAuth:t}=(0,X.cI)({});return(0,i.useEffect)(()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.displayed"})},[e]),(0,n.jsx)(eO,{title:(0,n.jsx)(N.A,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,n.jsx)(eL.g,{size:18}),cta:(0,n.jsxs)(v.$,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,n.jsx)(eU.ft,{size:16,className:"mr-1"}),(0,n.jsx)(N.A,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eO=e=>{let{title:t,icon:s,cta:a}=e;return(0,n.jsx)($.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,n.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,n.jsx)("div",{className:"px-2.5 py-2.5",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,n.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),a]})})})})},eF=e=>{let{previousMessage:t}=e,s=(0,X.LP)(),{isDriveAuthenticated:a}=(0,X.cI)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,j.fS)("pumpernickel_enabled"),o=(0,Y.useLayer)("trials_freemium").get("free_integrations",!1);return(r||o)&&s&&!a&&l?(0,n.jsx)(eR,{}):null},eD=e=>{let{title:t,text:s}=e,a=(0,_.A)();t=t||a.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,ea.C)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,eC.u)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,n.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-response-body",children:[(0,n.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,n.jsx)("span",{className:"flex-1",children:t}),(0,n.jsx)(v.$,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,n.jsx)(ea.u,{didCopy:i})})]}),(0,n.jsx)(k.o,{className:"px-4 pt-2 pb-4",children:s})]})};var eP=s(91965),eB=s(38715),eG=s(57067),eW=s(25243),eJ=s(60045);let eV=["year","month","day","hour","minute","second","millisecond"],eH=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=eJ.dw.fromDurationLike(t);return e.formatList(eV.filter(e=>0!==n["".concat(e,"s")]).map(t=>e.formatNumber(n["".concat(t,"s")],{...a,style:"unit",unit:t})),{...a,style:s})}((0,_.A)(),t,s)};var eq=s(68864),eK=s(27261),eY=s.n(eK),e$=s(33792),eX=s(94748),eZ=s(67532);function eQ(){let e=(0,a._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 mx-4 mb-4 font-small"]);return eQ=function(){return e},e}function e0(e,t){if(!e)return;let s=(t?eq.c9.fromISO(t):eq.c9.now()).diff(eq.c9.fromISO(e),["hours","minutes","seconds"]);return 0>s.toMillis()?eq.dw.fromMillis(0):s}let e1=g.J.div(eQ()),e2=()=>(0,n.jsxs)(e1,{"data-testid":"message-warning",children:[(0,n.jsx)(es.R2,{className:"shrink-0",size:16}),(0,n.jsx)(N.A,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,n.jsx)(eY(),{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),e3=e=>{let{text:t,cutOff:s}=e;return(0,n.jsxs)("div",{className:"text-text-300 text-sm font-normal gap-0.5 relative font-claude-response",children:[(0,n.jsx)(R.fP,{className:"p-3 pt-0 pr-8",text:t}),!0!==s?null:(0,n.jsx)(e2,{})]})},e5=e=>{let t,{index:s,text:a,cutOff:l=!1,startTimestamp:r,stopTimestamp:o,isStreaming:c,mostRecentSummary:d,onToggle:u,messageUuid:m,isFirstBlockOfMessage:x,isLastBlockOfMessage:f,renderMode:h=e$.l.Standard,isFirstItemInGroup:p,isLastItemInGroup:g}=e,v=(0,Y.useDynamicConfig)("claudeai_isp_thinking_ux"),j=v.get("enabled",!1),b=(0,_.A)(),y=b.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),w=b.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),N=b.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:k,setIsExpanded:M,snappyTransition:C}=(0,eZ.a)(!j&&c,String(s)),S=(0,eT.st)(),[A,z]=(0,i.useState)(()=>e0(r,o)),E=(0,i.useRef)(void 0),I=(0,i.useRef)(!1),[T,U]=(0,i.useState)(null),R=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eG.GN)(m)&&R.current.length>0&&(R.current.forEach(e=>{S.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:m,timestamp:e.timestamp})}),R.current=[])},[m,S]),(0,i.useEffect)(()=>{c&&(I.current=!0)},[c]);let O=c||I.current?v.get("fallback_summary_debounce_ms",2e3):0;(0,eW.W)(()=>{!c&&a.length>0&&U(e6(a,v))},[a,c],O),(0,i.useEffect)(()=>{let e=()=>{let e=e0(r,void 0);E.current=e,z(e)};if(c){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!E.current&&o&&z(e0(r,o))},[r,o,c]);let F=null==d?void 0:d.summary;if(j)if(c)t=null!=F?F:w;else{var D;t=null!=(D=null!=F?F:T)?D:w}else t=null!=F?F:c?y:N;return(0,n.jsx)(eX.sH,{isStreaming:c,isExpanded:k,setIsExpanded:()=>{let e=new Date().toISOString();(0,eG.GN)(m)?S.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!k,is_streaming:c,chat_message_uuid:m,timestamp:e}):R.current.push({isOpening:!k,wasStreamingWhenClicked:c,timestamp:e}),M(!k)},isFirstBlockOfMessage:x,isLastBlockOfMessage:f,text:k?N:c||E.current?(0,n.jsx)(ei.N,{mode:"wait",children:(0,n.jsx)($.P.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,n.jsx)("span",{className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:A&&A.as("seconds")>=10?(0,n.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,n.jsx)(es.Sw,{className:(0,L.A)("text-text-300 transition-all duration-300 ease-in-out opacity-50",c?"!opacity-0 scale-50":"scale-100 opacity-100"),size:12}),(0,n.jsx)("span",{className:"tabular-nums",children:(0,n.jsx)(eH,{value:A,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:h,isFirstItemInGroup:p,isLastItemInGroup:g,children:(0,n.jsx)(eX.NG,{isExpanded:k,snappyTransition:C,onTransitionEnd:u,isScrollable:!0,children:(0,n.jsx)(e3,{text:a,cutOff:l})})})},e6=(e,t)=>{let s=t.get("fallback_summary_min_len",50),a=t.get("fallback_summary_max_len",100),n=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|。)")),i=e.substring(0,a),l=n.exec(i);if(l)return l[0];for(let e=i.length-1;e>=s;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i};var e4=s(56326),e7=s(98252),e9=s(95675),e8=s(56273),te=s(11480),tt=s(99965),ts=s(92947),ta=s(28871),tn=s(50361),ti=s(85101);function tl(){let e=(0,a._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return tl=function(){return e},e}function tr(){let e=(0,a._)(["\n  group\n  relative\n  -tracking-[0.015em]\n"]);return tr=function(){return e},e}function to(){let e=(0,a._)(["\n  font-claude-response\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&>div>div>:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&>div>div>:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return to=function(){return e},e}let tc={initial:!1,animate:{y:0,opacity:1}},td={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},tu={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},tm={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},tx=[],tf=e=>{var t,s,a;let{conversationUuid:l,block:r,message:o,updatedMessage:c,index:d,shareType:u,isStreaming:m,isLastMessage:x,publishedArtifacts:f,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,renderMode:g,isFirstItemInGroup:v,isLastItemInGroup:j}=e,{renderToolUseCell:b}=(0,e4.Q)(),y=(0,q.Y)(r),w=r.name,_=r.id,N=r.context,k=null==(t=c.content)?void 0:t[d+1],M=(null==k?void 0:k.type)==="tool_result"?k:void 0,C=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{name:a,id:n,approval_options:l,approval_key:r,buffered_input:o}=t,c=null!=o?o:"{}",d=(0,ev.M)(),{track:u}=(0,eT.st)(),m=(0,tn.DD)(),x=(0,tt.p9)(),f=(0,ts.HJ)(),{mutate:h}=(0,tt.p4)(e),{getApprovalSetting:p}=(0,ts.BN)(),{toggleMcpToolAlwaysApproved:g}=(0,ts.es)(),{account:v}=(0,B.YL)(),j=(0,i.useMemo)(()=>{var e;return Object.entries(null!=(e=null==v?void 0:v.settings.enabled_mcp_tools)?e:{}).filter(e=>{let[t,s]=e;return!!s}).map(e=>{let[t]=e;return t})},[null==v?void 0:v.settings.enabled_mcp_tools]),b=(0,i.useRef)(!1),y=m(a),w=(null==y?void 0:y.tool)||null,_=(null==y?void 0:y.server)||null,N=x&&(null==_?void 0:_.type)==="remote",{approvalSetting:k,alwaysAllowEnabled:M}=p(null==w?void 0:w.serverName,w),C=l?l.includes("always"):M,S=f&&!!t.id,A=b.current||s,z=S&&!!w&&(x?!!l&&!!r:!("never"===k||j.includes(w.alwaysApprovedKey))),E=(0,i.useCallback)(t=>{if(S&&w&&!A){if("always"!==t||r||g(w.alwaysApprovedKey,!0),"deny"===t)if(N)h({tool_use_id:n,is_approved:!1,approval_key:r});else{var s;d(e,a,n,c,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),u({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(s=(0,ta.p)(c))?s:{}).length})}else N?h({tool_use_id:n,is_approved:!0,approval_key:r,approval_option:t}):d(e,a,n,c);b.current=!0}},[S,A,w,r,g,N,h,d,e,a,n,c,u]);return!S||z||A||N||!o||(d(e,a,n,c),b.current=!0),{approvalRequired:z,disabled:!o,approved:A,submitToolApproval:E,showAlwaysAllowed:C}}(l,r,!!M),S={integrationName:r.integration_name,integrationIcon:r.integration_icon_url,message:(null==M?void 0:M.message)||r.message,input:r.display_content,result:null==M?void 0:M.display_content},A=!!c.content&&c.content.length<=d+1&&m,z=((e,t,s)=>{var a,n,i,l;let r,o,c,d=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=(e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0})(s.partial_json)):r=null==(n=s.input)?void 0:n.id,u&&(o=null==e||null==(i=e.input)?void 0:i.id),!d||(null==t?void 0:t.partial_json)||(c=null==t||null==(l=t.input)?void 0:l.id);let m=r===o,x=r===c,f="individual_cell_create",h=null==(a=s.input)?void 0:a.command;if(h&&(f=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),!d&&!u)return f;if(d&&u)if(!m&&!x)return f;else if(m&&!x)return"multi_edit_last";else return"multi_edit_not_last";if(d&&!u)if(!x)return f;else return"multi_edit_not_last";if(!d&&u&&m)return"multi_edit_last";return f})(null==(s=c.content)?void 0:s[d-2],null==(a=c.content)?void 0:a[d+2],r);if(!b)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let E=b({toolUseId:_,input:y,isLastMessage:x,message:o,publishedArtifacts:f,isStreaming:A,toolName:w,toolResult:M,displayData:S,approvalData:C,artifactCellType:z,isFirstBlockOfMessage:h,isLastBlockOfMessage:p,shareType:u,context:N,renderMode:g,groupItemKey:String(d),isFirstItemInGroup:v,isLastItemInGroup:j});return(0,n.jsx)(i.Fragment,{children:E})},th=e=>{var t,s,a;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,textAreaRef:c,finishEdit:d,cancelEdit:u,author:m,loggedInAccount:x,message:f,selectAttachment:p,showSharedImageMissing:g=!1,showSharedFileMissing:j=!1}=e;(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),u()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===c.current){var t;null==(t=c.current)||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,u,c]);let b=null!=(a=f.files_v2)?a:f.files,y=g||j||f.attachments.length+b.length+((null==f||null==(t=f.sync_sources)?void 0:t.length)||0)>0;return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[y&&(0,n.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[b.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e},t)),f.attachments.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e,onClick:()=>null==p?void 0:p(e)},t)),null==f||null==(s=f.sync_sources)?void 0:s.map(e=>(0,n.jsx)(eB.V,{uuid:e.uuid,syncSource:e},e.uuid)),g&&(0,n.jsx)(h.sv,{}),j&&!g&&(0,n.jsx)(h.lD,{})]}),(0,n.jsx)(tv,{...l?tu:tc,className:"w-full",children:(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"flex shrink-0 items-center",children:(0,n.jsx)(G.e,{name:m||(null==x?void 0:x.full_name)||"",size:"sm"})}),(0,n.jsxs)("div",{className:"font-ui mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,n.jsx)(W.fs,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:c}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,n.jsx)(w.R,{"aria-hidden":"true",className:"shrink-0"}),(0,n.jsx)("div",{children:(0,n.jsx)(N.A,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.$,{onClick:u,variant:"secondary",children:(0,n.jsx)(N.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsx)(v.$,{type:"submit",disabled:0===r.length,children:(0,n.jsx)(N.A,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})},tp=(0,i.memo)(function(e){var t,s,a,l,r,o,c;let{lastHumanMessageRef:d,lastAssistantMessageRef:u,isLastMessage:m,isLastHumanMessage:x,selectAttachment:p,author:g,isInteractive:v=!0,onOpenArtifact:j,onOpenWiggleFile:b,onResize:y,editable:w,conversationSettings:_,publishedArtifacts:N=tx,messageWarningProps:k,showSharedImageMissing:M=!1,showSharedFileMissing:C=!1,isFirstAssistantMessage:S,shareType:A=null,isTemporary:z=!1,actionEmitter:E,onSendContinue:I,isResearchPending:T=!1,...O}=e,{previousMessage:F,message:W,isStreaming:q,conversationUUID:K}=O,[Z,Q]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(""),es=(0,i.useRef)(null),ea=(0,i.useRef)(1);(0,i.useEffect)(()=>{m||(ea.current+=1)});let en=null!=(c=W.files_v2)?c:W.files,ei=((e,t)=>{let s=(0,V.n)(),a=(0,i.useCallback)(e=>{if("text"!==e.type)return e;let a=e.text;return s&&e.citations&&e.citations.length>0&&(a=(0,P.k0)(e.citations,a)),a=t?(0,J.Tm)(a):(0,J.it)(a),{...e,text:a}},[t,s]);return(0,i.useMemo)(()=>{var t;let s=e.content,n=null==(t=e.content)?void 0:t[0];(null==n?void 0:n.type)==="text"&&""===n.text.trim()&&(s=null==s?void 0:s.slice(1));let i=(null==s?void 0:s.map(e=>a(e)))||[];return{...e,content:i}},[e,a])})(W,j),el="",er=null==(t=ei.content)?void 0:t.find(e=>"text"===e.type);er&&"text"in er&&(el=er.text);let eo=(0,i.useRef)(!1),ec=(0,i.useRef)(!1),{account:ed,activeOrganization:eu}=(0,B.YL)(),em=(0,i.useCallback)((e,t)=>{null==E||E.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[E]),ex=w?()=>{et(el),Q(!0)}:void 0,ef=(0,i.useCallback)(()=>{0!==ee.length&&E&&(E.emit("edit",{message:ei,text:ee}),Q(!1),et(""))},[ee,E,ei]),eh=(0,i.useCallback)(e=>null==j?void 0:j(e,ei.uuid),[j,ei.uuid]),{dispatchChatResource:ep}=(0,e8.i)(),{setIsDrawerExpanded:eg}=(0,e9.x)(),ev=(0,i.useMemo)(()=>(e,t)=>{t.startsWith("computer://")&&(null==eu?void 0:eu.uuid)&&(e.preventDefault(),(0,J.IO)(t)?(ep({type:"SELECT_FILE",path:t.replace("computer://",""),toolType:"create_file",messageId:ei.uuid}),eg(!0)):(0,e7.J)(A?{filepath:t,orgUuid:null==eu?void 0:eu.uuid,snapshotUuid:K,isShared:!0}:{filepath:t,orgUuid:null==eu?void 0:eu.uuid,conversationUuid:K,isShared:!1}))},[null==eu?void 0:eu.uuid,K,ep,eg,ei.uuid,A]),ej=(0,i.useMemo)(()=>e=>{(null==eu?void 0:eu.uuid)&&(0,e7.y)(A?{filepaths:e,orgUuid:null==eu?void 0:eu.uuid,snapshotUuid:K,isShared:!0}:{filepaths:e,orgUuid:null==eu?void 0:eu.uuid,conversationUuid:K,isShared:!1})},[null==eu?void 0:eu.uuid,K,A]),eb="human"===ei.sender,ey="assistant"===ei.sender,ew=null==(s=ei.content)?void 0:s.some(e=>"text"===e.type&&""!==e.text),e_=m&&q,eN=M||C||ei.attachments.length+en.length+((null==ei||null==(a=ei.sync_sources)?void 0:a.length)||0)>0,ek=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=W.sync_sources)?void 0:e.filter(e=>e.type===H.v8.GDRIVE).map(e=>e.config.uri))?t:[]},[W.sync_sources]),eM=(0,X.qL)(ek),eC=(0,i.useMemo)(()=>eM.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[eM]),eS="voice"===ei.input_mode||"speech_input"===ei.input_mode,eA=(0,Y.useDynamicConfig)("claudeai_isp_thinking_ux");if(Z)return(0,n.jsx)(th,{isStreaming:q,currentEdit:ee,setCurrentEdit:et,textAreaRef:es,finishEdit:ef,cancelEdit:()=>{Q(!1),et("")},author:g,loggedInAccount:ed,message:ei,selectAttachment:p,showSharedImageMissing:M,showSharedFileMissing:C});let eE=function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e$.l.Standard,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=s[t+1],c=(null==o?void 0:o.type)==="tool_result",d=0===t,u=!!s.length&&t===s.length-1-!!c;if("thinking"===e.type){var x;return(0,n.jsx)(e5,{index:t,text:e.thinking,cutOff:e.cut_off,startTimestamp:e.start_timestamp,stopTimestamp:e.stop_timestamp,isStreaming:e_&&!e.stop_timestamp,mostRecentSummary:null==(x=e.summaries)?void 0:x.at(-1),messageUuid:ei.uuid,onToggle:()=>{y&&y()},isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t)}if("tool_use"===e.type)return(0,n.jsx)(tf,{conversationUuid:K,block:e,message:W,updatedMessage:ei,index:t,shareType:A,isStreaming:q,isLastMessage:m,publishedArtifacts:N,isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t);if("text"===e.type){if(0===t&&""===e.text)return;return(0,n.jsxs)(i.Fragment,{children:[e_?(0,n.jsx)(D,{text:e.text,blockCitations:e.citations,hasLinkRef:eo,hasCodeRef:ec,isStreaming:q,onOpenArtifact:eh,isLastMessage:m,publishedArtifacts:void 0,onLinkClick:ev}):(0,n.jsx)(R.fP,{text:e.text,blockCitations:e.citations,hasLinkRef:eo,hasCodeRef:ec,isStreaming:q,onOpenArtifact:eh,isLastMessage:m,publishedArtifacts:N,onLinkClick:ev}),"public"!==A&&(0,n.jsx)(ty,{text:e.text,onOpen:e=>null==b?void 0:b(e),conversationUUID:K,onDownloadAll:e=>{null==ej||ej(e)},isShared:!!A})]},"".concat(t,"-").concat(e_?"streaming":"static"))}};return(0,n.jsxs)("div",{ref:x?d:m?u:null,"data-test-render-count":ea.current,children:[eb&&(0,n.jsxs)("div",{className:"mb-1 mt-1",children:[eN&&(0,n.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[en.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e},t)),ei.attachments.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e,onClick:()=>null==p?void 0:p(e)},t)),null==ei||null==(l=ei.sync_sources)?void 0:l.map(e=>(0,n.jsx)(eB.V,{uuid:e.uuid,syncSource:e},e.uuid)),M&&(0,n.jsx)(h.sv,{}),C&&!M&&(0,n.jsx)(h.lD,{})]}),(0,n.jsxs)(tv,{className:ew?"pr-6":"pr-[2.5px]",...q?tu:tc,children:[(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"shrink-0",children:A?(0,n.jsx)(G.e,{name:g||null,size:"sm"}):(0,n.jsx)(eP.J,{size:"sm"})}),(0,n.jsx)("div",{"data-testid":"user-message",className:(0,L.A)("font-ui grid grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6 tracking-tight",{italic:eS}),children:null==(r=ei.content)?void 0:r.map((e,t)=>"text"!==e.type?null:(0,n.jsx)(f,{text:e.text},t))})]}),(0,n.jsx)(U,{message:W,isLastMessage:m,hasLink:eo.current,hasDriveDocWithImages:eC,conversationSettings:_,messageWarningPropsFromParent:k}),(0,n.jsx)(ez,{isLastMessage:m,isInteractive:v,editMessage:ex,onRetry:em,isResearchPending:T,isTemporary:z,...O})]})]}),ey&&(0,n.jsx)(n.Fragment,{children:ei.content&&ei.content[0]&&(0,n.jsx)($.P.div,{style:{height:"auto"},...q?tm:tc,children:(0,n.jsxs)(tj,{"data-is-streaming":e_,...q?td:tc,className:m?"pb-3":"pb-8",children:[(0,n.jsx)(tb,{children:(()=>{let e=ei.content,t=[],s=Array(e.length).fill(!1);for(let a=0;a<e.length;a++){let i,l=e[a],r=[],o=!1;if(eA.get("timeline_enabled",!1)&&(0,te.Ih)(l,eA)){if(r.push([l,a,(0,te.h4)(l)]),s[a])continue;for(let t=a+1;t<e.length;t++){let s=e[t];if(!(0,te.Ih)(s,eA))break;r.push([s,t,(0,te.h4)(s)]),t===e.length-1&&(o=!0)}}if(eA.get("timeline_artifacts_enabled",!1)){let e=r.findLastIndex(e=>{let[t]=e;return"tool_use"===t.type&&"artifacts"===t.name});if(e>=0){r=r.slice(0,e);for(let e=0;e<r.length;e++){let t=r[e],s=t[0];"tool_use"===s.type&&"artifacts"===s.name&&(t[2]=!1)}}}let c=0;for(let[,,e]of r)e&&c++;c>1?(r.forEach(e=>{let[,t]=e;s[t]=!0}),i=(0,n.jsx)(te.DT,{isFirstBlockOfMessage:0===a,isLastBlockOfMessage:o,isStreaming:q,children:r.map((t,s)=>{let[a,n,i]=t;if(i)return eE(a,n,e,e$.l.TimelineGroup,0===s,s===r.length-1)})},"group-".concat(a))):i=eE(l,a,e),t.push(i)}return t})()}),null==(o=ei.content)?void 0:o.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,n.jsx)(eD,{text:e.text,title:e.title},t)}),!q&&m&&(0,n.jsx)(eF,{previousMessage:F}),(0,n.jsx)(ez,{isLastMessage:m,isInteractive:v,isFirstAssistantMessage:S,onRetry:em,isResearchPending:T,isTemporary:z,...O}),(0,n.jsx)(U,{message:W,isLastMessage:m,messageWarningPropsFromParent:k,conversationSettings:_,hasLink:eo.current,hasCode:ec.current,onRetry:em,onSendContinue:I})]})})})]})}),tg=()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,n.jsx)(tv,{children:(0,n.jsx)("div",{className:(0,L.A)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})}),tv=(0,g.J)($.P.div)(tl()),tj=(0,g.J)($.P.div)(tr()),tb=g.J.div(to());function ty(e){let{text:t,conversationUUID:s,onOpen:a,onDownloadAll:l,isShared:r}=e,o=(0,i.useMemo)(()=>(e=>{let t,s=[],a=/\[[^\]]*\]\((computer:\/\/\/[^)]+)\)/g;for(;null!==(t=a.exec(e));)s.push(t[1]);let n=RegExp("(?<!\\]\\()computer:\\/\\/\\/[^\\s)\\].,;!?]+(?![^[]*\\])","g");return s.push(...e.match(n)||[]),[...new Set(s.map(e=>e.replace(/[.,;!?)]+$/,"")))]})(t),[t]);return(0,n.jsxs)("div",{className:"flex flex-col gap-2 py-2",children:[o.map(e=>{let t=e.split("/").pop()||e;return(0,n.jsx)(ti._,{conversationUUID:s,file:{name:t,path:e},onOpen:()=>{a(e)},isShared:r},e)}),o.length>1&&(0,n.jsx)("div",{children:(0,n.jsx)(v.$,{variant:"outline",prepend:(0,n.jsx)(K.e,{size:"1.1rem"}),onClick:()=>{l(o)},children:"Download all"})})]})}},98252:(e,t,s)=>{function a(e){let{filepath:t,orgUuid:s}=e,a=t.replace("computer://",""),n=document.createElement("form");n.method="GET",n.action=e.isShared?"/api/organizations/".concat(s,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-file"):"/api/organizations/".concat(s,"/conversations/").concat(e.conversationUuid,"/wiggle/download-file"),n.style.display="none";let i=document.createElement("input");i.type="hidden",i.name="path",i.value=a,n.appendChild(i),document.body.appendChild(n),n.submit(),document.body.removeChild(n)}function n(e){let{filepaths:t,orgUuid:s}=e,a=t.map(e=>e.replace("computer://","")).filter(t=>!e.isShared||t.startsWith("/mnt/user-data/")),n=document.createElement("form");n.method="GET",n.action=e.isShared?"/api/organizations/".concat(s,"/snapshots/").concat(e.snapshotUuid,"/wiggle/download-files"):"/api/organizations/".concat(s,"/conversations/").concat(e.conversationUuid,"/wiggle/download-files"),n.style.display="none",a.forEach(e=>{let t=document.createElement("input");t.type="hidden",t.name="paths",t.value=e,n.appendChild(t)}),document.body.appendChild(n),n.submit(),document.body.removeChild(n)}s.d(t,{J:()=>a,y:()=>n})}}]);