try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e1282ec3-09f2-4b5e-9f44-ca67f698caf3",e._sentryDebugIdIdentifier="sentry-dbid-e1282ec3-09f2-4b5e-9f44-ca67f698caf3")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{2451:(e,t,s)=>{"use strict";s.d(t,{ChatClientPage:()=>P});var a=s(54568),n=s(7726),l=s(91961),i=s(95675),r=s(56273),o=s(1761),d=s(53248);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let s=Math.ceil(t/2);return"".concat(e.substring(0,s),"\n\n  [...]\n\n  ").concat(e.substring(e.length-s))}var c=s(7620),m=s(46760),f=s(77187),v=s(19303),p=s(2341),_=s(62942),g=s(83092),y=s(58977),h=s(22126),x=s(98518),j=s(99965),w=s(92947),k=s(50361),b=s(28871),S=s(8027),C=s(11515),A=s(41417),N=s(37076),I=s(98411),E=s(62971),M=s(94748),D=s(13625),z=s(67532);function O(e){let{isModalOpen:t,currentTool:s,currentToolInput:n,currentServer:l,handleDeny:i,handleAllow:r,handleAlwaysAllow:o}=e,{isExpanded:d,setIsExpanded:u,snappyTransition:c}=(0,z.a)(!1);if(s)return(0,a.jsxs)(N.aF,{isOpen:t,onClose:()=>i(),autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,modalSize:"lg",title:(0,a.jsx)(E.A,{defaultMessage:"Claude would like to use this tool",id:"PwE/s/W1AC"}),children:[(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsx)(M.sH,{isStreaming:!1,isExpanded:d,setIsExpanded:u,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,a.jsx)(I.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)(C.d,{url:null==l?void 0:l.url,fallbackSvg:(0,a.jsx)(S.B,{letter:s.serverName,size:40}),size:40}),(0,a.jsxs)("div",{className:"flex flex-col py-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-400 font-mono",children:s.name}),(0,a.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:s.serverName})]})]})}),className:"!h-auto",children:(0,a.jsx)(M.NG,{isExpanded:d,snappyTransition:c,isScrollable:!0,children:(0,a.jsx)(D.L,{input:n?JSON.parse(n):""})})}),(0,a.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,a.jsx)("p",{className:"font-medium",children:(0,a.jsx)(E.A,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,a.jsx)("p",{children:(0,a.jsx)(E.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,a.jsx)(N.vW,{className:"flex justify-between",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[o&&(0,a.jsx)(A.$,{onClick:o,children:(0,a.jsx)(E.A,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,a.jsx)(A.$,{onClick:r,autoFocus:!0,children:(0,a.jsx)(E.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,a.jsx)(A.$,{onClick:i,variant:"outline",children:(0,a.jsx)(E.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function T(e){var t,s;let{conversation:l,conversationUUID:i,chatInputDefaultMessage:r}=e,{currentPath:S,data:C,isLoading:A,isPlaceholderData:N}=(0,n.Bq)(i,{suppressError:!0}),I=null==C?void 0:C.project_uuid,{changeDisplayedConversationPath:E}=(0,v.G)(),{onInvokeTool:M,isModalOpen:D,currentTool:z,currentToolInput:T,currentServer:F,handleAllow:P,handleDeny:R,handleAlwaysAllow:U}=function(e){let{conversationUUID:t}=e,s=(0,h.M)(),{track:a}=(0,x.st)(),[n,l]=(0,c.useState)(!1),[i,r]=(0,c.useState)(null),[o,d]=(0,c.useState)(void 0),[u,m]=(0,c.useState)(null),[f,v]=(0,c.useState)(null),[p,_]=(0,c.useState)(void 0),[g,y]=(0,c.useState)(void 0),S=(0,j.p9)(),C=(0,w.HJ)(),A=(0,w.Ib)(),{toggleMcpToolAlwaysApproved:N}=(0,w.es)(),{getApprovalSetting:I}=(0,w.BN)(),{alwaysAllowEnabled:E}=I(null==i?void 0:i.serverName,i),{mutate:M}=(0,j.p4)(t),D=(0,c.useRef)(A);(0,c.useEffect)(()=>{D.current=A},[A]);let z=(0,k.DD)(),O=(0,c.useCallback)(async(e,t,a,n,i,o,u)=>{let c=z(t),f=null==c?void 0:c.tool,p=null==c?void 0:c.server;if(!f)return s(e,t,a,n,i);if(C)return;if(S&&(null==p?void 0:p.type)==="remote")return o?new Promise(e=>{d(p),r(f),m(a),v(n),_(o),y(u),l(!0),e()}):void 0;let{approvalSetting:g}=I(f.serverName,f);return"never"===g||D.current.includes(f.alwaysApprovedKey)?s(e,t,a,n,i):new Promise(e=>{d(p),r(f),m(a),v(n),l(!0),e()})},[s,I,S,C,z]),T=(0,c.useCallback)(()=>{l(!1),i&&null!==u&&null!==f&&(p&&g?M({tool_use_id:u,is_approved:!0}):s(t,"".concat(i.serverName,":").concat(i.name),u,f))},[t,i,u,f,s,p,g,M]),F=(0,c.useCallback)(()=>{if(l(!1),i&&null!==u&&null!==f)if(p&&g)M({tool_use_id:u,is_approved:!1});else{var e;s(t,"".concat(i.serverName,":").concat(i.name),u,f,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),a({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(e=(0,b.p)(f))?e:{}).length})}},[t,i,u,f,s,a,p,g,M]),P=(0,c.useCallback)(()=>{(p?p.includes("always"):E)&&(i&&!g&&N(i.alwaysApprovedKey,!0),l(!1),i&&null!==u&&null!==f&&(p&&g&&M({tool_use_id:u,is_approved:!0,approval_key:g,approval_option:"always"}),s(t,"".concat(i.serverName,":").concat(i.name),u,f)))},[t,i,u,f,s,N,E,p,g,M]);return{onInvokeTool:O,isModalOpen:n,currentTool:i,currentServer:o,currentToolInput:f,handleAllow:T,handleDeny:F,handleAlwaysAllow:E?P:void 0}}({conversationUUID:i}),B=(0,f.Z3)(i),q=(0,h.n)(null==C?void 0:C.settings,null==l?void 0:l.project_uuid),{markFirstTokenReceived:K}=(0,g.B)(),L=(0,c.useCallback)(()=>{K({model:B})},[K,B]),[Y,Q]=(0,c.useState)(),V=(0,c.useCallback)(e=>{Q(e)},[Q]),W=(0,f.Gw)(i,I,M,q,L),X=(0,f.SL)(i,I,M,q,Y,L),{mutate:G}=(0,n.lj)(i),H=W.isStreaming||X.isStreaming,Z=W.runStream;!function(e,t){let[s,a]=(0,c.useState)(!1),{activeOrganization:l}=(0,o.YL)(),i=(0,m.A)(),r=e?e.uuid:"",{mutate:f}=(0,n.HI)(r),{mutate:v,error:p}=(0,n.OZ)(r),_=(0,c.useRef)(!1);(0,c.useEffect)(()=>{var t;if(!p||(null==e?void 0:e.name))return;let s=(null==e||null==(t=e.chat_messages)?void 0:t[0])?(0,d.C)(e.chat_messages[0]):"";if(s){if(_.current)return;let e=s.slice(0,30),t=s.length>30?"...":"";_.current=!0,f({name:"".concat(e).concat(t)})}},[p,e,f]),(0,c.useEffect)(()=>{if(t||s||(null==e?void 0:e.name))return;let n=null==e?void 0:e.chat_messages;if(!n||n.length<2||0===(0,d.C)(n[1]).length)return;let i=["Message 1:",u((0,d.C)(n[0])),"Message 2:",u((0,d.C)(n[1]))].join("\n\n");l&&(a(!0),v({message_content:i,recent_titles:[]}))},[t,s,e,l,v,i])}(C,H);let $=(0,c.useCallback)(async(e,t)=>{var s,a;await Z({prompt:t,attachments:e.attachments,files:null!=(a=e.files_v2)?a:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:Y,compass_mode:null==(s=e.metadata)?void 0:s.compass_mode})},[Z,Y]),J=(0,c.useCallback)((e,t)=>{E(i,e,t,e=>G({current_leaf_message_uuid:e}))},[E,i,G]);return C||A||N||(0,_.notFound)(),(0,a.jsxs)(p.N,{settings:(null==C?void 0:C.settings)||{},children:[(0,a.jsx)(y.v,{isStreaming:H,isTemporary:!!(null==l?void 0:l.is_temporary),chatInputDefaultMessage:r,conversationTitle:l?"".concat(l.name," - Claude"):"Claude",conversationUUID:i,isLoading:A,messages:S,name:null!=(s=null!=(t=null==C?void 0:C.name)?t:null==l?void 0:l.name)?s:"Untitled Chat",onSend:W.runStream,onRetry:X.runStream,projectUuid:I,changeDisplayedConversationPath:J,editMessage:$,setPersonalizedStyleCallback:V,onToolAllow:P}),(0,a.jsx)(O,{isModalOpen:D,currentTool:z,currentToolInput:T,currentServer:F,handleDeny:R,handleAllow:P,handleAlwaysAllow:U})]})}var F=s(55947);function P(e){var t;let{uuid:s,q:o}=e,{data:d}=(0,n.Bq)(s);return(0,l.K7)(null!=(t=null==d?void 0:d.name)?t:""),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.u,{conversationUUID:s,children:(0,a.jsx)(i._,{conversationUUID:s,children:(0,a.jsx)(T,{conversation:d,conversationUUID:s,chatInputDefaultMessage:o})})}),(0,a.jsx)(F.T,{})]})}},28137:(e,t,s)=>{"use strict";s.d(t,{F:()=>d});var a=s(98518),n=s(1761),l=s(27062),i=s(7620),r=s(34116);let o="payment-verification-reminder-dismissed";function d(){let{activeOrganization:e}=(0,n.YL)(),t=(0,a.st)(),[s,d]=(0,i.useState)(!1),{value:u}=(0,l.fS)("show_3ds_modal"),{data:c}=(0,r.PI)(u);return(0,i.useEffect)(()=>{var s;let a=localStorage.getItem(o);if(a){let e=new Date(a).getTime();if(new Date().getTime()-e<864e5)return void d(!1)}let n=u&&null!=(s=null==c?void 0:c.requires_3ds_verification)&&s;d(n),n&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[u,c,t,e]),{shouldShowModal:s,dismissReminder:(0,i.useCallback)(()=>{let s=new Date().toISOString();localStorage.setItem(o,s),d(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:s})},[t,e])}}},55947:(e,t,s)=>{"use strict";s.d(t,{T:()=>p});var a=s(54568),n=s(98518),l=s(1761),i=s(51121),r=s(78730),o=s(86030),d=s(37076),u=s(87606),c=s(7620),m=s(62971),f=s(34116),v=s(28137);function p(){let[e,t]=(0,c.useState)(!1),s=(0,n.st)(),{activeOrganization:p}=(0,l.YL)(),{addError:_,addSuccess:g}=(0,i.Y)(),y=(0,r.ib)(),h=(0,u.useQueryClient)(),{shouldShowModal:x,dismissReminder:j}=(0,v.F)(),w=(0,f.Si)({onSuccess:async e=>{try{var n,l;let t=await y;if(!t)throw Error("Stripe failed to initialize");let i=await t.retrieveSetupIntent(e.clientSecret);if(i.error)throw Error(i.error.message);if((null==(n=i.setupIntent)?void 0:n.status)==="requires_action"){let s=await t.handleNextAction({clientSecret:e.clientSecret});if(s.error)throw Error(s.error.message)}else(null==(l=i.setupIntent)?void 0:l.status)==="succeeded"&&s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success_frictionless"});await h.invalidateQueries({queryKey:["check-3ds-required",null==p?void 0:p.uuid]}),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success"}),g((0,a.jsx)(m.A,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success"})}catch(e){_(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"})),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),_((0,a.jsx)(m.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"})),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),k=()=>{j()};return x?(0,a.jsx)(d.aF,{isOpen:x,onClose:k,modalSize:"md",hasCloseButton:!0,title:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(o.E,{color:"secondary",size:"lg",children:(0,a.jsx)(m.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,a.jsx)(m.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,a.jsx)("p",{className:"text-text-200 mb-6",children:(0,a.jsx)(m.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,a.jsx)(d.yl,{onClick:()=>{t(!0),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_start"});let e=window.location.href;w.mutate({return_url:e})},loading:e,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,a.jsx)(d.yl,{variant:"secondary",onClick:k,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},68708:(e,t,s)=>{Promise.resolve().then(s.bind(s,2451))}},e=>{e.O(0,[1658,3473,7598,2971,7261,2846,5006,1036,1575,9474,125,7773,4974,7463,8571,1404,1841,6631,2814,3103,3970,8864,5355,7519,3529,497,887,5326,5027,4478,413,8290,628,45,8897,3904,1570,3787,7856,979,7287,1761,8518,8885,9639,4690,4116,7187,1178,98,28,2947,1336,6298,8211,6147,953,197,7143,3592,4384,1128,7561,7226,8458,7354,8977,5313,587,4490,7358],()=>e(e.s=68708)),_N_E=e.O()}]);