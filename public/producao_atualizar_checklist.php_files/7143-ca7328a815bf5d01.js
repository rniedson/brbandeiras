try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a8b0eb86-70d6-4d39-b291-f5f4ae481eab",e._sentryDebugIdIdentifier="sentry-dbid-a8b0eb86-70d6-4d39-b291-f5f4ae481eab")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7143],{9234:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(54568),o=n(7620);let r=(0,o.forwardRef)((e,t)=>{let{className:n,children:r,disabled:s,noDefaultScroll:l}=e,i=(0,o.useRef)(0),c=(0,o.useRef)(!0),d=(0,o.useRef)(null),u=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(d.current&&c.current&&!(d.current.scrollHeight-d.current.clientHeight<d.current.scrollTop)&&d.current&&"function"==typeof d.current.scrollTo){var t,n,a;null==(a=d.current)||a.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)-(null==(n=d.current)?void 0:n.clientHeight)+5,behavior:e})}},[]),p=(0,o.useCallback)(e=>{if(d.current&&d.current&&"function"==typeof d.current.scrollTo){var t,n,a;d.current.style.overflow="hidden",null==(a=d.current)||a.scrollTo({top:(null==(t=d.current)?void 0:t.scrollHeight)*e-(null==(n=d.current)?void 0:n.clientHeight)/2,behavior:"auto"})}},[]),h=(0,o.useCallback)(()=>{d.current&&(d.current.style.overflow="")},[]);return(0,o.useImperativeHandle)(t,()=>({reset(){i.current=0,c.current=!0,l||u()},scrollToBottomIfPinned:u,scrollToPercentage:p,enableScrolling:h}),[u,p,h,l]),(0,o.useLayoutEffect)(()=>{s||!r||l||u()},[r,s,u,l]),(0,a.jsx)("div",{className:n,onScroll:e=>{if(s)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(d.current,t),a=t>i.current;n&&a?c.current=!0:n||a||(c.current=!1),i.current=t},ref:d,children:r})});r.displayName="AutoScroll"},19544:(e,t,n)=>{n.d(t,{A:()=>w});var a=n(54568),o=n(41417),r=n(37076),s=n(46760),l=n(62971);let i=e=>{let{isOpen:t=!1,filename:n,onClose:i,onConfirm:c}=e,d=(0,s.A)();return(0,a.jsxs)(r.aF,{title:d.formatMessage({defaultMessage:"Download file",id:"k9qHCCLPA5"}),isOpen:t,onClose:i,children:[(0,a.jsxs)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:[(0,a.jsx)(l.A,{defaultMessage:"Artifacts are created by other users and aren’t verified by Anthropic. Only download files you trust.",id:"MDebIUeu03"}),(0,a.jsx)("pre",{className:"font-mono text-wrap text-sm p-2 my-2 rounded border border-border-400 bg-bg-000",children:n})]}),(0,a.jsxs)(r.vW,{children:[(0,a.jsx)(o.$,{variant:"secondary",onClick:i,children:(0,a.jsx)(l.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(o.$,{onClick:c,children:(0,a.jsx)(l.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})]})]})};var c=n(94649),d=n(10158),u=n(1761),p=n(27062),h=n(44180),m=n(32987),g=n(49645),f=n(37463),y=n(7620),b=n(21155),x=n(20810),v=n(44124),C=n(53120);let w=(0,y.forwardRef)((e,t)=>{let{content:n,className:r,type:w,onSandboxConfirmation:S,onDOMContentLoaded:z,capabilities:R,onReportError:q,onSetContent:M,onRefresh:j,externalLinkBehavior:E,onOpenExternalLinkRequest:k,onTrackInteraction:P,showLoginModal:O,lazy:A=!0,zoom:T=1,artifactContext:F,ArtifactMcpModal:N,isChatStreaming:L}=e,I=(0,s.A)(),{userContentRendererUrl:D}=(0,d._r)(),{value:_}=(0,p.fS)("claude_create_marble"),[U,H]=(0,y.useState)(!1),G=(0,y.useRef)(null),Z="".concat(D).concat((null==F?void 0:F.uuid)&&"published_artifact"===F.type?"/artifact/"+F.uuid:"").concat(q?"?errorReportingMode=parent":"");(0,y.useEffect)(()=>{let e=G.current;e&&navigator.userAgent.toLowerCase().includes("firefox")&&(e.setAttribute("data-no-service-worker","true"),setTimeout(()=>{e.sandbox&&e.src&&(e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("referrerpolicy","no-referrer"))},0))},[]);let[B,K]=(0,y.useState)(null),[W,J]=(0,y.useState)(null),[V,$]=(0,y.useState)(null),[X,Q]=(0,y.useState)([]),{activeOrganization:Y}=(0,u.YL)(),{value:ee}=(0,p.fS)("apps_use_turmeric"),{value:et}=(0,p.fS)("artifact_tailwind_styles"),[en,ea]=(0,y.useState)(0),{sendRequest:eo,updatePermission:er}=function(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:a=null,initialPermissions:o,onPermissionRequested:r,onCapabilityAction:s}=e,[l,i]=(0,y.useState)(null),c=(0,y.useRef)(o),[d,u]=(0,y.useState)(0);(0,y.useEffect)(()=>{if(!t.current&&d<20){let e=setTimeout(()=>{u(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void console.warn("Max retries reached while waiting for iframe");let e=new C.x({iframe:t.current,allowedOrigin:n,onRateLimited:a,onPermissionRequested:async e=>{if(b.tH.includes(e)||"accepted"===c.current[e])return"accepted";let t=await r(e);return c.current={...c.current,[e]:t},t},onCapabilityAction:s});return i(e),()=>{e.cleanup()}},[t,n,c,a,r,s,d]);let p=(0,y.useCallback)(async(e,t)=>{if(l)return l.sendRequest(e,t);throw Error("Communicator not initialized")},[l]),h=(0,y.useCallback)(()=>{null==l||l.restartListening()},[l]),m=(0,y.useCallback)((e,t)=>{c.current={...c.current,[e]:t}},[]);return{sendRequest:null===l?void 0:p,restartListening:h,permissions:c.current,updatePermission:m}}({iframeRef:G,allowedOrigin:D,onCapabilityAction:(0,y.useCallback)(async(e,t)=>{if(e.method===b.uZ.ReadyForContent)return H(!0),null==S||S(),Promise.resolve();if(e.method===b.uZ.GetFile)return R&&R.getFile?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await R.getFile(e.payload.key)}:Promise.reject();if(e.method===b.uZ.SendConversationMessage)return R&&R.sendMessage?(await R.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===b.uZ.ClaudeCompletion)return R&&R.claudeComplete?(ea(e=>e+1),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await R.claudeComplete(e.payload.prompt)}):Promise.reject();if(e.method===b.uZ.BroadcastContentSize);else if(e.method===b.uZ.DOMContentLoaded)return null==z||z(),Promise.resolve();else if(e.method===b.uZ.OpenExternal){if("ask"===E)return K(e.payload.href),Promise.resolve();if("bubble"===E&&k)return k({href:e.payload.href}),Promise.resolve()}else if(e.method===b.uZ.DownloadFile)return J(e.payload),Promise.resolve();else if(e.method===b.uZ.ReportError)return null==q||q(e.payload.error),Promise.resolve();else if(e.method===b.uZ.TrackInteraction)return null==P||P(e.payload),Promise.resolve();else if(e.method===b.uZ.ProxyFetch)return(null==Y?void 0:Y.uuid)?!L&&(null==F?void 0:F.uuid)?(0,x._)(e.payload,t,null==Y?void 0:Y.uuid,F,_,$):new Promise((n,a)=>{let o={data:e.payload,sendRequest:t,resolve:n,reject:a,artifactUuid:null==F?void 0:F.uuid};Q(e=>{var t;return(null==F?void 0:F.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[o]:[...e,o]})}):(null==O||O(),Promise.reject());return Promise.reject()},[S,z,R,H,q,ea,E,k,P,O,null==Y?void 0:Y.uuid,F,_,L]),onPermissionRequested:(0,y.useCallback)(async e=>e===b.uZ.ClaudeCompletion&&en>=100?"denied":Promise.resolve("accepted"),[en]),initialPermissions:{}});(0,y.useEffect)(()=>{en>=100&&(er(b.uZ.ClaudeCompletion,"denied"),(0,h.wd)("Claude completion request limit hit."))},[en,er]),(0,y.useEffect)(()=>{(async()=>{!L&&X.length>0&&(null==Y?void 0:Y.uuid)&&(null==F?void 0:F.uuid)&&(await Promise.all(X.map(async e=>{let{data:t,sendRequest:n,resolve:a,reject:o}=e;try{let e=await (0,x._)(t,n,Y.uuid,F,_,$);a(e)}catch(e){o(e)}})),Q([]))})()},[L,X,null==Y?void 0:Y.uuid,F,_]);let es=(0,y.useCallback)(()=>{(0,h.wd)("Claude completion modal confirmed"),ea(0),er(b.uZ.ClaudeCompletion,"accepted")},[er]),el=(0,y.useCallback)(async()=>{let e=await (null==eo?void 0:eo(b.uZ.GetScreenshot,v.qs));if(null==e?void 0:e.screenshot){if(e.screenshot.length>0xa00000)throw Error(I.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(I.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[I,eo]),ei=(0,y.useCallback)(async()=>{let e=await (null==eo?void 0:eo(b.uZ.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[eo]),ec=(0,y.useCallback)(async()=>{let e=await (null==eo?void 0:eo(b.uZ.GetDOMSnapshot,v.qs));return(null==e?void 0:e.domSnapshot)||void 0},[eo]);return(0,y.useEffect)(()=>{U&&n&&w&&(null==M||M(),null==eo||eo(b.uZ.SetContent,{content:n,type:w,tailwindStylesEnabled:et,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[n,eo,w,U,M,et]),(0,y.useImperativeHandle)(t,()=>({refresh:()=>{null==j||j(),H(!1);let e=G.current;if(e){let t=e.parentNode;t?(t.removeChild(e),e.removeAttribute("src"),e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("data-no-service-worker","true"),e.setAttribute("referrerpolicy","no-referrer"),e.src=Z,t.appendChild(e)):e.src=Z}},getScreenshot:el,copyHtmlContent:ei,getDOMSnapshot:ec})),(0,a.jsxs)("div",{className:(0,m.A)("relative",r),children:[(0,a.jsx)("iframe",{ref:G,className:"h-full w-full",style:{zoom:T},sandbox:"allow-scripts allow-same-origin",title:I.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:A?"lazy":void 0,src:Z,allow:"fullscreen; clipboard-write",referrerPolicy:"no-referrer"}),(0,a.jsx)(g.N,{children:!U&&(0,a.jsx)(f.P.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),B?(0,a.jsx)(c.v,{isOpen:!!B,url:B,onClose:()=>K(null),onConfirm:()=>{B&&window.open(B,"_blank"),K(null)}}):null,W?(0,a.jsx)(i,{isOpen:!!W,filename:W.filename,onClose:()=>J(null),onConfirm:()=>{if(W){let e=new Blob([W.data],{type:W.mimeType}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=W.filename,n.click(),URL.revokeObjectURL(t)}J(null)}}):null,V&&N&&F?(0,a.jsx)(N,{isOpen:!!V,requestedServers:V.requestedServers,onClose:()=>{V.onClose(),$(null)},artifactContext:F}):null,ee&&en>=100&&(0,a.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,a.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,a.jsx)("p",{className:"text-fg-100 mb-4",children:(0,a.jsx)(l.A,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,a.jsx)(o.$,{onClick:es,variant:"primary",children:(0,a.jsx)(l.A,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});w.displayName="RichSandbox"},20810:(e,t,n)=>{n.d(t,{_:()=>h});var a=n(21155),o=n(75006);let r=o.z.object({name:o.z.string().optional(),url:o.z.string().optional(),type:o.z.string().optional()}),s=new Set(["accept","accept-language","content-type","content-length"]),l=new Set(["set-cookie","x-api-key","x-auth-token","authorization"]),i=["api.anthropic.com"],c=!1,d=[];async function u(e,t){return c=!0,new Promise(n=>{t({requestedServers:e,onClose:()=>{n();let e=d.shift();e?setTimeout(()=>{u(e.validRequestedServers,e.setArtifactMcpModal).then(()=>{e.resolve()})},100):c=!1}})})}let p={"api.anthropic.com":async(e,t)=>await fetch("/api/organizations/".concat(e,"/proxy/v1/messages"),t)};async function h(e,t,n,a,h,g){let f,{url:y,method:b,headers:x,body:v,channelId:C}=e,w=new URL(y),S={};for(let[e,t]of Object.entries(x))s.has(e.toLowerCase())&&(S[e]=t);a&&(S["anthropic-artifact-id"]=a.uuid,S["anthropic-artifact-entity-type"]=a.type);let z=v;if(g&&h&&v&&i.some(e=>e===w.hostname)){let e=new TextDecoder().decode(v),t=o.z.object({mcp_servers:o.z.array(r).optional()}).passthrough().parse(JSON.parse(e));if(t.mcp_servers&&Array.isArray(t.mcp_servers)){let e=t.mcp_servers.filter(e=>e.url);e.length>0&&(c?await new Promise(t=>{d.push({validRequestedServers:e,setArtifactMcpModal:g,resolve:t})}):await u(e,g));let n=new TextEncoder().encode(JSON.stringify(t));z=n.buffer instanceof ArrayBuffer?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):new ArrayBuffer(0)}}let R=new AbortController;if(w.hostname in p)f=await p[w.hostname](n||"",{method:b,headers:S,body:z||void 0,signal:R.signal,redirect:"manual"});else throw Error("Unable to proxy requests for ".concat(w.hostname,"."));let q={};return f.headers.forEach((e,t)=>{l.has(t.toLowerCase())||(q[t]=e)}),m(f,C,t),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse",status:f.status,statusText:f.statusText,headers:q}}async function m(e,t,n){var o;let r=null==(o=e.body)?void 0:o.getReader();if(!r)return void await n(a.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});let s=0;try{for(;;){let{done:e,value:o}=await r.read();if(e){await n(a.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});break}if(o){let e;if((s+=o.byteLength)>0xa00000)throw Error("Response body exceeds maximum size of ".concat(0xa00000," bytes"));let r=0===o.byteOffset&&o.byteLength===o.buffer.byteLength?o.buffer:o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength);e=r instanceof ArrayBuffer?r:new Uint8Array(r).slice().buffer,await n(a.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:e,done:!1},[e])}}}catch(e){await n(a.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{r.releaseLock()}}},21155:(e,t,n)=>{n.d(t,{K_:()=>g,Ub:()=>h,tH:()=>b,uZ:()=>s,v9:()=>y,x8:()=>f,zN:()=>p});var a=n(54890),o=n(75006),r=n(44124),s=function(e){return e.ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",e.SetContent="anthropic.claude.usercontent.sandbox.SetContent",e.GetFile="anthropic.claude.usercontent.sandbox.GetFile",e.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",e.RunCode="anthropic.claude.usercontent.sandbox.RunCode",e.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",e.ReportError="anthropic.claude.usercontent.sandbox.ReportError",e.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",e.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize",e.OpenExternal="anthropic.claude.usercontent.sandbox.OpenExternal",e.DownloadFile="anthropic.claude.usercontent.sandbox.DownloadFile",e.CopyHtmlContent="anthropic.claude.usercontent.sandbox.CopyHtmlContent",e.TrackInteraction="anthropic.claude.usercontent.sandbox.TrackInteraction",e.ProxyFetch="anthropic.claude.usercontent.sandbox.ProxyFetch",e.ProxyFetchStream="anthropic.claude.usercontent.sandbox.ProxyFetchStream",e.GetDOMSnapshot="anthropic.claude.usercontent.sandbox.GetDOMSnapshot",e.DOMContentLoaded="anthropic.claude.usercontent.sandbox.DOMContentLoaded",e}({});let l=o.z.object({type:o.z.literal("UnsupportedImports"),unsupportedModules:o.z.array(o.z.string()),nonExistentIcons:o.z.array(o.z.string())}),i=o.z.object({type:o.z.literal("RuntimeError"),message:o.z.string()}),c=o.z.object({type:o.z.literal("FileNotFound"),fileName:o.z.string()}),d=o.z.object({type:o.z.literal("ClaudeCompletionError"),message:o.z.string()}),u=o.z.discriminatedUnion("type",[l,i,c,d]),p=o.z.object({code:o.z.string()}),h=o.z.object({status:o.z.enum(["success","error"]),result:o.z.string().optional(),logs:o.z.array(o.z.string()),error:o.z.string().optional()}),m={"anthropic.claude.usercontent.sandbox.CopyHtmlContent":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.CopyHtmlContent"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse"),reportHTMLContent:o.z.string()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:o.z.string(),type:o.z.union([o.z.nativeEnum(a.vU),o.z.nativeEnum(a.qK)]),watchContentSize:o.z.boolean().optional(),tailwindStylesEnabled:o.z.boolean().optional()})}),responseSchema:r.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:r.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:o.z.number(),width:o.z.number()})}),responseSchema:r.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:o.z.strictObject({key:o.z.string(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({value:o.z.instanceof(Uint8Array).nullable(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:o.z.strictObject({message:o.z.string(),messageType:o.z.enum(["text","error"]),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:r.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:o.z.strictObject({code:o.z.string(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(h)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:o.z.strictObject({prompt:o.z.string(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({completion:o.z.string().nullable(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:u})}),responseSchema:r.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({screenshot:o.z.string().nullable(),"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.OpenExternal":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.OpenExternal"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"),href:o.z.string()})}),responseSchema:r.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.DownloadFile":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.DownloadFile"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile"),filename:o.z.string(),data:o.z.instanceof(ArrayBuffer),mimeType:o.z.string()})}),responseSchema:r.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.TrackInteraction":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.TrackInteraction"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.TrackInteraction"),interactionType:o.z.literal("click")})}),responseSchema:r.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.ProxyFetch":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetch"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchRequest"),url:o.z.string(),method:o.z.string(),headers:o.z.record(o.z.string()),body:o.z.instanceof(ArrayBuffer).nullable(),channelId:o.z.string()})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse"),status:o.z.number(),statusText:o.z.string(),headers:o.z.record(o.z.string())})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ProxyFetchStream":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetchStream"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest"),channelId:o.z.string(),chunk:o.z.instanceof(ArrayBuffer).nullable(),done:o.z.boolean(),error:o.z.string().optional()})}),responseSchema:r.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetDOMSnapshot":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.GetDOMSnapshot"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:r.Ko.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetDOMSnapshotResponse"),domSnapshot:o.z.string().nullable()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.DOMContentLoaded":{requestSchema:r.Uq.extend({method:o.z.literal("anthropic.claude.usercontent.sandbox.DOMContentLoaded"),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:r.gq,alwaysPermitted:!0}},g=o.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize","anthropic.claude.usercontent.sandbox.OpenExternal","anthropic.claude.usercontent.sandbox.DownloadFile","anthropic.claude.usercontent.sandbox.TrackInteraction","anthropic.claude.usercontent.sandbox.ProxyFetch","anthropic.claude.usercontent.sandbox.DOMContentLoaded"]),f=o.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,m["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,m["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema,m["anthropic.claude.usercontent.sandbox.OpenExternal"].requestSchema,m["anthropic.claude.usercontent.sandbox.DownloadFile"].requestSchema,m["anthropic.claude.usercontent.sandbox.TrackInteraction"].requestSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetch"].requestSchema,m["anthropic.claude.usercontent.sandbox.DOMContentLoaded"].requestSchema]);o.z.union([r.gq,m["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetch"].responseSchema]),o.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot","anthropic.claude.usercontent.sandbox.CopyHtmlContent","anthropic.claude.usercontent.sandbox.ProxyFetchStream","anthropic.claude.usercontent.sandbox.GetDOMSnapshot"]),o.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema,m["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].requestSchema]);let y=o.z.union([m["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,m["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema,m["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].responseSchema,m["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].responseSchema,m["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].responseSchema]),b=Object.entries(m).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},27143:(e,t,n)=>{n.d(t,{CodeRenderer:()=>j,k:()=>M,MarkdownRenderer:()=>E});var a=n(54568),o=n(56340),r=n(1336),s=n(74610),l=n(89697),i=n(9234),c=n(54890),d=n(92007),u=n(32987),p=n(7620),h=n(92479),m=n(98518),g=n(28885),f=n(41417),y=n(91961),b=n(49645),x=n(37463),v=n(46760),C=n(62971);let w=e=>{let{isStreaming:t,children:n,...o}=e;return t?n:(0,a.jsx)(S,{...o,children:n})},S=e=>{let{children:t,sendMessage:n,contentType:o="text",isOpen:r}=e,s=(0,v.A)(),l=(0,m.st)(),i=void 0!==n,[c,d]=(0,p.useState)([]),[h,w]=(0,p.useState)({top:0,left:0,width:0}),[S,z]=(0,p.useState)(!1),[R,q]=(0,p.useState)(!1),[M,j]=(0,p.useState)(""),[E,k]=(0,p.useState)(""),[P,O]=(0,p.useState)(!1),A=(0,p.useRef)(null),T=(0,p.useRef)(null),F=(0,p.useCallback)((e,t)=>{var n;let a=function(e,t){let n=[];for(let a=0;a<e.rangeCount;a++){let o=e.getRangeAt(a);if(o.startContainer===o.endContainer&&o.startContainer.nodeType===Node.TEXT_NODE){let e=o.startContainer,t=document.createRange();for(let a=o.startOffset;a<o.endOffset;a++){t.setStart(e,a),t.setEnd(e,a+1);let o=Array.from(t.getClientRects());n.push(...o)}t.detach()}else{let e=function(e){let t,n=[],a=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=a.nextNode();)n.push(t);return n}(o);e.forEach((a,r)=>{let s=document.createRange(),l="length"in a?a.length:0,i=0===r,c=r===e.length-1,d=i?o.startOffset:0,u=c&&!t?o.endOffset:l;s.setStart(a,d),s.setEnd(a,u);let p=Array.from(s.getClientRects());n.push(...p),s.detach()})}}return n}(e,t),o=null==(n=A.current)?void 0:n.getBoundingClientRect();return Array.from(a).map(e=>({top:e.top-((null==o?void 0:o.top)||0)-2.5,left:e.left-((null==o?void 0:o.left)||0),width:e.width,height:e.height+5.5}))},[]),N=(0,p.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null==(t=A.current)?void 0:t.contains(n.commonAncestorContainer)},[]);(0,p.useEffect)(()=>{function e(e){var t,n,a,o;let r,s,{selection:l,isSelectAll:i}=e,c=F(l,i);if(c.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let e=Math.max(...c.map(e=>e.left+e.width));r=c[0].top-9,s=e+10}else{let e=Math.max(...c.map(e=>e.top+e.height));s=Math.min(...c.map(e=>e.left)),r=Math.min((null!=(a=null==(n=A.current)?void 0:n.scrollHeight)?a:0)-50,e)}let u=((null!=(o=null==(t=A.current)?void 0:t.scrollWidth)?o:1e3)-s)/3*2;d(c),z(!0),q(!1),w({top:r,left:s,width:u}),k(l.toString())}let t=()=>{O(!0)},n=t=>{"Escape"===t.key&&(q(!1),z(!1),j(""),d([]));let n=((0,y.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,a=A.current;if(a&&r&&n){let n=document.activeElement&&(document.activeElement===a||(null==a?void 0:a.contains(document.activeElement))),o=window.getSelection();if(n&&o){t.preventDefault();let n=document.createRange();n.selectNodeContents(a),o.removeAllRanges(),o.addRange(n),e({selection:o,isSelectAll:!0})}}},a=t=>{if(T.current&&T.current.contains(t.target))return;let n=window.getSelection();n&&!n.isCollapsed&&N(n)?e({selection:n}):(d([]),z(!1),q(!1),k(""),j("")),O(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",a),document.addEventListener("keydown",n)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",a),document.removeEventListener("keydown",n)}},[F,N,i,r]);let L=e=>{i&&(n(e),j(""),q(!1),z(!1),d([]))},I=()=>"text"===o?E.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===o?"```\n".concat(E,"\n```"):void 0,D=()=>{L({prompt:"".concat(I(),"\n\n").concat(M),attachments:[],files:[],syncSources:[]})};return(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)("div",{ref:A,tabIndex:0,className:(0,u.$)("w-full h-full relative",i?P?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),c.map((e,t)=>(0,a.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,a.jsx)(b.N,{children:S&&!R&&(0,a.jsx)(x.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:h.top+5,left:h.left},children:(0,a.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,a.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,a.jsx)(f.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{l.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),q(!0)},prepend:(0,a.jsx)(g.XG,{}),children:(0,a.jsx)(C.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,a.jsx)(f.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{l.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),L({prompt:"".concat(s.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(I()),attachments:[],files:[],syncSources:[]})},prepend:(0,a.jsx)(g.g5,{}),children:(0,a.jsx)(C.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,a.jsx)(b.N,{children:R&&(0,a.jsxs)(x.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:h.top+5,left:h.left,width:h.width},ref:T,onSubmit:e=>{e.preventDefault(),D()},children:[(0,a.jsx)("input",{type:"text",value:M,onChange:e=>j(e.target.value),placeholder:s.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,a.jsx)(b.N,{children:M.trim().length>0?(0,a.jsx)(x.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,a.jsx)(f.$,{onClick:()=>D(),"aria-label":s.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,a.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,a.jsx)(C.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var z=n(53029),R=n(19544);let q="opacity-30 blur-[2px]",M=e=>{let{isOpen:t,content:n,language:o,citations:r,type:s,showRaw:l,richSandboxRef:d,isCurrentStreaming:h,isChatStreaming:m,onSandboxConfirmation:g,onDOMContentLoaded:f,sendMessage:y,richSandboxCapabilities:b,isLatestVersion:x,artifactId:v,artifactContext:C,artifactVersion:w,onArtifactRuntimeError:S,artifact:M,hasMenuOpen:P,zoom:O,onTrackInteraction:A,showLoginModal:T,ArtifactMcpModal:F}=e,N=void 0!==s&&void 0!==n&&s!==c.vU.Code&&s!==c.vU.Markdown,L=(0,p.useRef)(null),I=N&&!l,[D,_]=(0,p.useState)(null),U=(0,p.useCallback)(e=>{void 0!==v&&void 0!==w&&(void 0!==S&&S(e),_({error:e,artifactId:v,artifactVersion:w}))},[v,w,S]);(0,p.useEffect)(()=>{var e;if(!M||!h)return;let t=M.versions[M.versions.length-1],n=M.versions[M.versions.length-2];if(!n||!t||"update"!==t.command)return;let a=k(n.resultState,t.resultState);-1!==a&&(null==(e=L.current)||e.scrollToPercentage(a/100))},[n,M,h]),(0,p.useEffect)(()=>{!h&&L.current&&L.current.enableScrolling()},[h]);let H=(0,p.useCallback)(()=>{_(e=>e&&(e.artifactId!==v||e.artifactVersion!==w)?null:e)},[v,w]),G=(0,p.useCallback)(()=>{_(null)},[]);return(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsxs)("div",{className:(0,u.A)("ease-out duration-200",I?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",P&&q),children:[(0,a.jsx)(R.A,{ref:d,className:I?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:I?n:void 0,type:I?s:void 0,onSandboxConfirmation:g,onDOMContentLoaded:f,capabilities:b,onReportError:U,onSetContent:H,onRefresh:G,externalLinkBehavior:"ask",zoom:O,onTrackInteraction:A,showLoginModal:T,artifactContext:C,ArtifactMcpModal:F,isChatStreaming:m}),I&&D&&(0,a.jsx)(z.i,{error:D,handleClose:()=>_(null),sendMessage:x?y:void 0,isStreaming:m})]}),void 0===n||void 0===s?null:s===c.vU.Code||l?(0,a.jsx)(i.Z,{noDefaultScroll:!h,ref:L,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",P&&q),children:(0,a.jsx)(j,{content:n,isStreaming:m,language:o,sendMessage:y,isOpen:t},"code-".concat(v,"-").concat(w,"-").concat(h))}):s===c.vU.Markdown?(0,a.jsx)(i.Z,{noDefaultScroll:!h,ref:L,className:(0,u.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",P&&q),children:(0,a.jsx)(E,{content:n,citations:r,isStreaming:m,sendMessage:y,isOpen:t},"markdown-".concat(v,"-").concat(w,"-").concat(h))}):null]})},j=e=>{let{content:t,isStreaming:n,language:r,sendMessage:s,isOpen:i}=e,{codeStyle:c}=(0,l.V)();return(0,a.jsx)(w,{isStreaming:n,sendMessage:s,contentType:"code",isOpen:i,children:(0,a.jsx)(h.A,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:r,PreTag:"div",style:c,renderer:o.G,children:t})})},E=e=>{let{content:t,citations:n,isStreaming:o,sendMessage:l,isOpen:i}=e,c=(0,d.n)(),u=(0,p.useMemo)(()=>c&&n&&n.length>0?(0,s.k0)(n,t):t,[t,n,c]);return(0,a.jsx)(w,{isStreaming:o,sendMessage:l,isOpen:i,children:(0,a.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] -tracking-[0.015em] px-6 pt-4 md:pt-6 md:px-11",children:[(0,a.jsx)(r.fP,{text:u,blockCitations:n,className:"!gap-3.5",isStreaming:o}),(0,a.jsx)("div",{className:"h-8"})]})})},k=(e,t)=>{if(!e||!t)return -1;let n=e.replace(/\\n/g,"\n"),a=t.replace(/\\n/g,"\n"),o=[...n].findIndex((e,t)=>e!==a[t]);if(-1===o&&n.length===a.length)return -1;let r=(n.slice(0,-1===o?n.length:o).match(/\n/g)||[]).length,s=(n.match(/\n/g)||[]).length;return s?Math.round(r/s*100):-1}},44124:(e,t,n)=>{n.d(t,{Ko:()=>s,SV:()=>d,Uq:()=>r,_s:()=>o,gq:()=>i,qs:()=>c,t6:()=>l});var a=n(75006);let o=a.z.object({channel:a.z.enum(["request","response"]),requestId:a.z.string()}).passthrough(),r=o.strict().extend({channel:a.z.literal("request"),method:a.z.string(),payload:a.z.strictObject({"@type":a.z.string()})}),s=o.extend({channel:a.z.literal("response"),status:a.z.number().int().min(100).max(599),payload:a.z.strictObject({"@type":a.z.string()}).passthrough()}).passthrough(),l=s.extend({status:a.z.number().int().min(400).max(599),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:a.z.string()})}),i=s.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),c={"@type":"type.googleapis.com/google.protobuf.Empty"},d=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},53029:(e,t,n)=>{n.d(t,{i:()=>c});var a=n(54568),o=n(7620),r=n(46760),s=n(41417),l=n(76761);let i=e=>{let{handleClose:t,title:n,description:o,inset:r,action:i}=e;return(0,a.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,a.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:n}),(0,a.jsx)("p",{className:"mb-2 text-sm",children:o}),!!r&&(0,a.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:r}),i&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(s.$,{variant:"primary",className:"mt-4 text-sm",onClick:i.onClick,disabled:i.disabled,loading:i.loading,children:i.label})}),(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)(s.$,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,a.jsx)(l.X,{})})})]})},c=e=>{var t,n,s;let{error:l,handleClose:c,sendMessage:d,isStreaming:u}=e,[p,h]=(0,o.useState)(!1),m=(0,r.A)(),g=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message}}}(l.error,m),f="> ".concat(g.description,"\n  ").concat(null!=(s=null==(t=g.inset)?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))?s:"","\n  \n\n  Can you fix this error in `").concat(l.artifactId,"`?"),y=d?{label:m.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{h(!0),null==d||d({prompt:f,attachments:[],files:[],syncSources:[]})},disabled:u,loading:p}:void 0;return(0,a.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,a.jsx)(i,{title:g.title,description:g.description,handleClose:c,inset:(null==(n=g.inset)?void 0:n.length)?g.inset?(0,a.jsx)("ul",{children:g.inset.map((e,t)=>(0,a.jsx)("li",{children:e},t))}):null:void 0,action:y})})}},53120:(e,t,n)=>{n.d(t,{x:()=>s});var a=n(21155),o=n(44124);let r=new Map;class s{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=o._s.safeParse(e.data);if(!n.success)return void console.warn("Received message does not conform to basic message shape, ignoring");let a=n.data;if("response"===a.channel)return void this.handleResponse(a);this.messageQueue.push(a),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||r.get(e.requestId);if(void 0!==t){t(e),r.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=a.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,r=a.x8.safeParse(e);if(!r.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let s=r.data;if(this.requestLog.has(s.requestId)){this.sendErrorResponse(s.requestId,400,"Request ID already processed");continue}this.requestLog.set(s.requestId,{message:s,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(s.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(s.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(s,this.boundSendRequest).then(e=>{var t;let n=o.Ko.parse({channel:"response",status:200,requestId:s.requestId,payload:null!=e?e:o.qs}),a=this.requestLog.get(s.requestId);a&&this.requestLog.set(s.requestId,{...a,response:n,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(s.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var a;let r=o.t6.parse({channel:"response",status:t,requestId:e,payload:(0,o.SV)(n)}),s=this.requestLog.get(e);s&&this.requestLog.set(e,{...s,response:r,responseTimestamp:new Date().getTime()}),null==(a=this.iframe.contentWindow)||a.postMessage(r,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,n){return new Promise((s,l)=>{var i,c;let d=Date.now().toString(),u={channel:"request",method:e,requestId:d,payload:t},p=e=>{let t=o.Ko.safeParse(e);if(!t.success)return void l(Error("Invalid response format"));let n=t.data;if(n.status>=400){let e=o.t6.safeParse(n);e.success?l(Error(e.data.payload.error)):l(Error("Error response (".concat(n.status,")")));return}let r=a.v9.safeParse(n);r.success?s(r.data.payload):l(Error("Invalid response payload for the method"))};this.inFlightRequests.set(d,p),r.set(d,p),n&&n.length>0?null==(i=this.iframe.contentWindow)||i.postMessage(u,this.allowedOrigin,n):null==(c=this.iframe.contentWindow)||c.postMessage(u,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:a,onCapabilityAction:o}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=a,this.onCapabilityAction=o,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}}}]);